# 数据库回滚记录 - 当前状态

**备份时间**: 2025-11-30  
**数据库**: internship_management_db  
**目的**: 记录当前数据库所有表的状态，用于后续数据回滚

---

## 一、关键表数据快照

### 1. internship_apply（实习申请表）

#### 当前数据记录

**记录1: apply_id = 21（自主实习）**
```json
{
  "apply_id": 21,
  "student_id": 66,
  "user_id": 128,
  "plan_id": 6,
  "apply_type": 2,
  "enterprise_id": 11,
  "post_id": null,
  "self_enterprise_name": "测试自主实习",
  "self_enterprise_address": "测试自主实习",
  "self_contact_person": "测试自主实习",
  "self_contact_phone": "15144567855",
  "self_enterprise_nature": "测试自主实习",
  "self_post_name": "测试自主实习",
  "self_start_date": "2025-09-10",
  "self_end_date": "2026-01-04",
  "self_description": "",
  "resume_attachment": null,
  "apply_reason": "测试自主实习",
  "status": 11,
  "audit_user_id": 126,
  "audit_time": "2025-11-28 13:11:10",
  "audit_opinion": "同意",
  "enterprise_feedback": null,
  "enterprise_feedback_time": null,
  "interview_time": null,
  "interview_location": null,
  "interview_result": null,
  "interview_comment": null,
  "accept_time": "2025-11-28 13:11:10",
  "student_confirm_status": 1,
  "student_confirm_time": "2025-11-28 13:13:37",
  "unbind_status": 0,
  "unbind_reason": null,
  "unbind_audit_user_id": null,
  "unbind_audit_time": null,
  "unbind_audit_opinion": null,
  "internship_start_date": "2025-11-27",
  "internship_end_date": null,
  "mentor_id": null,
  "delete_flag": 0,
  "create_time": "2025-11-28 13:10:24",
  "update_time": "2025-11-30 21:40:06"
}
```

**记录2: apply_id = 22（合作企业实习）**
```json
{
  "apply_id": 22,
  "student_id": 67,
  "user_id": 129,
  "plan_id": 6,
  "apply_type": 1,
  "enterprise_id": 10,
  "post_id": 10,
  "self_enterprise_name": null,
  "self_enterprise_address": null,
  "self_contact_person": null,
  "self_contact_phone": null,
  "self_enterprise_nature": null,
  "self_post_name": null,
  "self_start_date": null,
  "self_end_date": null,
  "self_description": null,
  "resume_attachment": "",
  "apply_reason": "测试合作实习",
  "status": 3,
  "audit_user_id": 126,
  "audit_time": "2025-11-28 13:11:06",
  "audit_opinion": "同意",
  "enterprise_feedback": "提供",
  "enterprise_feedback_time": "2025-11-28 13:13:40",
  "interview_time": null,
  "interview_location": null,
  "interview_result": null,
  "interview_comment": null,
  "accept_time": "2025-11-28 13:13:40",
  "student_confirm_status": 1,
  "student_confirm_time": "2025-11-28 13:13:47",
  "unbind_status": 0,
  "unbind_reason": null,
  "unbind_audit_user_id": null,
  "unbind_audit_time": null,
  "unbind_audit_opinion": null,
  "internship_start_date": "2025-09-10",
  "internship_end_date": "2026-01-04",
  "mentor_id": 11,
  "delete_flag": 0,
  "create_time": "2025-11-28 13:10:50",
  "update_time": "2025-11-30 21:40:07"
}
```

---

### 2. student_info（学生信息表）

**记录1: student_id = 66（张三）**
```json
{
  "student_id": 66,
  "user_id": 128,
  "student_no": "2021001001",
  "class_id": 20,
  "enrollment_year": 2021,
  "graduation_year": null,
  "major_id": 24,
  "college_id": 23,
  "school_id": 9,
  "current_apply_id": 21,
  "current_enterprise_id": 11,
  "internship_status": 1,
  "status": 1,
  "delete_flag": 0,
  "create_time": "2025-11-22 21:09:51",
  "update_time": "2025-11-30 21:40:06"
}
```

**记录2: student_id = 67（李四）**
```json
{
  "student_id": 67,
  "user_id": 129,
  "student_no": "2021001002",
  "class_id": 20,
  "enrollment_year": 2021,
  "graduation_year": null,
  "major_id": 24,
  "college_id": 23,
  "school_id": 9,
  "current_apply_id": 22,
  "current_enterprise_id": 10,
  "internship_status": 1,
  "status": 1,
  "delete_flag": 0,
  "create_time": "2025-11-22 21:09:51",
  "update_time": "2025-11-30 21:40:07"
}
```

---

### 3. enterprise_evaluation（企业评价表）

**记录1: evaluation_id = 1**
```json
{
  "evaluation_id": 1,
  "apply_id": 22,
  "student_id": 67,
  "enterprise_id": 10,
  "work_attitude_score": "89.00",
  "knowledge_application_score": "99.00",
  "professional_skill_score": "78.00",
  "teamwork_score": "100.00",
  "innovation_score": "87.00",
  "log_weekly_report_score": "99.00",
  "log_weekly_report_score_auto": "93.50",
  "total_score": "92.00",
  "evaluation_comment": "纯粹是",
  "evaluation_status": 1,
  "submit_time": "2025-11-29 12:42:03",
  "evaluator_id": 137,
  "delete_flag": 0,
  "create_time": "2025-11-29 12:42:03",
  "update_time": "2025-11-29 12:42:03"
}
```

---

### 4. school_evaluation（学校评价表）

**记录1: evaluation_id = 1**
```json
{
  "evaluation_id": 1,
  "apply_id": 22,
  "student_id": 67,
  "log_weekly_report_score": "98.00",
  "process_performance_score": "99.00",
  "achievement_score": "89.00",
  "summary_reflection_score": "88.00",
  "total_score": "93.50",
  "evaluation_comment": "ggasgsa",
  "evaluation_status": 1,
  "submit_time": "2025-11-30 21:18:42",
  "evaluator_id": 126,
  "delete_flag": 0,
  "create_time": "2025-11-30 21:18:41",
  "update_time": "2025-11-30 21:18:41"
}
```

---

### 5. self_evaluation（学生自评表）

**记录1: evaluation_id = 1**
```json
{
  "evaluation_id": 1,
  "apply_id": 22,
  "student_id": 67,
  "self_score": "88.00",
  "reflection_summary": "<p>萨法说法是as噶杀杀杀啊水水碍事f</p>",
  "evaluation_status": 1,
  "submit_time": "2025-11-30 21:26:00",
  "delete_flag": 0,
  "create_time": "2025-11-30 21:18:56",
  "update_time": "2025-11-30 21:26:00"
}
```

---

### 6. comprehensive_score（综合成绩表）

**当前数据**: 无记录

---

### 7. user_info（用户信息表）

**用户列表**:
- user_id = 1: admin（系统管理员）
- user_id = 122: pku_admin（北京大学管理员）
- user_id = 124: pku_dean（张院长）
- user_id = 126: pku_teacher1（刘老师）
- user_id = 128: 2021001001（张三）
- user_id = 129: 2021001002（李四）
- user_id = 135: tencent_admin（腾讯管理员）
- user_id = 137: tencent_mentor1（腾讯导师1）

---

### 8. enterprise_info（企业信息表）

**记录1: enterprise_id = 10（腾讯科技）**
```json
{
  "enterprise_id": 10,
  "user_id": 135,
  "enterprise_name": "腾讯科技",
  "enterprise_code": "TENCENT",
  "unified_social_credit_code": "91440300708461136T",
  "legal_person": "马化腾",
  "registered_capital": "2000000000.00",
  "industry": "互联网",
  "address": "广东省深圳市南山区科技园",
  "contact_person": "李经理",
  "contact_phone": "0755-86013388",
  "contact_email": "contact@tencent.com",
  "enterprise_scale": "大型",
  "business_scope": "社交网络、游戏、金融科技",
  "audit_status": 1,
  "audit_opinion": "审核通过",
  "audit_time": "2025-11-22 21:10:06",
  "auditor_id": 122,
  "status": 1,
  "delete_flag": 0,
  "create_time": "2025-11-22 21:09:55",
  "update_time": "2025-11-22 21:18:11"
}
```

**记录2: enterprise_id = 11（测试自主实习）**
```json
{
  "enterprise_id": 11,
  "user_id": null,
  "enterprise_name": "测试自主实习",
  "enterprise_code": "SELF_1764335470425",
  "unified_social_credit_code": null,
  "legal_person": null,
  "registered_capital": null,
  "industry": null,
  "address": "测试自主实习",
  "contact_person": "测试自主实习",
  "contact_phone": "15144567855",
  "contact_email": null,
  "enterprise_scale": null,
  "business_scope": null,
  "audit_status": 1,
  "audit_opinion": null,
  "audit_time": null,
  "auditor_id": null,
  "status": 1,
  "delete_flag": 0,
  "create_time": "2025-11-28 13:11:10",
  "update_time": "2025-11-28 13:11:10"
}
```

---

### 9. enterprise_mentor_info（企业导师信息表）

**记录1: mentor_id = 11**
```json
{
  "mentor_id": 11,
  "user_id": 137,
  "enterprise_id": 10,
  "mentor_name": "腾讯导师1",
  "position": "高级工程师",
  "department": "技术部",
  "phone": "13800005002",
  "email": "mentor001@tencent.com",
  "status": 1,
  "delete_flag": 0,
  "create_time": "2025-11-22 21:10:00",
  "update_time": "2025-11-22 21:10:00"
}
```

---

### 10. internship_plan（实习计划表）

**记录列表**:
- plan_id = 5: 2024-2025学年第一学期计算机科学与技术专业实习计划
- plan_id = 6: 测试计划
- plan_id = 7: 纯粹是

---

### 11. internship_post（实习岗位表）

**记录列表**:
- post_id = 9: Java开发实习生
- post_id = 10: 前端开发实习生
- post_id = 11: Python开发实习生

---

### 12. internship_weekly_report（实习周报表）

**记录1: report_id = 7**
```json
{
  "report_id": 7,
  "student_id": 67,
  "user_id": 129,
  "apply_id": 22,
  "week_number": 1,
  "report_date": "2025-11-27",
  "report_title": "第1周实习周报",
  "work_content": "...",
  "attachment_urls": "/uploads/2025/11/28/61ccc96f5c3a461e9b32c212dfbc4b6b.docx,/uploads/2025/11/28/8685cbe8b51b497da5887e829b6c34fd.pdf",
  "instructor_id": 137,
  "review_status": 1,
  "review_time": "2025-11-29 07:39:50",
  "review_comment": "是否",
  "review_score": "99.00",
  "delete_flag": 0,
  "create_time": "2025-11-28 13:14:28",
  "update_time": "2025-11-28 13:14:28"
}
```

---

### 13. internship_log（实习日志表）

**记录1: log_id = 9**
```json
{
  "log_id": 9,
  "student_id": 67,
  "user_id": 129,
  "apply_id": 22,
  "plan_id": null,
  "log_date": "2025-11-27",
  "log_title": "2025-11-28 实习日志",
  "log_content": "...",
  "attachment_urls": "/uploads/2025/11/28/0431a050c2c1477282af0b3e08be14c9.docx,/uploads/2025/11/28/05ca2b09e1ae47b893dd3f5deba3f56a.pdf",
  "work_hours": "8.00",
  "instructor_id": 137,
  "review_status": 1,
  "review_time": "2025-11-29 07:39:57",
  "review_comment": "规范",
  "review_score": "88.00",
  "delete_flag": 0,
  "create_time": "2025-11-28 13:14:07",
  "update_time": "2025-11-28 15:34:34"
}
```

---

### 14. internship_feedback（实习反馈表）

**记录1: feedback_id = 7**
```json
{
  "feedback_id": 7,
  "student_id": 67,
  "user_id": 129,
  "apply_id": 22,
  "feedback_type": 1,
  "feedback_title": "啊是擦萨法说法啊沙发上",
  "feedback_content": "暗杀三个噶时光碍事俺是个",
  "attachment_urls": "/uploads/2025/11/28/0257cd3ce3414467ac49d634da13d9f0.docx,/uploads/2025/11/28/ae0dab164c0e4692bbc49c6505623547.pdf",
  "feedback_status": 2,
  "reply_user_id": 137,
  "reply_user_type": 1,
  "reply_content": "收到",
  "reply_time": "2025-11-29 08:28:23",
  "solve_time": "2025-11-29 08:28:33",
  "delete_flag": 0,
  "create_time": "2025-11-28 13:15:24",
  "update_time": "2025-11-28 13:15:24"
}
```

---

### 15. internship_achievement（实习成果表）

**记录1: achievement_id = 7**
```json
{
  "achievement_id": 7,
  "student_id": 67,
  "user_id": 129,
  "apply_id": 22,
  "achievement_name": "发顺丰案说法案说法",
  "achievement_type": "项目成果",
  "achievement_description": "...",
  "file_urls": "/uploads/2025/11/28/d5d105be4b0941308e18845a66ed6811.pdf",
  "submit_date": "2025-11-27",
  "instructor_id": 137,
  "review_status": 1,
  "review_time": "2025-11-29 08:28:43",
  "review_comment": "通过",
  "delete_flag": 0,
  "create_time": "2025-11-28 13:14:50",
  "update_time": "2025-11-28 13:54:27"
}
```

---

### 16. attendance（考勤表）

**记录列表**:
- attendance_id = 9: 正常打卡
- attendance_id = 10: 请假记录

---

### 17. attendance_group（考勤组表）

**记录1: group_id = 1**
```json
{
  "group_id": 1,
  "enterprise_id": 10,
  "mentor_id": 135,
  "group_name": "测试",
  "group_description": "测试萨法说法",
  "work_days_type": 1,
  "work_days_config": "",
  "default_work_hours": "8.00",
  "status": 1,
  "delete_flag": 0,
  "create_time": "2025-11-29 04:32:31",
  "update_time": "2025-11-29 04:32:31",
  "create_user_id": 135,
  "update_user_id": null
}
```

---

### 18. attendance_group_student（考勤组学生关联表）

**记录1: id = 1**
```json
{
  "id": 1,
  "group_id": 1,
  "apply_id": 22,
  "student_id": 67,
  "effective_start_date": "2025-09-10",
  "effective_end_date": "2026-01-04",
  "status": 1,
  "delete_flag": 0,
  "create_time": "2025-11-29 04:32:56",
  "update_time": "2025-11-29 04:32:56",
  "create_user_id": 137
}
```

---

### 19. attendance_group_time_slot（考勤时间段表）

**记录列表**:
- slot_id = 1: 标准班（09:00-18:00）
- slot_id = 2: 早班（08:00-16:00）

---

### 20. interview（面试表）

**记录1: interview_id = 11**
```json
{
  "interview_id": 11,
  "apply_id": 22,
  "enterprise_id": 10,
  "student_id": 67,
  "interview_type": 1,
  "interview_time": "2025-11-28 13:12:13",
  "interview_location": "出场费",
  "interview_link": null,
  "interview_phone": null,
  "interviewer": "案说法",
  "interview_content": "撒发生",
  "student_confirm": 1,
  "student_confirm_time": "2025-11-28 13:12:37",
  "interview_result": 1,
  "interview_comment": "通过",
  "interview_feedback_time": "2025-11-28 13:12:59",
  "status": 2,
  "delete_flag": 0,
  "create_time": "2025-11-28 13:12:26",
  "update_time": "2025-11-28 13:12:26"
}
```

---

### 21. class_info（班级信息表）

**记录列表**:
- class_id = 20: 计算机科学与技术2021级1班
- class_id = 21: 软件工程2021级1班
- class_id = 22: 计算机科学与技术2021级1班
- class_id = 23: ces

---

### 22. college_info（学院信息表）

**记录列表**:
- college_id = 23: 信息科学技术学院（北京大学）
- college_id = 24: 计算机科学与技术系（清华大学）

---

### 23. school_info（学校信息表）

**记录列表**:
- school_id = 9: 北京大学
- school_id = 10: 清华大学
- school_id = 11: 测试学校

---

### 24. major_info（专业信息表）

**记录列表**:
- major_id = 24: 计算机科学与技术（北京大学）
- major_id = 25: 软件工程（北京大学）
- major_id = 26: 计算机科学与技术（清华大学）

---

### 25. teacher_info（教师信息表）

**记录列表**:
- teacher_id = 21: 张院长（教授）
- teacher_id = 23: 刘老师（副教授）

---

### 26. semester_info（学期信息表）

**记录1: semester_id = 9**
```json
{
  "semester_id": 9,
  "semester_name": "2024-2025学年第一学期",
  "start_date": "2024-08-31",
  "end_date": "2025-01-30",
  "school_id": 9,
  "is_current": 1,
  "delete_flag": 0,
  "create_time": "2025-11-22 21:10:26",
  "update_time": "2025-11-27 01:18:31"
}
```

---

### 27. role_info（角色信息表）

**记录列表**:
- role_id = 1: 系统管理员
- role_id = 2: 学校管理员
- role_id = 3: 学院负责人
- role_id = 4: 班主任
- role_id = 6: 企业管理员
- role_id = 7: 企业导师
- role_id = 8: 学生

---

### 28. permission_info（权限信息表）

**记录**: 共30条权限记录（permission_id 1-30）

---

### 29. role_permission（角色权限关联表）

**记录**: 共30条关联记录（系统管理员拥有所有权限）

---

### 30. user_role（用户角色关联表）

**记录列表**:
- id = 1: user_id=1, role_id=1（系统管理员）
- id = 140: user_id=122, role_id=2（学校管理员）
- id = 142: user_id=124, role_id=3（学院负责人）
- id = 144: user_id=126, role_id=4（班主任）
- id = 148: user_id=128, role_id=8（学生）
- id = 149: user_id=129, role_id=8（学生）
- id = 155: user_id=135, role_id=6（企业管理员）
- id = 157: user_id=137, role_id=7（企业导师）

---

### 31. school_admin_info（学校管理员信息表）

**记录1: admin_id = 9**
```json
{
  "admin_id": 9,
  "user_id": 122,
  "school_id": 9,
  "status": 1,
  "delete_flag": 0,
  "create_time": "2025-11-22 21:09:35",
  "update_time": "2025-11-22 21:09:35"
}
```

---

### 32. enterprise_register_school（企业注册学校关联表）

**记录列表**:
- id = 3: enterprise_id=9, school_id=9
- id = 4: enterprise_id=9, school_id=10
- id = 5: enterprise_id=10, school_id=9
- id = 6: enterprise_id=10, school_id=10

---

### 33. enterprise_school_cooperation（校企合作表）

**记录列表**:
- id = 7: enterprise_id=9, school_id=9
- id = 8: enterprise_id=9, school_id=10
- id = 9: enterprise_id=10, school_id=9
- id = 10: enterprise_id=10, school_id=10

---

### 34. system_config（系统配置表）

**记录列表**:
- config_id = 7: share_code_expire_days = 30
- config_id = 8: share_code_length = 8
- config_id = 11: enterprise_evaluation_weight = 0.4
- config_id = 12: school_evaluation_weight = 0.4
- config_id = 13: student_self_evaluation_weight = 0.2

---

## 二、回滚SQL脚本

### 回滚实习申请数据

```sql
-- 回滚 apply_id=21（自主实习）
UPDATE internship_apply 
SET 
  status = 11,
  internship_end_date = NULL,
  unbind_audit_opinion = NULL,
  update_time = '2025-11-30 21:40:06'
WHERE apply_id = 21;

-- 回滚 apply_id=22（合作企业实习）
UPDATE internship_apply 
SET 
  status = 3,
  internship_end_date = '2026-01-04',
  unbind_audit_opinion = NULL,
  update_time = '2025-11-30 21:40:07'
WHERE apply_id = 22;
```

### 回滚学生信息数据

```sql
-- 回滚 student_id=66（张三）
UPDATE student_info 
SET 
  internship_status = 1,
  current_apply_id = 21,
  current_enterprise_id = 11,
  update_time = '2025-11-30 21:40:06'
WHERE student_id = 66;

-- 回滚 student_id=67（李四）
UPDATE student_info 
SET 
  internship_status = 1,
  current_apply_id = 22,
  current_enterprise_id = 10,
  update_time = '2025-11-30 21:40:07'
WHERE student_id = 67;
```

### 回滚评价数据

```sql
-- 删除企业评价（如果需要）
DELETE FROM enterprise_evaluation WHERE evaluation_id = 1;

-- 删除学校评价（如果需要）
DELETE FROM school_evaluation WHERE evaluation_id = 1;

-- 删除学生自评（如果需要）
DELETE FROM self_evaluation WHERE evaluation_id = 1;
```

### 回滚其他业务数据

```sql
-- 删除考勤记录（如果需要）
DELETE FROM attendance WHERE attendance_id IN (9, 10);

-- 删除考勤组（如果需要）
DELETE FROM attendance_group WHERE group_id = 1;
DELETE FROM attendance_group_student WHERE id = 1;
DELETE FROM attendance_group_time_slot WHERE slot_id IN (1, 2);

-- 删除周报、日志、反馈、成果等（如果需要）
DELETE FROM internship_weekly_report WHERE report_id = 7;
DELETE FROM internship_log WHERE log_id = 9;
DELETE FROM internship_feedback WHERE feedback_id = 7;
DELETE FROM internship_achievement WHERE achievement_id = 7;
DELETE FROM interview WHERE interview_id = 11;
```

---

## 三、数据统计

- **实习申请总数**: 2条（未删除）
- **学生总数**: 2条（未删除）
- **企业评价总数**: 1条
- **学校评价总数**: 1条
- **学生自评总数**: 1条
- **综合成绩总数**: 0条
- **用户总数**: 8条（未删除）
- **企业总数**: 2条（未删除）
- **企业导师总数**: 1条（未删除）
- **实习计划总数**: 3条（未删除）
- **实习岗位总数**: 3条（未删除）
- **周报总数**: 1条
- **日志总数**: 1条
- **反馈总数**: 1条
- **成果总数**: 1条
- **考勤记录总数**: 2条
- **考勤组总数**: 1条
- **面试记录总数**: 1条

---

## 四、注意事项

1. **数据完整性**:
   - 确保外键关系正确
   - 确保逻辑删除标志正确
   - 确保时间戳字段正确

2. **回滚操作**:
   - 根据实际需要选择回滚范围
   - 建议先备份当前数据再执行回滚
   - 回滚后验证数据一致性

3. **关键状态字段**:
   - `internship_apply.status` - 实习申请状态
   - `student_info.internship_status` - 学生实习状态
   - `internship_apply.internship_end_date` - 实习结束日期
   - `internship_apply.unbind_status` - 解绑状态

---

**备份完成时间**: 2025-11-30  
**备份人**: AI Assistant  
**用途**: 数据库状态回滚记录

