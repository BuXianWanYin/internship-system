# 配置键使用情况检查报告

## 一、评价权重配置键

### 1.1 enterprise_evaluation_weight（企业评价权重）

**配置值**：0.4（40%）

**使用位置**：
- ✅ `ComprehensiveScoreServiceImpl.java` 第123行
- 用于计算合作企业实习的综合成绩

**代码示例**：
```java
BigDecimal enterpriseWeight = new BigDecimal(SystemConfigUtil.getConfigValue(ConfigKeys.ENTERPRISE_EVALUATION_WEIGHT, "0.4"));
```

**使用场景**：
- 合作企业实习的综合成绩计算
- 公式：综合成绩 = 企业评价×40% + 学校评价×40% + 自评×20%

**状态**：✅ **已使用**

---

### 1.2 school_evaluation_weight（学校评价权重）

**配置值**：0.4（40%）

**使用位置**：
- ✅ `ComprehensiveScoreServiceImpl.java` 第124行
- 用于计算合作企业实习的综合成绩

**代码示例**：
```java
BigDecimal schoolWeight = new BigDecimal(SystemConfigUtil.getConfigValue(ConfigKeys.SCHOOL_EVALUATION_WEIGHT, "0.4"));
```

**使用场景**：
- 合作企业实习的综合成绩计算
- 公式：综合成绩 = 企业评价×40% + 学校评价×40% + 自评×20%

**状态**：✅ **已使用**

---

### 1.3 student_self_evaluation_weight（学生自评权重）

**配置值**：0.2（20%）

**使用位置**：
- ✅ `ComprehensiveScoreServiceImpl.java` 第125行
- 用于计算合作企业实习的综合成绩

**代码示例**：
```java
BigDecimal selfWeight = new BigDecimal(SystemConfigUtil.getConfigValue(ConfigKeys.STUDENT_SELF_EVALUATION_WEIGHT, "0.2"));
```

**使用场景**：
- 合作企业实习的综合成绩计算
- 公式：综合成绩 = 企业评价×40% + 学校评价×40% + 自评×20%

**状态**：✅ **已使用**

---

### 1.4 评价权重配置键总结

| 配置键 | 配置值 | 使用状态 | 使用位置 | 说明 |
|--------|--------|----------|----------|------|
| `enterprise_evaluation_weight` | 0.4 | ✅ 已使用 | `ComprehensiveScoreServiceImpl.java:123` | 企业评价权重（合作企业实习） |
| `school_evaluation_weight` | 0.4 | ✅ 已使用 | `ComprehensiveScoreServiceImpl.java:124` | 学校评价权重（合作企业实习） |
| `student_self_evaluation_weight` | 0.2 | ✅ 已使用 | `ComprehensiveScoreServiceImpl.java:125` | 学生自评权重（合作企业实习） |

**注意事项**：
- 这些配置键**仅用于合作企业实习**的综合成绩计算
- **自主实习不使用这些配置键**，而是使用固定权重（学校60% + 自评40%）
- 权重总和必须等于1.0（代码中有验证）

---

## 二、分享码配置键

### 2.1 share_code_expire_days（分享码有效期）

**配置值**：30（天）

**使用位置**：
- ✅ `ClassServiceImpl.java` 第358行（`generateShareCode` 方法）
- ✅ `ClassServiceImpl.java` 第379行（`regenerateShareCode` 方法）

**代码示例**：
```java
int expireDays = SystemConfigUtil.getConfigValueInt(ConfigKeys.SHARE_CODE_EXPIRE_DAYS, Constants.SHARE_CODE_EXPIRE_DAYS);
LocalDateTime expireTime = now.plusDays(expireDays);
```

**使用场景**：
- 生成班级分享码时，设置分享码的过期时间
- 重新生成分享码时，设置新的过期时间

**状态**：✅ **已使用**

---

### 2.2 share_code_length（分享码长度）

**配置值**：8（位）

**使用位置**：
- ✅ `ClassServiceImpl.java` 第467行（`generateUniqueShareCode` 方法）

**代码示例**：
```java
int shareCodeLength = SystemConfigUtil.getConfigValueInt(ConfigKeys.SHARE_CODE_LENGTH, Constants.SHARE_CODE_LENGTH);
for (int i = 0; i < shareCodeLength; i++) {
    sb.append(CHARACTERS.charAt(random.nextInt(CHARACTERS.length())));
}
```

**使用场景**：
- 生成班级分享码时，确定分享码的长度（字符数）

**状态**：✅ **已使用**

---

### 2.3 分享码配置键总结

| 配置键 | 配置值 | 使用状态 | 使用位置 | 说明 |
|--------|--------|----------|----------|------|
| `share_code_expire_days` | 30 | ✅ 已使用 | `ClassServiceImpl.java:358, 379` | 分享码有效期（天） |
| `share_code_length` | 8 | ✅ 已使用 | `ClassServiceImpl.java:467` | 分享码长度（字符数） |

**注意事项**：
- 这些配置键用于班级分享码功能
- 如果配置不存在，会使用 `Constants` 类中的默认值
- 默认值：`SHARE_CODE_EXPIRE_DAYS = 30`，`SHARE_CODE_LENGTH = 8`

---

## 三、总体检查结果

### 3.1 配置键使用情况汇总

| 配置键 | 配置值 | 配置类型 | 使用状态 | 使用位置 |
|--------|--------|----------|----------|----------|
| `enterprise_evaluation_weight` | 0.4 | evaluation | ✅ 已使用 | `ComprehensiveScoreServiceImpl.java:123` |
| `school_evaluation_weight` | 0.4 | evaluation | ✅ 已使用 | `ComprehensiveScoreServiceImpl.java:124` |
| `student_self_evaluation_weight` | 0.2 | evaluation | ✅ 已使用 | `ComprehensiveScoreServiceImpl.java:125` |
| `share_code_expire_days` | 30 | share_code | ✅ 已使用 | `ClassServiceImpl.java:358, 379` |
| `share_code_length` | 8 | share_code | ✅ 已使用 | `ClassServiceImpl.java:467` |

### 3.2 检查结论

**✅ 所有配置键都已正确使用**

1. **评价权重配置键**（3个）：
   - 全部在 `ComprehensiveScoreServiceImpl.java` 中使用
   - 用于合作企业实习的综合成绩计算
   - 代码中有权重总和验证（必须等于1.0）

2. **分享码配置键**（2个）：
   - 全部在 `ClassServiceImpl.java` 中使用
   - 用于班级分享码的生成和管理
   - 有默认值作为后备方案

### 3.3 建议

1. **配置键管理**：
   - ✅ 所有配置键都有对应的常量定义（`ConfigKeys.java`）
   - ✅ 所有配置键都有默认值作为后备方案
   - ✅ 配置键的使用位置明确，易于维护

2. **功能完整性**：
   - ✅ 评价权重配置键支持动态调整综合成绩计算公式
   - ✅ 分享码配置键支持动态调整分享码的生成规则

3. **代码质量**：
   - ✅ 使用 `SystemConfigUtil` 统一读取配置
   - ✅ 有默认值处理，避免配置缺失导致的错误
   - ✅ 代码注释清晰，易于理解

---

## 四、相关文件清单

### 4.1 配置键定义文件
- `internship-server/src/main/java/com/server/internshipserver/common/constant/ConfigKeys.java`

### 4.2 配置键使用文件
- `internship-server/src/main/java/com/server/internshipserver/service/impl/evaluation/ComprehensiveScoreServiceImpl.java`
- `internship-server/src/main/java/com/server/internshipserver/service/impl/system/ClassServiceImpl.java`

### 4.3 默认值定义文件
- `internship-server/src/main/java/com/server/internshipserver/common/constant/Constants.java`

---

**检查完成时间**：2025-01-XX
**检查结果**：✅ 所有配置键都已正确使用，无需修改

