# 权限控制说明文档

**文档版本**：v1.0  
**更新日期**：2024年  
**说明**：本文档详细说明系统中不同角色登录后能够访问的菜单、页面和按钮权限。

---

## 一、系统角色定义

系统共定义了 **8种角色**：

| 角色代码 | 角色名称 | 角色描述 |
|---------|---------|---------|
| `ROLE_SYSTEM_ADMIN` | 系统管理员 | 拥有系统最高权限，可管理所有数据 |
| `ROLE_SCHOOL_ADMIN` | 学校管理员 | 管理本校的所有数据 |
| `ROLE_COLLEGE_LEADER` | 学院负责人 | 管理本学院的所有数据 |
| `ROLE_CLASS_TEACHER` | 班主任 | 管理本班的学生数据 |
| `ROLE_INSTRUCTOR` | 指导教师 | 指导学生的实习活动 |
| `ROLE_ENTERPRISE_ADMIN` | 企业管理员 | 管理企业的实习相关数据 |
| `ROLE_ENTERPRISE_MENTOR` | 企业导师 | 指导学生的企业实习 |
| `ROLE_STUDENT` | 学生 | 学生用户，查看和管理自己的数据 |

---

## 二、菜单权限说明

### 2.1 菜单结构

系统菜单分为以下模块：
- **首页**：所有登录用户可见
- **系统管理**：系统基础数据管理
- **用户管理**：用户、学生、教师管理

### 2.2 菜单权限详情

#### 2.2.1 首页
- **路径**：`/dashboard`
- **可见角色**：所有登录用户
- **权限要求**：`requiresAuth: true`

#### 2.2.2 系统管理模块

**系统管理菜单**（父菜单）：
- **可见角色**：`ROLE_SYSTEM_ADMIN`、`ROLE_SCHOOL_ADMIN`、`ROLE_COLLEGE_LEADER`、`ROLE_CLASS_TEACHER`

**子菜单项**：

| 菜单项 | 路径 | 可见角色 |
|-------|------|---------|
| 学校管理 | `/admin/system/school` | `ROLE_SYSTEM_ADMIN` |
| 学院管理 | `/admin/system/college` | `ROLE_SYSTEM_ADMIN`、`ROLE_SCHOOL_ADMIN` |
| 专业管理 | `/admin/system/major` | `ROLE_SYSTEM_ADMIN`、`ROLE_SCHOOL_ADMIN`、`ROLE_COLLEGE_LEADER` |
| 班级管理 | `/admin/system/class` | `ROLE_SYSTEM_ADMIN`、`ROLE_SCHOOL_ADMIN`、`ROLE_COLLEGE_LEADER`、`ROLE_CLASS_TEACHER` |
| 学期管理 | `/admin/system/semester` | `ROLE_SYSTEM_ADMIN`、`ROLE_SCHOOL_ADMIN` |
| 系统配置 | `/admin/system/config` | `ROLE_SYSTEM_ADMIN`、`ROLE_SCHOOL_ADMIN` |
| 班主任任命 | `/admin/system/class-teacher` | `ROLE_SYSTEM_ADMIN`、`ROLE_COLLEGE_LEADER` |

#### 2.2.3 用户管理模块

**用户管理菜单**（父菜单）：
- **可见角色**：`ROLE_SYSTEM_ADMIN`、`ROLE_SCHOOL_ADMIN`、`ROLE_COLLEGE_LEADER`、`ROLE_CLASS_TEACHER`

**子菜单项**：

| 菜单项 | 路径 | 可见角色 |
|-------|------|---------|
| 用户管理 | `/admin/user` | `ROLE_SYSTEM_ADMIN`、`ROLE_SCHOOL_ADMIN`、`ROLE_COLLEGE_LEADER`、`ROLE_CLASS_TEACHER` |
| 学生管理 | `/admin/student` | `ROLE_SYSTEM_ADMIN`、`ROLE_CLASS_TEACHER` |
| 教师管理 | `/admin/teacher` | `ROLE_SYSTEM_ADMIN`、`ROLE_SCHOOL_ADMIN`、`ROLE_COLLEGE_LEADER` |

---

## 三、页面权限说明

### 3.1 系统管理页面

#### 3.1.1 学校管理 (`/admin/system/school`)
- **后端权限**：`@PreAuthorize("hasRole('ROLE_SYSTEM_ADMIN')")`
- **可见角色**：`ROLE_SYSTEM_ADMIN`
- **功能按钮**：
  - ✅ 添加学校
  - ✅ 编辑学校
  - ✅ 停用学校
  - ✅ 查询学校
- **数据权限**：可查看所有学校数据

#### 3.1.2 学院管理 (`/admin/system/college`)
- **后端权限**：
  - 查询：`@PreAuthorize("hasAnyRole('ROLE_SYSTEM_ADMIN', 'ROLE_SCHOOL_ADMIN')")`
  - 添加/编辑/删除：`@PreAuthorize("hasAnyRole('ROLE_SYSTEM_ADMIN', 'ROLE_SCHOOL_ADMIN')")`
- **可见角色**：`ROLE_SYSTEM_ADMIN`、`ROLE_SCHOOL_ADMIN`
- **功能按钮**：
  - ✅ 添加学院
  - ✅ 编辑学院
  - ✅ 停用学院
  - ✅ 查询学院
- **数据权限**：
  - 系统管理员：可查看所有学院
  - 学校管理员：只能查看本校的学院

#### 3.1.3 专业管理 (`/admin/system/major`)
- **后端权限**：
  - 查询：`@PreAuthorize("hasAnyRole('ROLE_SYSTEM_ADMIN', 'ROLE_SCHOOL_ADMIN', 'ROLE_COLLEGE_LEADER', 'ROLE_CLASS_TEACHER')")`
  - 添加/编辑/删除：`@PreAuthorize("hasAnyRole('ROLE_SYSTEM_ADMIN', 'ROLE_SCHOOL_ADMIN', 'ROLE_COLLEGE_LEADER')")`
- **可见角色**：`ROLE_SYSTEM_ADMIN`、`ROLE_SCHOOL_ADMIN`、`ROLE_COLLEGE_LEADER`、`ROLE_CLASS_TEACHER`
- **功能按钮**：
  - ✅ 添加专业（系统管理员、学校管理员、学院负责人可见）
  - ✅ 编辑专业（系统管理员、学校管理员、学院负责人可见）
  - ✅ 停用专业（系统管理员、学校管理员、学院负责人可见）
  - ✅ 查询专业（所有可见角色）
- **数据权限**：
  - 系统管理员：可查看所有专业
  - 学校管理员：只能查看本校的专业
  - 学院负责人：只能查看本学院的专业
  - 班主任：只能查看本学院的专业（只读）

#### 3.1.4 班级管理 (`/admin/system/class`)
- **后端权限**：
  - 查询：`@PreAuthorize("hasAnyRole('ROLE_SYSTEM_ADMIN', 'ROLE_SCHOOL_ADMIN', 'ROLE_COLLEGE_LEADER', 'ROLE_CLASS_TEACHER', 'ROLE_STUDENT')")`
  - 添加/编辑/删除：`@PreAuthorize("hasAnyRole('ROLE_SYSTEM_ADMIN', 'ROLE_SCHOOL_ADMIN', 'ROLE_COLLEGE_LEADER', 'ROLE_CLASS_TEACHER')")`
  - 分享码管理：`@PreAuthorize("hasAnyRole('ROLE_SYSTEM_ADMIN', 'ROLE_CLASS_TEACHER')")`
  - 班主任任命：`@PreAuthorize("hasAnyRole('ROLE_SYSTEM_ADMIN', 'ROLE_COLLEGE_LEADER')")`
- **可见角色**：`ROLE_SYSTEM_ADMIN`、`ROLE_SCHOOL_ADMIN`、`ROLE_COLLEGE_LEADER`、`ROLE_CLASS_TEACHER`
- **功能按钮**：
  - ✅ 添加班级（系统管理员、学校管理员、学院负责人、班主任可见）
  - ✅ 编辑班级（系统管理员、学校管理员、学院负责人、班主任可见）
  - ✅ 停用班级（系统管理员、学校管理员、学院负责人、班主任可见）
  - ✅ 分享码管理（系统管理员、班主任可见）
  - ✅ 查询班级（所有可见角色）
- **数据权限**：
  - 系统管理员：可查看所有班级
  - 学校管理员：只能查看本校的班级
  - 学院负责人：只能查看本学院的班级
  - 班主任：只能查看本班的班级

#### 3.1.5 学期管理 (`/admin/system/semester`)
- **后端权限**：
  - 查询：`@PreAuthorize("hasAnyRole('ROLE_SYSTEM_ADMIN', 'ROLE_SCHOOL_ADMIN')")`
  - 添加/编辑/删除：`@PreAuthorize("hasRole('ROLE_SYSTEM_ADMIN')")`
- **可见角色**：`ROLE_SYSTEM_ADMIN`、`ROLE_SCHOOL_ADMIN`
- **功能按钮**：
  - ✅ 添加学期（仅系统管理员）
  - ✅ 编辑学期（仅系统管理员）
  - ✅ 删除学期（仅系统管理员）
  - ✅ 查询学期（系统管理员、学校管理员）
- **数据权限**：可查看所有学期数据

#### 3.1.6 系统配置 (`/admin/system/config`)
- **后端权限**：
  - 查询：`@PreAuthorize("hasAnyRole('ROLE_SYSTEM_ADMIN', 'ROLE_SCHOOL_ADMIN')")`
  - 添加/编辑/删除：`@PreAuthorize("hasAnyRole('ROLE_SYSTEM_ADMIN', 'ROLE_SCHOOL_ADMIN')")`
- **可见角色**：`ROLE_SYSTEM_ADMIN`、`ROLE_SCHOOL_ADMIN`
- **功能按钮**：
  - ✅ 添加配置
  - ✅ 编辑配置
  - ✅ 删除配置
  - ✅ 查询配置
- **数据权限**：可查看所有配置数据

#### 3.1.7 班主任任命 (`/admin/system/class-teacher`)
- **后端权限**：`@PreAuthorize("hasAnyRole('ROLE_SYSTEM_ADMIN', 'ROLE_COLLEGE_LEADER')")`
- **可见角色**：`ROLE_SYSTEM_ADMIN`、`ROLE_COLLEGE_LEADER`
- **功能按钮**：
  - ✅ 任命班主任
  - ✅ 取消班主任任命
  - ✅ 查询班级列表
- **数据权限**：
  - 系统管理员：可查看所有班级
  - 学院负责人：只能查看本学院的班级

### 3.2 用户管理页面

#### 3.2.1 用户管理 (`/admin/user`)
- **后端权限**：
  - 查询：`@PreAuthorize("hasAuthority('user:view')")`
  - 添加：`@PreAuthorize("hasAuthority('user:add')")`
  - 编辑：`@PreAuthorize("hasAuthority('user:edit')")`
  - 删除：`@PreAuthorize("hasAuthority('user:delete')")`
  - 重置密码：`@PreAuthorize("hasAuthority('user:resetPassword')")`
- **可见角色**：`ROLE_SYSTEM_ADMIN`、`ROLE_SCHOOL_ADMIN`、`ROLE_COLLEGE_LEADER`、`ROLE_CLASS_TEACHER`
- **功能按钮**：
  - ✅ 添加用户
  - ✅ 批量导入（跳转到学生管理页面）
  - ✅ 编辑用户
  - ✅ 重置密码
  - ✅ 停用用户
  - ✅ 查询用户
- **数据权限**：
  - 系统管理员：可查看所有用户
  - 学校管理员：只能查看本校的用户
  - 学院负责人：只能查看本学院的用户
  - 班主任：只能查看本班的学生用户

#### 3.2.2 学生管理 (`/admin/student`)
- **后端权限**：
  - 查询：`@PreAuthorize("hasAuthority('user:view')")`
  - 添加：`@PreAuthorize("hasAuthority('user:add')")`
  - 编辑：`@PreAuthorize("hasAuthority('user:edit')")`
  - 删除：`@PreAuthorize("hasAuthority('user:delete')")`
  - 批量导入：`@PreAuthorize("hasAnyRole('ROLE_SYSTEM_ADMIN', 'ROLE_CLASS_TEACHER')")`
  - 审核：`@PreAuthorize("hasAnyRole('ROLE_SYSTEM_ADMIN', 'ROLE_CLASS_TEACHER')")`
- **可见角色**：`ROLE_SYSTEM_ADMIN`、`ROLE_CLASS_TEACHER`
- **功能Tab**：
  - **Tab 1: 学生列表**
    - ✅ 添加学生
    - ✅ 编辑学生
    - ✅ 停用学生
    - ✅ 查看学生详情
    - ✅ 查询学生（学号、班级）
  - **Tab 2: 待审核学生**
    - ✅ 审核通过
    - ✅ 审核拒绝
    - ✅ 查看学生详情
    - ✅ 查询待审核学生（学号、姓名）
  - **Tab 3: 批量导入**
    - ✅ 下载模板
    - ✅ 上传Excel文件
    - ✅ 选择班级
    - ✅ 查看导入结果
- **数据权限**：
  - 系统管理员：可查看所有学生
  - 班主任：只能查看本班的学生

#### 3.2.3 教师管理 (`/admin/teacher`)
- **后端权限**：
  - 查询：`@PreAuthorize("hasAuthority('user:view')")`
  - 添加：`@PreAuthorize("hasAuthority('user:add')")`
  - 编辑：`@PreAuthorize("hasAuthority('user:edit')")`
  - 删除：`@PreAuthorize("hasAuthority('user:delete')")`
- **可见角色**：`ROLE_SYSTEM_ADMIN`、`ROLE_SCHOOL_ADMIN`、`ROLE_COLLEGE_LEADER`
- **功能按钮**：
  - ✅ 添加教师（自动创建用户）
  - ✅ 编辑教师（同时更新用户信息）
  - ✅ 停用教师
  - ✅ 查询教师（工号、学院）
- **数据权限**：
  - 系统管理员：可查看所有教师
  - 学校管理员：只能查看本校的教师
  - 学院负责人：只能查看本学院的教师

### 3.3 注册页面

#### 3.3.1 学生注册 (`/register/student`)
- **后端权限**：无需认证（公开页面）
- **可见角色**：所有用户（包括未登录用户）
- **功能**：
  - ✅ 使用分享码注册
  - ✅ 填写学生信息
  - ✅ 提交注册申请（待审核状态）

#### 3.3.2 企业注册 (`/register/enterprise`)
- **后端权限**：无需认证（公开页面）
- **可见角色**：所有用户（包括未登录用户）
- **功能**：
  - ✅ 填写企业信息
  - ✅ 提交注册申请

---

## 四、各角色权限汇总

### 4.1 系统管理员 (ROLE_SYSTEM_ADMIN)

#### 可见菜单
- ✅ 首页
- ✅ 系统管理
  - ✅ 学校管理
  - ✅ 学院管理
  - ✅ 专业管理
  - ✅ 班级管理
  - ✅ 学期管理
  - ✅ 系统配置
  - ✅ 班主任任命
- ✅ 用户管理
  - ✅ 用户管理
  - ✅ 学生管理
  - ✅ 教师管理

#### 可访问页面
- ✅ `/dashboard` - 首页
- ✅ `/admin/system/school` - 学校管理
- ✅ `/admin/system/college` - 学院管理
- ✅ `/admin/system/major` - 专业管理
- ✅ `/admin/system/class` - 班级管理
- ✅ `/admin/system/semester` - 学期管理
- ✅ `/admin/system/config` - 系统配置
- ✅ `/admin/system/class-teacher` - 班主任任命
- ✅ `/admin/user` - 用户管理
- ✅ `/admin/student` - 学生管理
- ✅ `/admin/teacher` - 教师管理

#### 功能权限
- ✅ **所有数据的增删改查**
- ✅ **无数据权限限制**（可查看所有数据）
- ✅ **所有功能按钮可用**

---

### 4.2 学校管理员 (ROLE_SCHOOL_ADMIN)

#### 可见菜单
- ✅ 首页
- ✅ 系统管理
  - ✅ 学院管理
  - ✅ 专业管理
  - ✅ 班级管理
  - ✅ 学期管理
  - ✅ 系统配置
- ✅ 用户管理
  - ✅ 用户管理
  - ✅ 教师管理

#### 可访问页面
- ✅ `/dashboard` - 首页
- ✅ `/admin/system/college` - 学院管理
- ✅ `/admin/system/major` - 专业管理
- ✅ `/admin/system/class` - 班级管理
- ✅ `/admin/system/semester` - 学期管理
- ✅ `/admin/system/config` - 系统配置
- ✅ `/admin/user` - 用户管理
- ✅ `/admin/teacher` - 教师管理

#### 功能权限
- ✅ **本校数据的增删改查**
- ✅ **数据权限限制**：只能查看和管理本校的数据
- ✅ **功能按钮**：
  - ✅ 添加/编辑/删除学院
  - ✅ 添加/编辑/删除专业
  - ✅ 添加/编辑/删除班级
  - ✅ 查询学期（只读）
  - ✅ 添加/编辑/删除系统配置
  - ✅ 添加/编辑/删除用户
  - ✅ 添加/编辑/删除教师

---

### 4.3 学院负责人 (ROLE_COLLEGE_LEADER)

#### 可见菜单
- ✅ 首页
- ✅ 系统管理
  - ✅ 专业管理
  - ✅ 班级管理
  - ✅ 班主任任命
- ✅ 用户管理
  - ✅ 用户管理
  - ✅ 教师管理

#### 可访问页面
- ✅ `/dashboard` - 首页
- ✅ `/admin/system/major` - 专业管理
- ✅ `/admin/system/class` - 班级管理
- ✅ `/admin/system/class-teacher` - 班主任任命
- ✅ `/admin/user` - 用户管理
- ✅ `/admin/teacher` - 教师管理

#### 功能权限
- ✅ **本院数据的增删改查**
- ✅ **数据权限限制**：只能查看和管理本院的数据
- ✅ **功能按钮**：
  - ✅ 添加/编辑/删除专业
  - ✅ 添加/编辑/删除班级
  - ✅ 任命/取消班主任
  - ✅ 添加/编辑/删除用户（本院）
  - ✅ 添加/编辑/删除教师（本院）

---

### 4.4 班主任 (ROLE_CLASS_TEACHER)

#### 可见菜单
- ✅ 首页
- ✅ 系统管理
  - ✅ 专业管理（只读）
  - ✅ 班级管理
- ✅ 用户管理
  - ✅ 用户管理
  - ✅ 学生管理

#### 可访问页面
- ✅ `/dashboard` - 首页
- ✅ `/admin/system/major` - 专业管理（只读）
- ✅ `/admin/system/class` - 班级管理
- ✅ `/admin/user` - 用户管理
- ✅ `/admin/student` - 学生管理

#### 功能权限
- ✅ **本班数据的增删改查**
- ✅ **数据权限限制**：只能查看和管理本班的数据
- ✅ **功能按钮**：
  - ✅ 查询专业（只读）
  - ✅ 查看班级信息
  - ✅ 生成/查看分享码
  - ✅ 添加/编辑/删除用户（本班学生）
  - ✅ 添加/编辑/删除学生（本班）
  - ✅ 批量导入学生
  - ✅ 审核学生注册申请

---

### 4.5 指导教师 (ROLE_INSTRUCTOR)

#### 可见菜单
- ✅ 首页
- ❌ 系统管理（不可见）
- ❌ 用户管理（不可见）

#### 可访问页面
- ✅ `/dashboard` - 首页
- ❌ 其他管理页面（不可访问）

#### 功能权限
- ⚠️ **待开发**：实习指导相关功能
- ⚠️ **待开发**：学生实习管理功能

---

### 4.6 企业管理员 (ROLE_ENTERPRISE_ADMIN)

#### 可见菜单
- ✅ 首页
- ❌ 系统管理（不可见）
- ❌ 用户管理（不可见）

#### 可访问页面
- ✅ `/dashboard` - 首页
- ❌ 其他管理页面（不可访问）

#### 功能权限
- ⚠️ **待开发**：企业管理相关功能
- ⚠️ **待开发**：实习岗位管理功能

---

### 4.7 企业导师 (ROLE_ENTERPRISE_MENTOR)

#### 可见菜单
- ✅ 首页
- ❌ 系统管理（不可见）
- ❌ 用户管理（不可见）

#### 可访问页面
- ✅ `/dashboard` - 首页
- ❌ 其他管理页面（不可访问）

#### 功能权限
- ⚠️ **待开发**：实习指导相关功能
- ⚠️ **待开发**：学生评价功能

---

### 4.8 学生 (ROLE_STUDENT)

#### 可见菜单
- ✅ 首页
- ❌ 系统管理（不可见）
- ❌ 用户管理（不可见）

#### 可访问页面
- ✅ `/dashboard` - 首页
- ✅ `/register/student` - 学生注册（未登录时）
- ❌ 其他管理页面（不可访问）

#### 功能权限
- ⚠️ **待开发**：实习申请功能
- ⚠️ **待开发**：个人信息管理功能
- ⚠️ **待开发**：实习报告提交功能

---

## 五、数据权限说明

### 5.1 数据权限过滤规则

系统实现了**数据级权限过滤**，不同角色在查询数据时自动添加过滤条件：

#### 5.1.1 学校管理员
- **过滤条件**：`school_id = 当前用户学校ID`
- **适用范围**：所有数据查询
- **实现方式**：在Service层使用`DataPermissionUtil.getCurrentUserSchoolId()`

#### 5.1.2 学院负责人
- **过滤条件**：`college_id = 当前用户学院ID`
- **适用范围**：所有数据查询
- **实现方式**：在Service层使用`DataPermissionUtil.getCurrentUserCollegeId()`

#### 5.1.3 班主任
- **过滤条件**：`class_id = 当前用户班级ID`
- **适用范围**：学生数据查询
- **实现方式**：在Service层使用`DataPermissionUtil.getCurrentUserClassId()`

#### 5.1.4 系统管理员
- **过滤条件**：无（可查看所有数据）
- **适用范围**：所有数据查询

### 5.2 数据权限实现位置

数据权限过滤在以下Service实现类中：
- `UserServiceImpl.getUserPage()` - 用户列表查询
- `StudentServiceImpl.getStudentPage()` - 学生列表查询
- `TeacherServiceImpl.getTeacherPage()` - 教师列表查询
- `ClassServiceImpl.getClassPage()` - 班级列表查询
- `MajorServiceImpl.getMajorPage()` - 专业列表查询
- `CollegeServiceImpl.getCollegePage()` - 学院列表查询

---

## 六、权限标识说明

### 6.1 权限标识格式

系统使用权限标识（Permission）控制功能级权限，格式为：`模块:功能:操作`

**示例**：
- `user:view` - 用户查看权限
- `user:add` - 用户添加权限
- `user:edit` - 用户编辑权限
- `user:delete` - 用户删除权限
- `user:resetPassword` - 用户重置密码权限

### 6.2 权限与角色的关系

权限通过**角色权限关联表**（`role_permission`）分配给角色，用户通过**用户角色关联表**（`user_role`）获得角色，从而获得权限。

**权限获取流程**：
1. 用户登录后，系统查询用户的角色列表
2. 根据角色列表，查询所有角色的权限列表
3. 合并权限列表，存入Redis缓存（2小时过期）
4. 前端根据权限列表控制按钮显示
5. 后端根据权限列表控制接口访问

---

## 七、前端权限控制实现

### 7.1 路由权限控制

**实现位置**：`internship-web/src/router/index.js`

**控制方式**：
```javascript
// 路由配置
{
  path: '/admin/student',
  meta: {
    roles: ['ROLE_SYSTEM_ADMIN', 'ROLE_CLASS_TEACHER']
  }
}

// 路由守卫检查
if (to.meta.roles && to.meta.roles.length > 0) {
  const userRoles = authStore.userInfo?.roles || []
  if (!hasAnyRole(userRoles, to.meta.roles)) {
    next('/403') // 跳转到403页面
    return
  }
}
```

### 7.2 菜单权限控制

**实现位置**：`internship-web/src/components/common/MainLayout.vue`

**控制方式**：
```vue
<el-menu-item 
  index="/admin/student" 
  v-if="hasAnyRole(userRoles, ['ROLE_SYSTEM_ADMIN', 'ROLE_CLASS_TEACHER'])"
>
  学生管理
</el-menu-item>
```

### 7.3 按钮权限控制

**当前实现**：页面内的按钮**没有额外的权限控制**，只要能够访问页面，所有按钮都可见。

**建议改进**：可以添加按钮级权限控制，使用权限指令或组件：
```vue
<el-button v-permission="'user:add'">添加用户</el-button>
```

---

## 八、后端权限控制实现

### 8.1 方法级权限控制

**实现方式**：使用`@PreAuthorize`注解

**示例**：
```java
@PreAuthorize("hasAnyRole('ROLE_SYSTEM_ADMIN', 'ROLE_CLASS_TEACHER')")
public Result<Page<Student>> getStudentPage(...) {
    // ...
}
```

### 8.2 权限表达式

系统支持以下权限表达式：
- `hasRole('ROLE_XXX')` - 必须有指定角色
- `hasAnyRole('ROLE_XXX', 'ROLE_YYY')` - 必须有任意一个角色
- `hasAuthority('permission:code')` - 必须有指定权限
- `hasAnyAuthority('permission1', 'permission2')` - 必须有任意一个权限

---

## 九、权限控制总结表

### 9.1 菜单可见性汇总

| 菜单项 | 系统管理员 | 学校管理员 | 学院负责人 | 班主任 | 指导教师 | 企业管理员 | 企业导师 | 学生 |
|-------|:---------:|:---------:|:---------:|:-----:|:-------:|:---------:|:-------:|:---:|
| 首页 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 学校管理 | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ |
| 学院管理 | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ |
| 专业管理 | ✅ | ✅ | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ |
| 班级管理 | ✅ | ✅ | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ |
| 学期管理 | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ |
| 系统配置 | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ |
| 班主任任命 | ✅ | ❌ | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ |
| 用户管理 | ✅ | ✅ | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ |
| 学生管理 | ✅ | ❌ | ❌ | ✅ | ❌ | ❌ | ❌ | ❌ |
| 教师管理 | ✅ | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ |

### 9.2 功能按钮权限汇总

| 功能 | 系统管理员 | 学校管理员 | 学院负责人 | 班主任 |
|-----|:---------:|:---------:|:---------:|:-----:|
| 添加学校 | ✅ | ❌ | ❌ | ❌ |
| 添加学院 | ✅ | ✅ | ❌ | ❌ |
| 添加专业 | ✅ | ✅ | ✅ | ❌ |
| 添加班级 | ✅ | ✅ | ✅ | ✅ |
| 生成分享码 | ✅ | ❌ | ❌ | ✅ |
| 任命班主任 | ✅ | ❌ | ✅ | ❌ |
| 添加用户 | ✅ | ✅ | ✅ | ✅ |
| 添加学生 | ✅ | ❌ | ❌ | ✅ |
| 批量导入学生 | ✅ | ❌ | ❌ | ✅ |
| 审核学生 | ✅ | ❌ | ❌ | ✅ |
| 添加教师 | ✅ | ✅ | ✅ | ❌ |

### 9.3 数据权限汇总

| 数据类型 | 系统管理员 | 学校管理员 | 学院负责人 | 班主任 |
|---------|:---------:|:---------:|:---------:|:-----:|
| 学校数据 | 全部 | 本校 | 本院所属学校 | 本班所属学校 |
| 学院数据 | 全部 | 本校 | 本院 | 本班所属学院 |
| 专业数据 | 全部 | 本校 | 本院 | 本班所属专业 |
| 班级数据 | 全部 | 本校 | 本院 | 本班 |
| 学生数据 | 全部 | 本校 | 本院 | 本班 |
| 教师数据 | 全部 | 本校 | 本院 | 不可见 |
| 用户数据 | 全部 | 本校 | 本院 | 本班学生 |

---

## 十、注意事项

### 10.1 权限控制层级

系统采用**三层权限控制**：
1. **路由级权限**：控制页面访问（前端路由守卫）
2. **菜单级权限**：控制菜单显示（前端菜单渲染）
3. **接口级权限**：控制接口访问（后端`@PreAuthorize`）
4. **数据级权限**：控制数据范围（后端Service层过滤）

### 10.2 权限缓存

- **权限缓存时间**：2小时
- **缓存Key格式**：`permission:user:{userId}`
- **缓存清除时机**：用户角色变更时自动清除

### 10.3 权限验证顺序

1. **前端路由守卫**：检查用户是否登录、是否有角色权限
2. **后端接口验证**：检查用户是否有权限访问接口
3. **数据权限过滤**：在Service层自动添加数据过滤条件

### 10.4 待完善功能

以下角色的功能**待开发**：
- `ROLE_INSTRUCTOR` - 指导教师功能
- `ROLE_ENTERPRISE_ADMIN` - 企业管理功能
- `ROLE_ENTERPRISE_MENTOR` - 企业导师功能
- `ROLE_STUDENT` - 学生端功能

---

## 十一、权限测试建议

### 11.1 测试场景

建议按以下场景测试权限控制：

1. **菜单显示测试**：
   - 使用不同角色登录，检查菜单显示是否正确
   - 确认无权限的菜单不显示

2. **页面访问测试**：
   - 直接访问无权限的页面URL，应跳转到403页面
   - 确认有权限的页面可以正常访问

3. **按钮功能测试**：
   - 检查按钮是否显示
   - 检查按钮功能是否正常
   - 确认无权限的操作会返回错误

4. **数据权限测试**：
   - 使用不同角色查询数据，确认只能看到权限范围内的数据
   - 确认跨权限的数据操作会失败

### 11.2 测试账号建议

建议创建以下测试账号：
- 系统管理员账号（1个）
- 学校管理员账号（每个学校1个）
- 学院负责人账号（每个学院1个）
- 班主任账号（每个班级1个）
- 学生账号（每个班级多个）

---

**文档结束**

