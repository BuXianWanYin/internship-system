# 合作企业实习申请学校审核方案

## 一、当前情况分析

### 1.1 现状
- **自主实习申请**：需要学校审核（系统管理员、学校管理员、学院负责人、班主任可以审核）
- **合作企业申请**：目前由企业管理员直接处理，不需要学校审核

### 1.2 问题
- 学校无法对合作企业申请进行审核和把关
- 可能存在学生申请不符合学校要求的情况
- 缺乏学校层面的统一管理

---

## 二、方案对比

### 方案一：双重审核机制（推荐）

**流程：**
```
学生提交合作企业申请（status=0，待学校审核）
    ↓
学校审核（系统管理员/学校管理员/学院负责人/班主任）
    ├─ 通过 → status=1（学校审核通过，等待企业处理）
    └─ 拒绝 → status=2（学校审核拒绝）
    ↓
企业筛选操作（仅当status=1时）
    ├─ action=1: 标记感兴趣
    ├─ action=2: 安排面试
    ├─ action=3: 直接录用（status=3，已录用）
    └─ action=4: 拒绝录用（status=4，已拒绝录用）
```

**优点：**
- ✅ 学校可以统一把关所有实习申请
- ✅ 确保学生申请符合学校要求
- ✅ 流程清晰，责任明确
- ✅ 与自主实习申请流程一致

**缺点：**
- ⚠️ 增加审核环节，可能延长流程时间
- ⚠️ 需要修改现有代码逻辑

**实现难度：** ⭐⭐⭐（中等）

**数据库变更：**
- 无需新增字段，使用现有的 `status`、`audit_user_id`、`audit_time`、`audit_opinion` 字段

---

### 方案二：可选学校审核机制

**流程：**
```
学生提交合作企业申请（status=0，待学校审核）
    ↓
学校审核（可选，系统管理员可配置是否需要审核）
    ├─ 需要审核 → 学校审核通过后，status=1（等待企业处理）
    ├─ 不需要审核 → 直接 status=1（等待企业处理）
    └─ 审核拒绝 → status=2（已拒绝）
    ↓
企业筛选操作（仅当status=1时）
```

**优点：**
- ✅ 灵活性强，可根据实际情况配置
- ✅ 对于信任的合作企业可以跳过审核
- ✅ 保留学校审核的权限

**缺点：**
- ⚠️ 需要新增配置字段
- ⚠️ 逻辑相对复杂
- ⚠️ 可能造成流程不一致

**实现难度：** ⭐⭐⭐⭐（较难）

**数据库变更：**
- 需要在 `enterprise` 表或系统配置表中新增字段：`require_school_audit`（是否需要学校审核）

---

### 方案三：企业审核后学校确认机制

**流程：**
```
学生提交合作企业申请（status=0，待企业处理）
    ↓
企业筛选操作
    ├─ action=3: 直接录用 → status=3（已录用，待学校确认）
    └─ action=4: 拒绝录用 → status=4（已拒绝录用）
    ↓
学校确认（仅当status=3时）
    ├─ 确认 → status=3（已录用，最终状态）
    └─ 拒绝 → status=2（学校拒绝，最终状态）
```

**优点：**
- ✅ 企业有优先筛选权
- ✅ 学校保留最终决定权
- ✅ 减少不必要的审核环节

**缺点：**
- ⚠️ 企业已录用但学校可能拒绝，可能影响企业体验
- ⚠️ 流程相对复杂
- ⚠️ 需要新增状态值

**实现难度：** ⭐⭐⭐⭐（较难）

**数据库变更：**
- 需要新增状态值：`5-已录用待学校确认`
- 或使用现有字段组合判断

---

### 方案四：分阶段审核机制

**流程：**
```
学生提交合作企业申请（status=0，待学校初审）
    ↓
学校初审（系统管理员/学校管理员）
    ├─ 通过 → status=1（学校初审通过，等待企业处理）
    └─ 拒绝 → status=2（学校初审拒绝）
    ↓
企业筛选操作（仅当status=1时）
    ├─ action=3: 直接录用 → status=3（已录用，待学校终审）
    └─ action=4: 拒绝录用 → status=4（已拒绝录用）
    ↓
学校终审（仅当status=3时，系统管理员/学校管理员）
    ├─ 确认 → status=3（已录用，最终状态）
    └─ 拒绝 → status=2（学校终审拒绝，最终状态）
```

**优点：**
- ✅ 学校可以全程把控
- ✅ 初审可以快速筛选，终审可以最终把关
- ✅ 流程完整，管理严格

**缺点：**
- ⚠️ 审核环节最多，流程最长
- ⚠️ 需要新增状态值或审核阶段字段
- ⚠️ 实现复杂度最高

**实现难度：** ⭐⭐⭐⭐⭐（困难）

**数据库变更：**
- 需要新增字段：`audit_stage`（审核阶段：1-初审，2-终审）
- 或新增状态值：`5-已录用待学校终审`

---

## 三、推荐方案：方案一（双重审核机制）

### 3.1 推荐理由

1. **流程清晰**：与自主实习申请流程一致，易于理解和维护
2. **实现简单**：无需新增数据库字段，只需修改业务逻辑
3. **管理规范**：学校可以统一把关所有实习申请
4. **用户体验好**：流程明确，不会造成混乱

### 3.2 实现步骤

#### 步骤1：修改后端审核逻辑

**文件：** `InternshipApplyServiceImpl.java`

```java
// 修改 auditApply 方法，允许审核合作企业申请
public boolean auditApply(Long applyId, Integer auditStatus, String auditOpinion) {
    // ... 现有验证逻辑 ...
    
    // 修改：允许审核合作企业和自主实习申请
    // 原逻辑：if (apply.getApplyType() == null || apply.getApplyType() != 2)
    // 新逻辑：允许所有类型的待审核申请
    if (apply.getStatus() == null || apply.getStatus() != 0) {
        throw new BusinessException("只有待审核状态的申请才能审核");
    }
    
    // ... 其余逻辑保持不变 ...
}
```

#### 步骤2：修改前端显示逻辑

**文件：** `InternshipApplyAudit.vue`

```vue
<!-- 修改审核按钮显示条件 -->
<el-button
  v-if="row.status === 0"
  link
  type="success"
  size="small"
  @click="handleAudit(row, 1)"
>
  通过
</el-button>
<el-button
  v-if="row.status === 0"
  link
  type="danger"
  size="small"
  @click="handleAudit(row, 2)"
>
  拒绝
</el-button>
```

#### 步骤3：修改企业筛选逻辑

**文件：** `InternshipApplyServiceImpl.java`

```java
// 修改 filterApply 方法，只允许处理学校审核通过的申请
public boolean filterApply(Long applyId, Integer action, String comment) {
    // ... 现有验证逻辑 ...
    
    // 新增：检查学校审核状态
    if (apply.getStatus() == null || apply.getStatus() != 1) {
        throw new BusinessException("只能处理学校审核通过的申请");
    }
    
    // ... 其余逻辑保持不变 ...
}
```

#### 步骤4：更新状态流转历史

**文件：** `InternshipApplyServiceImpl.java`

```java
// 修改 buildStatusHistory 方法，为合作企业申请添加学校审核历史
private void buildStatusHistory(InternshipApply apply) {
    // ... 现有逻辑 ...
    
    // 合作企业申请：添加学校审核历史
    if (apply.getApplyType() != null && apply.getApplyType() == 1) {
        // 1. 申请提交
        // 2. 学校审核（新增）
        if (apply.getAuditTime() != null) {
            // 添加学校审核历史项
        }
        // 3. 企业处理
        // 4. 面试（如果有）
        // 5. 录用/拒绝
    }
}
```

### 3.3 状态流转图

```
合作企业申请状态流转：
0（待审核） → 学校审核 → 1（已通过，等待企业处理）
                      → 2（已拒绝）

1（已通过） → 企业筛选 → 3（已录用）
                      → 4（已拒绝录用）
                      → 安排面试 → 面试流程 → 3（已录用）或 4（已拒绝录用）
```

---

## 四、其他方案实现要点

### 方案二：可选学校审核机制

**关键实现：**
1. 在 `enterprise` 表新增字段：`require_school_audit`（TINYINT，0-不需要，1-需要）
2. 修改 `addCooperationApply` 方法，根据企业配置决定初始状态
3. 修改前端，根据企业配置显示/隐藏审核按钮

### 方案三：企业审核后学校确认机制

**关键实现：**
1. 新增状态值：`5-已录用待学校确认`
2. 修改 `filterApply` 方法，录用时设置为状态5
3. 新增 `confirmApply` 接口，用于学校确认
4. 修改前端，显示确认按钮

### 方案四：分阶段审核机制

**关键实现：**
1. 新增字段：`audit_stage`（TINYINT，1-初审，2-终审）
2. 修改 `auditApply` 方法，根据阶段设置不同状态
3. 修改前端，区分初审和终审按钮

---

## 五、建议

**推荐采用方案一（双重审核机制）**，理由：
1. 实现简单，无需数据库变更
2. 流程清晰，易于维护
3. 管理规范，符合学校管理需求
4. 与现有自主实习申请流程一致

如果后续需要更灵活的审核机制，可以考虑升级到方案二（可选学校审核机制）。

