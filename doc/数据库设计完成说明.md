# 数据库设计完成说明 - 系统管理模块

## 已完成的工作

### 一、数据库连接

- ✅ 使用 `mcp_mysql_connect_db` 成功建立数据库连接
- ✅ 数据库：`internship_management_db`
- ✅ 连接信息：localhost:3306, root

### 二、创建的表结构

#### 2.1 学校信息表（school_info）
- ✅ 主键：school_id (BIGINT自增)
- ✅ 唯一约束：school_code（学校代码）
- ✅ 字段：学校名称、代码、地址、联系人、联系电话等
- ✅ 索引：主键、唯一索引、状态索引、删除标志索引

#### 2.2 学院信息表（college_info）
- ✅ 主键：college_id (BIGINT自增)
- ✅ 唯一约束：college_code + school_id（学院代码在同一学校内唯一）
- ✅ 外键：school_id → school_info.school_id
- ✅ 字段：学院名称、代码、所属学校、院长、联系电话等
- ✅ 索引：主键、复合唯一索引、外键索引、状态索引、删除标志索引

#### 2.3 专业信息表（major_info）
- ✅ 主键：major_id (BIGINT自增)
- ✅ 唯一约束：major_code + college_id（专业代码在同一学院内唯一）
- ✅ 外键：college_id → college_info.college_id
- ✅ 字段：专业名称、代码、所属学院、学制年限、培养目标等
- ✅ 索引：主键、复合唯一索引、外键索引、状态索引、删除标志索引

#### 2.4 班级信息表（class_info）
- ✅ 主键：class_id (BIGINT自增)
- ✅ 唯一约束：class_code + major_id（班级代码在同一专业内唯一）
- ✅ 唯一约束：share_code（分享码全局唯一）
- ✅ 外键：major_id → major_info.major_id
- ✅ 字段：班级名称、代码、所属专业、入学年份、班主任ID等
- ✅ **分享码相关字段**：
  - share_code：分享码（VARCHAR(8)）
  - share_code_expire_time：分享码过期时间
  - share_code_generate_time：分享码生成时间
  - share_code_use_count：分享码使用次数
- ✅ 索引：主键、复合唯一索引、分享码唯一索引、外键索引、状态索引、删除标志索引

#### 2.5 学期信息表（semester_info）
- ✅ 主键：semester_id (BIGINT自增)
- ✅ 唯一约束：semester_name（学期名称）
- ✅ 字段：学期名称、开始日期、结束日期、是否当前学期等
- ✅ 索引：主键、唯一索引、当前学期索引、删除标志索引

#### 2.6 系统配置表（system_config）
- ✅ 主键：config_id (BIGINT自增)
- ✅ 唯一约束：config_key（配置键）
- ✅ 字段：配置键、配置值、配置类型、配置描述等
- ✅ 索引：主键、唯一索引、配置类型索引、删除标志索引

### 三、表结构特点

#### 3.1 符合开发规范
- ✅ 所有表使用 `utf8mb4` 字符集
- ✅ 所有表使用 `InnoDB` 存储引擎
- ✅ 所有表使用 `BIGINT` 自增主键
- ✅ 所有表包含软删除字段（delete_flag）
- ✅ 所有表包含创建时间、更新时间字段（DATETIME(6)）
- ✅ 时间字段支持微秒精度

#### 3.2 索引优化
- ✅ 所有主键创建主键索引
- ✅ 所有外键创建索引
- ✅ 唯一性约束字段创建唯一索引
- ✅ 常用查询字段（delete_flag、status）创建索引
- ✅ 复合唯一索引（学院代码+学校ID、专业代码+学院ID、班级代码+专业ID）

#### 3.3 外键约束
- ✅ college_info.school_id → school_info.school_id
- ✅ major_info.college_id → college_info.college_id
- ✅ class_info.major_id → major_info.major_id
- ⚠️ class_info.class_teacher_id → user_info.user_id（待创建用户表后添加）

#### 3.4 软删除机制
- ✅ 所有表包含 `delete_flag` 字段
- ✅ `delete_flag = 0` 表示未删除
- ✅ `delete_flag = 1` 表示已删除
- ✅ 所有查询需要过滤已删除数据

## 四、表关系

```
school_info (学校)
    │
    ├── college_info (学院)
    │       │
    │       └── major_info (专业)
    │               │
    │               └── class_info (班级)
    │                       │
    │                       └── class_teacher_id → user_info (待创建)
    │
semester_info (学期) - 独立表
system_config (系统配置) - 独立表
```

## 五、数据权限设计

### 5.1 权限范围
- **系统管理员**：可访问所有数据
- **学校管理员**：只能访问本校数据（自动过滤 school_id）
- **学院负责人**：只能访问本院数据（自动过滤 college_id）
- **班主任**：只能访问本班数据（自动过滤 class_id）

### 5.2 实现方式
在Service层查询时，根据当前登录用户角色自动添加查询条件。

## 六、班级分享码功能

### 6.1 字段设计
- `share_code`：分享码（VARCHAR(8)，全局唯一）
- `share_code_expire_time`：分享码过期时间
- `share_code_generate_time`：分享码生成时间
- `share_code_use_count`：分享码使用次数

### 6.2 业务规则
- 分享码长度：6-8位数字字母组合
- 分享码全局唯一
- 默认有效期：30天
- 支持重新生成（旧分享码立即失效）
- 统计使用次数

## 七、验证结果

### 7.1 表创建验证
- ✅ 所有6张表创建成功
- ✅ 表结构符合设计规范
- ✅ 索引创建成功
- ✅ 外键约束创建成功

### 7.2 表列表
1. school_info - 学校信息表
2. college_info - 学院信息表
3. major_info - 专业信息表
4. class_info - 班级信息表
5. semester_info - 学期信息表
6. system_config - 系统配置表

## 八、后续工作

根据开发计划，下一步是：

### 8.1 学校管理功能开发（第3周第2-3天）
- 创建School实体类（Domain层）
- 创建SchoolMapper接口（Mapper层）
- 创建SchoolService接口和实现（Service层）
- 创建SchoolController控制器（Controller层）
- 实现CRUD功能
- 实现权限控制（仅系统管理员可操作）

### 8.2 学院管理功能开发（第3周第4-5天）
- 创建College实体类
- 创建CollegeMapper、Service、Controller
- 实现数据权限过滤（学校管理员只能管理本校学院）

### 8.3 专业管理功能开发（第4周第1-2天）
- 创建Major实体类
- 创建MajorMapper、Service、Controller
- 实现数据权限过滤（学院负责人只能管理本院专业）

### 8.4 班级管理功能开发（第4周第3-4天）
- 创建Class实体类（包含分享码字段）
- 创建ClassMapper、Service、Controller
- 实现分享码生成、验证、管理功能
- 实现数据权限过滤（班主任只能管理本班）

### 8.5 系统配置功能开发（第4周第5天）
- 创建SystemConfig和Semester实体类
- 创建对应的Mapper、Service、Controller
- 实现学期管理、配置管理功能

## 九、注意事项

1. **外键约束**：class_info表的class_teacher_id外键约束待创建用户表后添加
2. **数据权限**：所有查询必须实现数据权限过滤
3. **软删除**：所有删除操作使用软删除，只更新delete_flag
4. **分享码**：分享码生成逻辑需要在Service层实现
5. **唯一性校验**：学校代码、学院代码、专业代码、班级代码需要实现唯一性校验

## 十、数据库设计文档

详细的数据库设计文档已保存在：`doc/数据库设计文档-系统管理模块.md`

包含：
- 完整的表结构设计
- 字段说明
- 索引设计
- 外键约束
- 业务规则
- 数据权限设计

