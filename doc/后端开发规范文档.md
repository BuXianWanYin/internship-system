# 高校实习过程跟踪与评价管理系统 - 前后端开发规范文档

## 一、项目概述

### 1.1 技术栈
- **后端技术栈**：Spring Boot 2.7.6 + MyBatis Plus + JWT + Redis + Spring Security
- **前端技术栈**：Vue 3 + Vite + Element Plus
- **数据库**：MySQL 8
- **开发工具**：JDK 1.8、Maven 3.6+
- **接口文档**：Swagger

### 1.2 项目结构要求
- 后端采用分层架构，严格遵循MVC模式
- 前端采用组件化开发，模块化管理
- 前后端分离，通过RESTful API进行交互
- 使用Swagger实现接口文档自动生成

## 二、后端开发规范

### 2.1 项目包结构规范

#### 2.1.1 基础包结构
```
com.server.internshipserver
├── common                    # 公共模块
│   ├── config               # 配置类
│   │   ├── SecurityConfig   # Spring Security配置
│   │   ├── RedisConfig      # Redis配置
│   │   ├── MybatisPlusConfig # MyBatis Plus配置
│   │   ├── SwaggerConfig    # Swagger配置
│   │   └── CorsConfig       # 跨域配置
│   ├── constant             # 常量定义
│   ├── enums                # 枚举类
│   ├── exception            # 异常处理
│   │   ├── GlobalExceptionHandler # 全局异常处理器
│   │   └── BusinessException # 业务异常类
│   ├── utils                # 工具类
│   │   ├── JwtUtil          # JWT工具类
│   │   ├── RedisUtil        # Redis工具类
│   │   └── SecurityUtil     # 安全工具类
│   └── result               # 统一响应结果
│       ├── Result           # 响应结果封装
│       └── ResultCode       # 响应码定义
├── domain                    # 实体类（Domain层）
│   ├── system               # 系统管理模块实体
│   │   ├── School           # 学校实体
│   │   ├── College          # 学院实体
│   │   ├── Major            # 专业实体
│   │   ├── Class            # 班级实体
│   │   └── SystemConfig     # 系统配置实体
│   ├── user                 # 用户模块实体
│   │   ├── User             # 用户基础实体
│   │   ├── Student          # 学生实体
│   │   ├── Teacher          # 教师实体
│   │   ├── Enterprise       # 企业实体
│   │   └── EnterpriseMentor # 企业导师实体
│   ├── internship           # 实习模块实体
│   │   ├── InternshipPlan   # 实习计划实体
│   │   ├── InternshipPost   # 实习岗位实体
│   │   ├── InternshipApply  # 实习申请实体
│   │   ├── InternshipLog    # 实习日志实体
│   │   ├── InternshipWeeklyReport # 周报实体
│   │   ├── Attendance       # 考勤记录实体
│   │   └── InternshipFeedback # 问题反馈实体
│   ├── evaluation           # 评价模块实体
│   │   ├── EvaluationIndex  # 评价指标实体
│   │   ├── EnterpriseEvaluation # 企业评价实体
│   │   ├── SchoolEvaluation # 学校评价实体
│   │   ├── SelfEvaluation   # 学生自评实体
│   │   └── ComprehensiveScore # 综合成绩实体
│   └── cooperation          # 校企协同模块实体
│       ├── InformationShare # 信息共享实体
│       ├── Message          # 站内信实体
│       └── Notice           # 通知公告实体
├── mapper                    # 数据访问层（Mapper层）
│   ├── system               # 系统管理Mapper
│   ├── user                 # 用户管理Mapper
│   ├── internship           # 实习管理Mapper
│   ├── evaluation           # 评价管理Mapper
│   └── cooperation          # 校企协同Mapper
├── service                   # 业务逻辑层接口（Service层）
│   ├── system               # 系统管理Service接口
│   ├── user                 # 用户管理Service接口
│   ├── internship           # 实习管理Service接口
│   ├── evaluation           # 评价管理Service接口
│   └── cooperation          # 校企协同Service接口
├── service.impl             # 业务逻辑层实现（ServiceImpl层）
│   ├── system               # 系统管理Service实现
│   ├── user                 # 用户管理Service实现
│   ├── internship           # 实习管理Service实现
│   ├── evaluation           # 评价管理Service实现
│   └── cooperation          # 校企协同Service实现
├── controller               # 控制器层（Controller层）
│   ├── system               # 系统管理Controller
│   │   ├── SchoolController      # 学校管理控制器
│   │   ├── CollegeController     # 学院管理控制器
│   │   ├── MajorController       # 专业管理控制器
│   │   ├── ClassController       # 班级管理控制器
│   │   └── SystemConfigController # 系统配置控制器
│   ├── user                 # 用户管理Controller
│   │   ├── UserController        # 用户基础控制器
│   │   ├── StudentController      # 学生管理控制器
│   │   ├── TeacherController      # 教师管理控制器
│   │   ├── EnterpriseController   # 企业管理控制器
│   │   └── AuthController         # 认证授权控制器
│   ├── internship           # 实习管理Controller
│   │   ├── InternshipPlanController   # 实习计划控制器
│   │   ├── InternshipPostController   # 实习岗位控制器
│   │   ├── InternshipApplyController  # 实习申请控制器
│   │   ├── InternshipLogController    # 实习日志控制器
│   │   ├── AttendanceController       # 考勤管理控制器
│   │   └── InternshipFeedbackController # 反馈管理控制器
│   ├── evaluation           # 评价管理Controller
│   │   ├── EvaluationIndexController  # 评价指标控制器
│   │   ├── EnterpriseEvaluationController # 企业评价控制器
│   │   ├── SchoolEvaluationController # 学校评价控制器
│   │   └── ComprehensiveScoreController # 综合成绩控制器
│   └── cooperation          # 校企协同Controller
│       ├── InformationShareController # 信息共享控制器
│       ├── MessageController         # 站内信控制器
│       └── NoticeController          # 通知公告控制器
└── security                 # 安全模块
    ├── filter               # 过滤器
    │   ├── JwtAuthenticationFilter # JWT认证过滤器
    │   └── JwtAuthorizationFilter  # JWT授权过滤器
    ├── handler              # 处理器
    │   ├── AuthenticationSuccessHandler # 认证成功处理器
    │   ├── AuthenticationFailureHandler # 认证失败处理器
    │   └── AccessDeniedHandler      # 访问拒绝处理器
    └── service              # 安全服务
        └── UserDetailsServiceImpl  # 用户详情服务实现
```

#### 2.1.2 包结构设计原则
- **单一职责原则**：每个包只负责一个业务模块
- **分层清晰**：Domain、Mapper、Service、Controller严格分离
- **模块独立**：不同业务模块之间通过接口交互，降低耦合
- **权限隔离**：不同角色的控制器分开，便于权限控制

### 2.2 Domain层（实体类）规范

#### 2.2.1 实体类命名规范
- 实体类使用大驼峰命名，如：`School`、`Student`、`InternshipPlan`
- 实体类必须实现`Serializable`接口
- 实体类必须添加`@Data`注解（Lombok）
- 实体类必须添加`@TableName`注解指定表名

#### 2.2.2 实体类字段规范
- 主键字段必须使用`@TableId`注解，类型为`IdType.AUTO`
- 字段必须使用`@TableField`注解指定数据库字段名
- 时间字段使用`LocalDateTime`类型，并添加`@JsonFormat`注解格式化
- 自动填充字段使用`@TableField(fill = FieldFill.INSERT_UPDATE)`注解
- 所有字段必须添加`@ApiModelProperty`注解用于API文档说明
- 字段命名使用小驼峰，数据库字段使用下划线命名

#### 2.2.3 实体类示例规范
```java
// 实体类必须包含以下要素：
1. 实现Serializable接口
2. 定义serialVersionUID常量
3. 主键字段使用@TableId注解
4. 时间字段使用@TableField和@JsonFormat注解
5. 所有字段添加@ApiModelProperty注解
6. 使用@Data注解简化getter/setter
```

#### 2.2.4 实体类字段类型规范
- **主键类型**：统一使用`String`类型（如示例代码）或`Long`类型
- **时间类型**：统一使用`LocalDateTime`
- **布尔类型**：使用`Boolean`包装类型
- **数值类型**：根据业务需求选择`Integer`、`Long`、`BigDecimal`
- **字符串类型**：使用`String`，根据长度限制添加`@TableField`注解

### 2.3 Mapper层规范

#### 2.3.1 Mapper接口规范
- Mapper接口必须继承`BaseMapper<T>`，T为对应的实体类
- Mapper接口命名格式：`实体类名 + Mapper`，如：`SchoolMapper`
- Mapper接口必须添加`@Mapper`注解或在启动类添加`@MapperScan`
- 自定义查询方法必须使用`@Select`、`@Update`、`@Insert`、`@Delete`注解
- 复杂查询建议使用XML映射文件

#### 2.3.2 Mapper方法命名规范
- 查询方法：`select + 实体名 + By + 条件`，如：`selectSchoolBySchoolId`
- 更新方法：`update + 实体名 + By + 条件`
- 删除方法：`delete + 实体名 + By + 条件`
- 插入方法：`insert + 实体名`

#### 2.3.3 Mapper示例规范
```java
// Mapper接口必须：
1. 继承BaseMapper<实体类>
2. 添加@Mapper注解
3. 自定义方法添加相应注解
4. 方法命名遵循规范
```

### 2.4 Service层规范

#### 2.4.1 Service接口规范
- Service接口必须继承`IService<T>`，T为对应的实体类
- Service接口命名格式：`实体类名 + Service`，如：`SchoolService`
- Service接口方法必须添加JavaDoc注释，说明方法功能、参数、返回值
- Service接口方法命名使用动词开头，如：`select`、`add`、`update`、`delete`

#### 2.4.2 Service实现类规范
- Service实现类必须继承`ServiceImpl<Mapper, Entity>`并实现对应的Service接口
- Service实现类必须添加`@Service`注解
- Service实现类必须注入对应的Mapper
- Service实现类方法必须添加`@Override`注解
- 业务逻辑复杂的方法必须添加详细注释

#### 2.4.3 Service层职责划分
- **单一职责**：一个Service实现类只负责一个实体类的业务逻辑
- **不可跨模块**：用户Service不能处理实习业务，实习Service不能处理评价业务
- **权限校验**：Service层方法内部必须进行权限校验和数据权限过滤
- **事务管理**：涉及数据修改的方法必须添加`@Transactional`注解

#### 2.4.4 Service方法规范
- 查询方法：返回实体对象或实体列表
- 新增方法：返回操作结果或新增的实体对象
- 更新方法：返回操作结果或更新的实体对象
- 删除方法：返回操作结果（软删除）
- 所有方法必须进行参数校验和异常处理

### 2.5 Controller层规范

#### 2.5.1 Controller类规范
- Controller类必须添加`@RestController`注解
- Controller类必须添加`@RequestMapping`注解指定基础路径
- Controller类必须添加`@Api`注解（Swagger）用于API文档分组
- Controller类命名格式：`功能模块 + Controller`，如：`SchoolController`
- Controller必须注入对应的Service接口

#### 2.5.2 Controller方法规范
- 所有方法必须添加`@ApiOperation`注解（Swagger）说明接口功能
- 所有方法必须添加`@PreAuthorize`注解进行权限控制
- 请求参数必须使用`@RequestBody`或`@RequestParam`注解，并添加`@ApiParam`注解（Swagger）说明参数
- 返回结果必须使用统一的`Result`封装
- 方法命名使用RESTful风格：`get`、`post`、`put`、`delete`

#### 2.5.3 Controller职责划分原则
- **严格分离**：不同业务模块必须使用不同的Controller
- **角色分离**：不同角色的操作必须使用不同的Controller
  - 学生操作：`StudentController`
  - 教师操作：`TeacherController`
  - 管理员操作：`AdminController`或按模块划分
  - 企业操作：`EnterpriseController`
- **不可混用**：一个Controller不能同时处理多个角色的业务逻辑
- **权限隔离**：每个Controller方法必须明确权限要求

#### 2.5.4 RESTful API设计规范
- **GET**：查询操作，如：`GET /api/school/{id}`
- **POST**：新增操作，如：`POST /api/school`
- **PUT**：更新操作，如：`PUT /api/school/{id}`
- **DELETE**：删除操作，如：`DELETE /api/school/{id}`
- **路径命名**：使用小写字母和下划线，如：`/api/internship_plan`

#### 2.5.5 Controller方法示例规范
```java
// Controller方法必须包含：
1. @ApiOperation注解（Swagger）说明接口功能
2. @PreAuthorize注解进行权限控制
3. 参数校验（使用@Valid或手动校验）
4. 调用Service层方法
5. 返回统一的Result结果
```

#### 2.5.6 Swagger配置规范
- 项目必须集成Swagger 2.x或Swagger 3.x（Springfox或Springdoc）
- 创建Swagger配置类，配置API文档基本信息
- 配置API文档访问路径（如：`/swagger-ui.html`或`/swagger-ui/index.html`）
- 配置API文档分组，按模块划分
- 生产环境建议关闭Swagger文档访问
- 所有Controller类必须添加`@Api`注解，指定分组和描述
- 所有Controller方法必须添加`@ApiOperation`注解，说明接口功能
- 所有请求参数必须添加`@ApiParam`或`@ApiModelProperty`注解，说明参数含义
- 实体类必须添加`@ApiModel`注解，说明实体类用途

### 2.6 权限控制规范

#### 2.6.1 角色定义
系统定义八种角色：
1. **ROLE_SYSTEM_ADMIN**：系统管理员（最高权限）
2. **ROLE_SCHOOL_ADMIN**：学校管理员（单所学校权限）
3. **ROLE_COLLEGE_LEADER**：学院负责人（单个学院权限）
4. **ROLE_CLASS_TEACHER**：班主任（单个班级权限）
5. **ROLE_INSTRUCTOR**：指导教师（分配学生权限）
6. **ROLE_ENTERPRISE_ADMIN**：企业管理员（本企业权限）
7. **ROLE_ENTERPRISE_MENTOR**：企业导师（本企业实习生权限）
8. **ROLE_STUDENT**：学生（个人数据权限）

#### 2.6.2 权限控制实现方式
- **方法级权限**：使用`@PreAuthorize`注解，如：`@PreAuthorize("hasRole('ROLE_SCHOOL_ADMIN')")`
- **数据级权限**：在Service层实现数据过滤，确保用户只能访问权限范围内的数据
- **URL级权限**：在Spring Security配置中定义URL访问规则
- **前端权限**：前端根据用户角色动态显示菜单和按钮

#### 2.6.3 权限控制规则
- **系统管理员**：可以访问所有接口和数据
- **学校管理员**：只能访问本校数据，自动过滤其他学校数据
- **学院负责人**：只能访问本院数据，自动过滤其他学院数据
- **班主任**：只能访问本班数据，自动过滤其他班级数据
- **指导教师**：只能访问分配的学生数据
- **企业管理员**：只能访问本企业数据
- **企业导师**：只能访问本企业实习生数据
- **学生**：只能访问个人数据

#### 2.6.4 数据权限过滤实现
- 在Service层方法中，根据当前登录用户角色自动添加查询条件
- 使用MyBatis Plus的`QueryWrapper`动态构建查询条件
- 系统管理员查询不添加过滤条件
- 其他角色查询自动添加对应的数据范围限制

### 2.7 JWT认证规范

#### 2.7.1 JWT配置要求
- Token过期时间：建议设置为2小时
- Refresh Token过期时间：建议设置为7天
- Token密钥：使用强随机字符串，长度不少于32位
- Token存储：Redis存储，Key格式：`jwt:token:{userId}`

#### 2.7.2 JWT工具类规范
- 提供生成Token方法：`generateToken(UserDetails userDetails)`
- 提供验证Token方法：`validateToken(String token)`
- 提供获取用户信息方法：`getUserFromToken(String token)`
- 提供刷新Token方法：`refreshToken(String token)`

#### 2.7.3 JWT过滤器规范
- 实现`OncePerRequestFilter`接口
- 从请求头获取Token：`Authorization: Bearer {token}`
- Token验证失败返回401状态码
- Token验证成功将用户信息存入SecurityContext

### 2.8 Redis使用规范

#### 2.8.1 Redis Key命名规范
- 统一使用冒号分隔，格式：`模块:功能:标识`
- 示例：
  - Token存储：`jwt:token:{userId}`
  - 用户信息缓存：`user:info:{userId}`
  - 验证码：`captcha:login:{sessionId}`
  - 班级分享码：`class:share_code:{classId}`

#### 2.8.2 Redis使用场景
- **Token存储**：存储JWT Token，支持Token刷新和注销
- **用户信息缓存**：缓存用户基本信息，减少数据库查询
- **验证码存储**：存储登录验证码、注册验证码等
- **权限信息缓存**：缓存用户权限信息，提高权限校验效率
- **班级分享码缓存**：缓存班级分享码及其过期时间

#### 2.8.3 Redis工具类规范
- 提供通用的`get`、`set`、`delete`方法
- 提供带过期时间的`set`方法
- 提供`exists`、`expire`等方法
- 所有方法必须处理异常情况

### 2.9 异常处理规范

#### 2.9.1 异常分类
- **业务异常**：`BusinessException`，用于业务逻辑错误
- **参数异常**：`ParameterException`，用于参数校验错误
- **权限异常**：`AccessDeniedException`，用于权限不足
- **系统异常**：`SystemException`，用于系统错误

#### 2.9.2 全局异常处理
- 使用`@ControllerAdvice`创建全局异常处理器
- 统一异常响应格式，使用`Result`封装
- 记录异常日志，便于问题排查
- 不同异常返回不同的HTTP状态码

#### 2.9.3 异常处理示例
- 业务异常：返回200状态码，Result中code为业务错误码
- 参数异常：返回400状态码
- 权限异常：返回403状态码
- 系统异常：返回500状态码

### 2.10 统一响应结果规范

#### 2.10.1 Result类结构
```java
Result {
    code: 响应码（成功：200，失败：其他）
    message: 响应消息
    data: 响应数据
    timestamp: 响应时间戳
}
```

#### 2.10.2 响应码定义
- **200**：操作成功
- **400**：参数错误
- **401**：未认证
- **403**：无权限
- **404**：资源不存在
- **500**：服务器错误
- **业务错误码**：1000-9999，根据业务模块定义

### 2.11 代码注释规范

#### 2.11.1 类注释
- 所有类必须添加类注释，说明类的功能和用途
- 类注释包含：类描述、作者、创建时间

#### 2.11.2 方法注释
- 所有public方法必须添加JavaDoc注释
- 方法注释包含：方法描述、参数说明、返回值说明、异常说明

#### 2.11.3 字段注释
- 实体类字段必须添加`@ApiModelProperty`注解说明
- 复杂业务字段必须添加行内注释

### 2.12 数据库设计规范

#### 2.12.0 数据库版本要求
- **数据库版本**：MySQL 8.0及以上版本
- **字符集**：统一使用`utf8mb4`字符集，支持完整的UTF-8编码（包括emoji等特殊字符）
- **排序规则**：使用`utf8mb4_unicode_ci`排序规则
- **时区设置**：建议使用`Asia/Shanghai`时区
- **存储引擎**：统一使用`InnoDB`存储引擎，支持事务和外键约束

#### 2.12.1 表命名规范
- 表名使用小写字母和下划线，如：`school_info`、`student_info`
- 表名必须体现业务含义，避免使用缩写

#### 2.12.2 字段命名规范
- 字段名使用小写字母和下划线，如：`school_id`、`create_time`
- 主键统一命名为：`{表名}_id`，如：`school_id`
- 外键统一命名为：`{关联表名}_id`，如：`school_id`
- 时间字段统一命名为：`create_time`、`update_time`、`delete_time`

#### 2.12.3 字段类型规范
- **主键**：使用`VARCHAR(32)`或`BIGINT`，推荐使用`BIGINT`自增主键
- **字符串**：根据实际长度选择`VARCHAR`，避免使用`TEXT`，MySQL 8支持`VARCHAR(65535)`长度
- **数值**：根据范围选择`INT`、`BIGINT`、`DECIMAL`，精确数值使用`DECIMAL`
- **时间**：使用`DATETIME`类型，MySQL 8支持微秒精度（`DATETIME(6)`）
- **布尔**：使用`TINYINT(1)`，0表示false，1表示true，或使用`BOOLEAN`类型（MySQL 8支持）
- **JSON**：MySQL 8支持原生JSON类型，可用于存储结构化数据

#### 2.12.4 索引规范
- 主键必须创建主键索引
- 外键字段必须创建索引
- 查询频繁的字段创建索引
- 唯一性约束字段创建唯一索引

#### 2.12.5 软删除规范
- 所有业务表必须添加`delete_flag`字段，类型为`TINYINT(1)`
- `delete_flag = 0`表示未删除，`delete_flag = 1`表示已删除
- 所有查询必须过滤已删除数据
- 删除操作只更新`delete_flag`字段，不物理删除

