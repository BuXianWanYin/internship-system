# 数据库设计文档 - 用户管理模块

## 一、模块概述

用户管理模块包含用户基础信息、角色权限体系、以及各类用户（学生、教师、企业、企业导师）的扩展信息。

## 二、表结构设计

### 2.1 用户基础表（user_info）

#### 表说明
存储所有用户的通用基础信息，是用户体系的核心表。

#### 字段设计

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| user_id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 用户ID（主键） |
| username | VARCHAR | 50 | NOT NULL | - | 用户名（唯一） |
| password | VARCHAR | 255 | NOT NULL | - | 密码（BCrypt加密） |
| real_name | VARCHAR | 50 | NOT NULL | - | 真实姓名 |
| id_card | VARCHAR | 18 | NULL | - | 身份证号 |
| phone | VARCHAR | 20 | NULL | - | 手机号 |
| email | VARCHAR | 100 | NULL | - | 邮箱 |
| avatar | VARCHAR | 255 | NULL | - | 头像URL |
| status | TINYINT | 1 | NOT NULL | 1 | 状态：1-启用，0-禁用 |
| delete_flag | TINYINT | 1 | NOT NULL | 0 | 删除标志：0-未删除，1-已删除 |
| create_time | DATETIME | 6 | NOT NULL | CURRENT_TIMESTAMP(6) | 创建时间 |
| update_time | DATETIME | 6 | NOT NULL | CURRENT_TIMESTAMP(6) | 更新时间 |

#### 索引设计
- **主键索引**：`user_id`
- **唯一索引**：`uk_username` (username)
- **普通索引**：`idx_status` (status)
- **普通索引**：`idx_delete_flag` (delete_flag)
- **普通索引**：`idx_phone` (phone)
- **普通索引**：`idx_email` (email)

#### 业务规则
- 用户名必须唯一
- 密码使用BCrypt加密存储
- 支持软删除

---

### 2.2 角色信息表（role_info）

#### 表说明
存储系统角色信息，定义8种角色。

#### 字段设计

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| role_id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 角色ID（主键） |
| role_code | VARCHAR | 50 | NOT NULL | - | 角色代码（唯一） |
| role_name | VARCHAR | 50 | NOT NULL | - | 角色名称 |
| role_desc | VARCHAR | 200 | NULL | - | 角色描述 |
| status | TINYINT | 1 | NOT NULL | 1 | 状态：1-启用，0-禁用 |
| delete_flag | TINYINT | 1 | NOT NULL | 0 | 删除标志：0-未删除，1-已删除 |
| create_time | DATETIME | 6 | NOT NULL | CURRENT_TIMESTAMP(6) | 创建时间 |
| update_time | DATETIME | 6 | NOT NULL | CURRENT_TIMESTAMP(6) | 更新时间 |

#### 索引设计
- **主键索引**：`role_id`
- **唯一索引**：`uk_role_code` (role_code)
- **普通索引**：`idx_status` (status)
- **普通索引**：`idx_delete_flag` (delete_flag)

#### 角色定义
1. **ROLE_SYSTEM_ADMIN** - 系统管理员
2. **ROLE_SCHOOL_ADMIN** - 学校管理员
3. **ROLE_COLLEGE_LEADER** - 学院负责人
4. **ROLE_CLASS_TEACHER** - 班主任
5. **ROLE_INSTRUCTOR** - 指导教师
6. **ROLE_ENTERPRISE_ADMIN** - 企业管理员
7. **ROLE_ENTERPRISE_MENTOR** - 企业导师
8. **ROLE_STUDENT** - 学生

---

### 2.3 权限信息表（permission_info）

#### 表说明
存储系统权限信息，支持菜单、按钮、接口三种权限类型。

#### 字段设计

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| permission_id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 权限ID（主键） |
| permission_code | VARCHAR | 100 | NOT NULL | - | 权限代码（唯一） |
| permission_name | VARCHAR | 100 | NOT NULL | - | 权限名称 |
| permission_type | VARCHAR | 50 | NULL | - | 权限类型：menu-菜单，button-按钮，api-接口 |
| parent_id | BIGINT | - | NULL | 0 | 父权限ID |
| permission_desc | VARCHAR | 200 | NULL | - | 权限描述 |
| status | TINYINT | 1 | NOT NULL | 1 | 状态：1-启用，0-禁用 |
| delete_flag | TINYINT | 1 | NOT NULL | 0 | 删除标志：0-未删除，1-已删除 |
| create_time | DATETIME | 6 | NOT NULL | CURRENT_TIMESTAMP(6) | 创建时间 |
| update_time | DATETIME | 6 | NOT NULL | CURRENT_TIMESTAMP(6) | 更新时间 |

#### 索引设计
- **主键索引**：`permission_id`
- **唯一索引**：`uk_permission_code` (permission_code)
- **普通索引**：`idx_parent_id` (parent_id)
- **普通索引**：`idx_status` (status)
- **普通索引**：`idx_delete_flag` (delete_flag)

---

### 2.4 用户角色关联表（user_role）

#### 表说明
用户和角色的多对多关联表，一个用户可以有多个角色。

#### 字段设计

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键ID |
| user_id | BIGINT | - | NOT NULL | - | 用户ID（外键） |
| role_id | BIGINT | - | NOT NULL | - | 角色ID（外键） |
| delete_flag | TINYINT | 1 | NOT NULL | 0 | 删除标志：0-未删除，1-已删除 |
| create_time | DATETIME | 6 | NOT NULL | CURRENT_TIMESTAMP(6) | 创建时间 |
| update_time | DATETIME | 6 | NOT NULL | CURRENT_TIMESTAMP(6) | 更新时间 |

#### 索引设计
- **主键索引**：`id`
- **唯一索引**：`uk_user_role` (user_id, role_id)
- **普通索引**：`idx_user_id` (user_id)
- **普通索引**：`idx_role_id` (role_id)
- **普通索引**：`idx_delete_flag` (delete_flag)

#### 外键约束
- **fk_user_role_user**：`user_id` → `user_info.user_id`
- **fk_user_role_role**：`role_id` → `role_info.role_id`

---

### 2.5 角色权限关联表（role_permission）

#### 表说明
角色和权限的多对多关联表，一个角色可以有多个权限。

#### 字段设计

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键ID |
| role_id | BIGINT | - | NOT NULL | - | 角色ID（外键） |
| permission_id | BIGINT | - | NOT NULL | - | 权限ID（外键） |
| delete_flag | TINYINT | 1 | NOT NULL | 0 | 删除标志：0-未删除，1-已删除 |
| create_time | DATETIME | 6 | NOT NULL | CURRENT_TIMESTAMP(6) | 创建时间 |
| update_time | DATETIME | 6 | NOT NULL | CURRENT_TIMESTAMP(6) | 更新时间 |

#### 索引设计
- **主键索引**：`id`
- **唯一索引**：`uk_role_permission` (role_id, permission_id)
- **普通索引**：`idx_role_id` (role_id)
- **普通索引**：`idx_permission_id` (permission_id)
- **普通索引**：`idx_delete_flag` (delete_flag)

#### 外键约束
- **fk_role_permission_role**：`role_id` → `role_info.role_id`
- **fk_role_permission_permission**：`permission_id` → `permission_info.permission_id`

---

### 2.6 学生信息表（student_info）

#### 表说明
存储学生特有信息，关联用户基础表和班级表。

#### 字段设计

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| student_id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 学生ID（主键） |
| user_id | BIGINT | - | NOT NULL | - | 用户ID（外键） |
| student_no | VARCHAR | 50 | NOT NULL | - | 学号（唯一） |
| class_id | BIGINT | - | NOT NULL | - | 所属班级ID（外键） |
| enrollment_year | INT | - | NOT NULL | - | 入学年份 |
| graduation_year | INT | - | NULL | - | 毕业年份 |
| major_id | BIGINT | - | NULL | - | 所属专业ID（冗余字段） |
| college_id | BIGINT | - | NULL | - | 所属学院ID（冗余字段） |
| school_id | BIGINT | - | NULL | - | 所属学校ID（冗余字段） |
| status | TINYINT | 1 | NOT NULL | 1 | 状态：1-启用，0-禁用 |
| delete_flag | TINYINT | 1 | NOT NULL | 0 | 删除标志：0-未删除，1-已删除 |
| create_time | DATETIME | 6 | NOT NULL | CURRENT_TIMESTAMP(6) | 创建时间 |
| update_time | DATETIME | 6 | NOT NULL | CURRENT_TIMESTAMP(6) | 更新时间 |

#### 索引设计
- **主键索引**：`student_id`
- **唯一索引**：`uk_student_no` (student_no)
- **唯一索引**：`uk_user_id` (user_id)
- **普通索引**：`idx_class_id` (class_id)
- **普通索引**：`idx_major_id` (major_id)
- **普通索引**：`idx_college_id` (college_id)
- **普通索引**：`idx_school_id` (school_id)
- **普通索引**：`idx_status` (status)
- **普通索引**：`idx_delete_flag` (delete_flag)

#### 外键约束
- **fk_student_user**：`user_id` → `user_info.user_id`
- **fk_student_class**：`class_id` → `class_info.class_id`

#### 业务规则
- 学号必须唯一
- 一个用户只能对应一个学生记录
- 冗余字段（major_id、college_id、school_id）用于提高查询性能

---

### 2.7 教师信息表（teacher_info）

#### 表说明
存储教师特有信息，关联用户基础表和学院表。

#### 字段设计

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| teacher_id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 教师ID（主键） |
| user_id | BIGINT | - | NOT NULL | - | 用户ID（外键） |
| teacher_no | VARCHAR | 50 | NOT NULL | - | 工号（唯一） |
| college_id | BIGINT | - | NULL | - | 所属学院ID（外键） |
| school_id | BIGINT | - | NULL | - | 所属学校ID（冗余字段） |
| title | VARCHAR | 50 | NULL | - | 职称 |
| department | VARCHAR | 100 | NULL | - | 所属部门 |
| status | TINYINT | 1 | NOT NULL | 1 | 状态：1-启用，0-禁用 |
| delete_flag | TINYINT | 1 | NOT NULL | 0 | 删除标志：0-未删除，1-已删除 |
| create_time | DATETIME | 6 | NOT NULL | CURRENT_TIMESTAMP(6) | 创建时间 |
| update_time | DATETIME | 6 | NOT NULL | CURRENT_TIMESTAMP(6) | 更新时间 |

#### 索引设计
- **主键索引**：`teacher_id`
- **唯一索引**：`uk_teacher_no` (teacher_no)
- **唯一索引**：`uk_user_id` (user_id)
- **普通索引**：`idx_college_id` (college_id)
- **普通索引**：`idx_school_id` (school_id)
- **普通索引**：`idx_status` (status)
- **普通索引**：`idx_delete_flag` (delete_flag)

#### 外键约束
- **fk_teacher_user**：`user_id` → `user_info.user_id`
- **fk_teacher_college**：`college_id` → `college_info.college_id`

#### 业务规则
- 工号必须唯一
- 一个用户只能对应一个教师记录
- 教师可以属于某个学院，也可以不属于任何学院（系统管理员）

---

### 2.8 企业信息表（enterprise_info）

#### 表说明
存储企业信息，支持企业自主注册和审核流程。

#### 字段设计

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| enterprise_id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 企业ID（主键） |
| user_id | BIGINT | - | NULL | - | 用户ID（外键，企业管理员账号） |
| enterprise_name | VARCHAR | 200 | NOT NULL | - | 企业名称 |
| enterprise_code | VARCHAR | 50 | NULL | - | 企业代码（唯一） |
| unified_social_credit_code | VARCHAR | 50 | NULL | - | 统一社会信用代码（唯一） |
| legal_person | VARCHAR | 50 | NULL | - | 法人代表 |
| registered_capital | DECIMAL | 15,2 | NULL | - | 注册资本（万元） |
| industry | VARCHAR | 100 | NULL | - | 所属行业 |
| address | VARCHAR | 200 | NULL | - | 企业地址 |
| contact_person | VARCHAR | 50 | NULL | - | 联系人 |
| contact_phone | VARCHAR | 20 | NULL | - | 联系电话 |
| contact_email | VARCHAR | 100 | NULL | - | 联系邮箱 |
| enterprise_scale | VARCHAR | 50 | NULL | - | 企业规模 |
| business_scope | TEXT | - | NULL | - | 经营范围 |
| audit_status | TINYINT | 1 | NOT NULL | 0 | 审核状态：0-待审核，1-已通过，2-已拒绝 |
| audit_opinion | VARCHAR | 500 | NULL | - | 审核意见 |
| audit_time | DATETIME | 6 | NULL | - | 审核时间 |
| auditor_id | BIGINT | - | NULL | - | 审核人ID |
| status | TINYINT | 1 | NOT NULL | 1 | 状态：1-启用，0-禁用 |
| delete_flag | TINYINT | 1 | NOT NULL | 0 | 删除标志：0-未删除，1-已删除 |
| create_time | DATETIME | 6 | NOT NULL | CURRENT_TIMESTAMP(6) | 创建时间 |
| update_time | DATETIME | 6 | NOT NULL | CURRENT_TIMESTAMP(6) | 更新时间 |

#### 索引设计
- **主键索引**：`enterprise_id`
- **唯一索引**：`uk_enterprise_code` (enterprise_code)
- **唯一索引**：`uk_unified_social_credit_code` (unified_social_credit_code)
- **普通索引**：`idx_user_id` (user_id)
- **普通索引**：`idx_audit_status` (audit_status)
- **普通索引**：`idx_status` (status)
- **普通索引**：`idx_delete_flag` (delete_flag)

#### 外键约束
- **fk_enterprise_user**：`user_id` → `user_info.user_id`（ON DELETE SET NULL）

#### 业务规则
- 企业代码和统一社会信用代码必须唯一
- 企业注册后需要学校管理员审核
- 审核通过后激活企业管理员账号

---

### 2.9 企业导师信息表（enterprise_mentor_info）

#### 表说明
存储企业导师信息，关联用户基础表和企业表。

#### 字段设计

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| mentor_id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 企业导师ID（主键） |
| user_id | BIGINT | - | NOT NULL | - | 用户ID（外键） |
| enterprise_id | BIGINT | - | NOT NULL | - | 所属企业ID（外键） |
| mentor_name | VARCHAR | 50 | NOT NULL | - | 导师姓名 |
| position | VARCHAR | 100 | NULL | - | 职位 |
| department | VARCHAR | 100 | NULL | - | 部门 |
| phone | VARCHAR | 20 | NULL | - | 联系电话 |
| email | VARCHAR | 100 | NULL | - | 邮箱 |
| status | TINYINT | 1 | NOT NULL | 1 | 状态：1-启用，0-禁用 |
| delete_flag | TINYINT | 1 | NOT NULL | 0 | 删除标志：0-未删除，1-已删除 |
| create_time | DATETIME | 6 | NOT NULL | CURRENT_TIMESTAMP(6) | 创建时间 |
| update_time | DATETIME | 6 | NOT NULL | CURRENT_TIMESTAMP(6) | 更新时间 |

#### 索引设计
- **主键索引**：`mentor_id`
- **唯一索引**：`uk_user_id` (user_id)
- **普通索引**：`idx_enterprise_id` (enterprise_id)
- **普通索引**：`idx_status` (status)
- **普通索引**：`idx_delete_flag` (delete_flag)

#### 外键约束
- **fk_mentor_user**：`user_id` → `user_info.user_id`
- **fk_mentor_enterprise**：`enterprise_id` → `enterprise_info.enterprise_id`

#### 业务规则
- 一个用户只能对应一个企业导师记录
- 企业导师必须属于某个企业

---

## 三、表关系图

```
user_info (用户基础表)
    │
    ├── student_info (学生表) → class_info (班级)
    │
    ├── teacher_info (教师表) → college_info (学院)
    │
    ├── enterprise_info (企业表)
    │       │
    │       └── enterprise_mentor_info (企业导师表)
    │
    ├── user_role (用户角色关联) → role_info (角色表)
    │                                   │
    │                                   └── role_permission (角色权限关联) → permission_info (权限表)
    │
    └── class_info.class_teacher_id (班主任关联)
```

## 四、数据权限设计

### 4.1 权限范围
- **系统管理员**：可访问所有数据
- **学校管理员**：只能访问本校数据（自动过滤 school_id）
- **学院负责人**：只能访问本院数据（自动过滤 college_id）
- **班主任**：只能访问本班数据（自动过滤 class_id）
- **指导教师**：只能访问分配的学生数据
- **企业管理员**：只能访问本企业数据
- **企业导师**：只能访问本企业实习生数据
- **学生**：只能访问个人数据

### 4.2 实现方式
在Service层查询时，根据当前登录用户角色自动添加查询条件。

## 五、初始数据

### 5.1 角色数据
已插入8种角色：
1. ROLE_SYSTEM_ADMIN - 系统管理员
2. ROLE_SCHOOL_ADMIN - 学校管理员
3. ROLE_COLLEGE_LEADER - 学院负责人
4. ROLE_CLASS_TEACHER - 班主任
5. ROLE_INSTRUCTOR - 指导教师
6. ROLE_ENTERPRISE_ADMIN - 企业管理员
7. ROLE_ENTERPRISE_MENTOR - 企业导师
8. ROLE_STUDENT - 学生

### 5.2 权限数据
已插入30个权限，包括：
- 系统管理模块权限（25个）
- 用户管理模块权限（5个）

### 5.3 角色权限关联
- 系统管理员已分配所有30个权限

## 六、验证结果

### 6.1 表创建验证
- ✅ 所有9张表创建成功
- ✅ 表结构符合设计规范
- ✅ 索引创建成功
- ✅ 外键约束创建成功

### 6.2 表列表
1. user_info - 用户基础信息表
2. role_info - 角色信息表
3. permission_info - 权限信息表
4. user_role - 用户角色关联表
5. role_permission - 角色权限关联表
6. student_info - 学生信息表
7. teacher_info - 教师信息表
8. enterprise_info - 企业信息表
9. enterprise_mentor_info - 企业导师信息表

## 七、后续工作

根据开发计划，下一步是：

### 7.1 用户注册与添加功能开发（第5周第2-3天）
- 创建User、Student、Teacher、Enterprise、EnterpriseMentor实体类
- 创建对应的Mapper、Service、Controller
- 实现企业自主注册功能
- 实现学生注册功能（两种方式）
- 实现教师添加功能
- 实现班主任任命功能

### 7.2 用户管理功能开发（第5周第4-5天）
- 实现用户信息查询、编辑
- 实现用户状态管理
- 实现密码重置功能
- 实现数据权限过滤

## 八、注意事项

1. **外键约束**：所有外键约束已创建，确保数据完整性
2. **数据权限**：所有查询必须实现数据权限过滤
3. **软删除**：所有删除操作使用软删除，只更新delete_flag
4. **冗余字段**：学生表和教师表包含冗余字段，用于提高查询性能
5. **企业审核**：企业注册后需要审核，审核通过后激活账号
6. **多角色支持**：一个用户可以有多个角色（通过user_role表关联）

