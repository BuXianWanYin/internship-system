## 三、前端开发规范

### 3.1 项目结构规范

#### 3.1.1 目录结构
```
internship-web/
├── public/                 # 静态资源
├── src/
│   ├── api/               # API接口定义
│   │   ├── system.js      # 系统管理API
│   │   ├── user.js        # 用户管理API
│   │   ├── internship.js  # 实习管理API
│   │   ├── evaluation.js  # 评价管理API
│   │   └── cooperation.js # 校企协同API
│   ├── assets/            # 资源文件
│   ├── components/        # 公共组件
│   │   ├── common/        # 通用组件
│   │   └── business/      # 业务组件
│   ├── router/            # 路由配置
│   │   ├── index.js       # 路由入口
│   │   └── modules/       # 路由模块
│   ├── store/             # 状态管理
│   │   ├── modules/       # 状态模块
│   │   └── index.js       # Store入口
│   ├── utils/             # 工具函数
│   │   ├── request.js     # 请求封装
│   │   ├── auth.js        # 认证工具
│   │   ├── permission.js  # 权限工具
│   │   └── dateUtils.js   # 日期时间格式化工具
│   ├── views/             # 页面组件
│   │   ├── student/       # 学生端页面
│   │   ├── teacher/       # 教师端页面
│   │   ├── admin/         # 管理员端页面
│   │   └── enterprise/    # 企业端页面
│   ├── App.vue            # 根组件
│   └── main.js            # 入口文件
├── package.json
└── vite.config.js
```

### 3.2 组件开发规范

#### 3.2.1 组件命名规范
- 组件文件使用大驼峰命名，如：`StudentList.vue`
- 组件名必须具有业务含义，避免使用通用名称
- 公共组件放在`components/common`目录
- 业务组件放在`components/business`目录

#### 3.2.2 组件结构规范
```vue
<template>
  <!-- 模板内容 -->
</template>

<script>
// 脚本内容
</script>

<style scoped>
/* 样式内容 */
</style>
```

#### 3.2.3 组件职责规范
- **单一职责**：每个组件只负责一个功能
- **可复用性**：公共组件设计要考虑复用性
- **可维护性**：组件代码要清晰易懂，注释完整

#### 3.2.4 代码质量规范

##### 3.2.4.1 控制流嵌套规范
- **嵌套层级限制**：方法中的 if/else 嵌套层级不应超过 3 层
- **提取方法**：当嵌套层级超过 3 层时，必须提取为独立函数
- **提前返回**：优先使用提前返回（Early Return）模式，减少嵌套
- **卫语句**：使用卫语句（Guard Clauses）处理异常情况

**示例：避免深层嵌套**
```javascript
// ❌ 错误示例：嵌套层级过深（4-5层）
const loadData = async () => {
  if (condition1) {
    const data1 = await fetchData1()
    if (data1) {
      if (condition2) {
        const data2 = await fetchData2()
        if (data2) {
          // 处理逻辑
        } else {
          // 错误处理
        }
      }
    }
  }
}

// ✅ 正确示例：提取方法，减少嵌套
const loadData = async () => {
  if (!condition1) return
  const data1 = await fetchData1()
  if (!data1) return
  await processData(data1)
}

const processData = async (data1) => {
  if (!condition2) return
  const data2 = await fetchData2()
  if (!data2) {
    handleError()
    return
  }
  // 处理逻辑
}
```

##### 3.2.4.2 方法/函数长度规范
- **函数长度限制**：单个函数代码行数不应超过 80 行
- **职责单一**：函数应只做一件事，保持职责单一
- **提取函数**：当函数过长时，应提取为多个独立函数

##### 3.2.4.3 代码可读性规范
- **函数命名**：函数名应清晰表达函数功能
- **注释规范**：复杂业务逻辑必须添加注释说明
- **变量命名**：变量名应具有业务含义，避免使用单字母变量
- **常量提取**：魔法数字和字符串应提取为常量

### 3.3 工具函数规范

#### 3.3.1 日期时间格式化规范
- **工具文件**：使用 `@/utils/dateUtils.js` 中的格式化函数
- **标准格式**：日期时间统一使用 `yyyy-MM-dd HH:mm:ss` 格式（年月日 时分秒）
- **函数使用**：
  ```javascript
  import { formatDateTime, formatDate, formatTime } from '@/utils/dateUtils'
  
  // 格式化日期时间（年月日 时分秒）
  formatDateTime(new Date()) // '2024-01-01 12:00:00'
  formatDateTime(dateString) // '2024-01-01 12:00:00'
  
  // 格式化日期（年月日）
  formatDate(new Date()) // '2024-01-01'
  
  // 格式化时间（时分秒）
  formatTime(new Date()) // '12:00:00'
  ```
- **显示规范**：
  - 列表页、详情页中的日期时间字段必须使用 `formatDateTime` 格式化
  - 日期选择器、时间选择器显示格式统一为 `yyyy-MM-dd HH:mm:ss`
  - 后端返回的日期时间字符串（如 ISO 8601 格式）必须格式化后再显示
- **禁止事项**：
  - 禁止直接显示后端返回的原始日期时间字符串
  - 禁止使用其他日期格式化库（如 moment.js、dayjs），统一使用项目提供的工具函数

#### 3.3.2 其他工具函数规范
- **文件命名**：工具函数文件使用小驼峰命名，如：`dateUtils.js`、`formatUtils.js`
- **函数导出**：使用具名导出（named export），不使用默认导出
- **函数注释**：所有公共工具函数必须添加 JSDoc 注释，说明参数、返回值和使用示例

### 3.4 API接口调用规范

#### 3.4.1 API文件组织
- **按业务模块划分API目录**：每个业务模块创建独立的目录，如：`api/system/`、`api/user/`
- **按功能细分API文件**：每个业务模块下按功能细分多个API文件，避免将所有API挤在一个文件中
  - 示例：`api/user/` 目录下应包含：
    - `user.js` - 用户基础管理API
    - `student.js` - 学生管理API
    - `teacher.js` - 教师管理API
    - `enterprise.js` - 企业管理API
    - `auth.js` - 认证授权API
    - `index.js` - 统一导出文件
- **统一导出**：每个模块目录下创建`index.js`文件，统一导出该模块下的所有API
- **禁止混用**：不同功能的API必须分开到不同文件，不能将所有API放在一个文件中
- API方法命名使用动词开头，如：`getSchoolList`、`addSchool`

#### 3.4.2 请求封装规范
- 统一使用axios进行HTTP请求
- 请求拦截器：添加Token、设置请求头
- 响应拦截器：统一处理响应、错误处理
- 请求超时时间：设置为30秒

#### 3.4.3 错误处理规范
- 网络错误：提示"网络连接失败，请检查网络"
- 401错误：清除Token，跳转到登录页
- 403错误：提示"无权限访问"
- 500错误：提示"服务器错误，请稍后重试"
- 业务错误：显示后端返回的错误消息

### 3.5 路由管理规范

#### 3.5.1 路由配置规范
- 路由按角色划分，不同角色使用不同的路由配置
- 路由路径使用小写字母和连字符，如：`/student/internship-apply`
- 路由必须配置`meta`信息，包含：标题、权限、图标等

#### 3.5.2 路由守卫规范
- 全局前置守卫：检查登录状态、Token有效性
- 路由守卫：检查页面访问权限
- 权限不足时跳转到403页面或首页

#### 3.5.3 动态路由规范
- 根据用户角色动态生成路由
- 不同角色显示不同的菜单和页面
- 路由配置从后端获取或前端根据角色配置

### 3.6 状态管理规范

#### 3.6.1 Store模块划分
- 按业务模块划分Store模块，如：`user`、`system`、`internship`
- 每个模块包含：`state`、`mutations`、`actions`、`getters`

#### 3.6.2 状态管理原则
- 全局状态：用户信息、权限信息、系统配置
- 局部状态：页面数据、表单数据（使用组件内部状态）
- 避免过度使用全局状态

### 3.7 权限控制规范

#### 3.7.1 前端权限控制方式
- **菜单权限**：根据用户角色动态显示菜单
- **按钮权限**：根据用户角色控制按钮显示/隐藏
- **路由权限**：路由守卫检查页面访问权限
- **数据权限**：根据用户角色过滤数据（后端已实现，前端无需额外处理）

#### 3.7.2 角色定义
系统定义七种角色（与后端保持一致）：
1. **ROLE_SYSTEM_ADMIN**：系统管理员（最高权限，可访问所有功能和数据）
2. **ROLE_SCHOOL_ADMIN**：学校管理员（单所学校权限，可查看和批阅本校学生的实习数据）
3. **ROLE_COLLEGE_LEADER**：学院负责人（单个学院权限，可查看和批阅本院学生的实习数据）
4. **ROLE_CLASS_TEACHER**：班主任（单个班级权限，可查看和批阅本班学生的实习数据，原指导教师角色已合并到此角色）
5. **ROLE_ENTERPRISE_ADMIN**：企业管理员（本企业权限）
6. **ROLE_ENTERPRISE_MENTOR**：企业导师（本企业实习生权限）
7. **ROLE_STUDENT**：学生（个人数据权限）

**说明**：原 `ROLE_INSTRUCTOR`（指导教师）角色已合并到 `ROLE_CLASS_TEACHER`（班主任）角色中，系统不再区分班主任和指导教师。

#### 3.7.3 角色分配权限矩阵
各角色在添加用户/教师/学生时，可以分配的角色权限如下表：

| 当前角色 | 系统管理员 | 学校管理员 | 学院负责人 | 班主任 | 学生 | 企业管理员 | 企业导师 |
|---------|-----------|-----------|-----------|--------|------|-----------|---------|
| **系统管理员** | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| **学校管理员** | ❌ | ✅ | ✅ | ✅ | ✅ | ❌ | ❌ |
| **学院负责人** | ❌ | ❌ | ✅ | ✅ | ✅ | ❌ | ❌ |
| **班主任** | ❌ | ❌ | ❌ | ❌ | ✅ | ❌ | ❌ |
| **企业管理员** | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ |

**权限说明：**
- ✅ 表示可以分配该角色
- ❌ 表示不能分配该角色
- **系统管理员**：可以分配所有角色（最高权限）
- **学校管理员**：可以分配学校相关角色（学校管理员、学院负责人、班主任、学生），不能分配企业相关角色
- **学院负责人**：只能分配教师相关角色（学院负责人、班主任）和学生角色，不能分配系统管理员、学校管理员、企业相关角色
- **班主任**：只能分配学生角色，不能分配其他任何角色
- **企业管理员**：只能分配企业导师角色，不能分配其他任何角色

**角色分配管理说明：**
- **用户管理**：负责用户的基础信息管理和角色分配，所有角色的分配统一在用户管理中处理
- **教师管理**：只负责教师的基础信息管理（工号、姓名、所属学院等），不负责角色分配
- **学生管理**：只负责学生的基础信息管理，不负责角色分配

#### 3.7.4 用户编辑权限矩阵
各角色在编辑用户信息时的权限如下表：

| 当前角色 | 系统管理员 | 学校管理员 | 学院负责人 | 班主任 | 学生 | 企业管理员 | 企业导师 |
|---------|-----------|-----------|-----------|--------|------|-----------|---------|
| **系统管理员** | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| **学校管理员** | ❌ | ✅ | ✅ | ✅ | ✅ | ❌ | ❌ |
| **学院负责人** | ❌ | ❌ | ✅ | ✅ | ✅ | ❌ | ❌ |
| **班主任** | ❌ | ❌ | ❌ | ❌ | ✅ | ❌ | ❌ |
| **企业管理员** | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ | ✅ |

**权限说明：**
- ✅ 表示可以编辑该角色的用户信息
- ❌ 表示不能编辑该角色的用户信息
- **系统管理员**：可以编辑所有用户信息
- **学校管理员**：可以编辑学校相关角色的用户信息，不能编辑系统管理员、企业相关角色的用户信息
- **学院负责人**：可以编辑教师相关角色和学生角色的用户信息，不能编辑系统管理员、学校管理员、企业相关角色的用户信息
- **班主任**：只能编辑学生角色的用户信息，不能编辑其他任何角色的用户信息
- **企业管理员**：只能编辑企业相关角色的用户信息，不能编辑其他任何角色的用户信息

#### 3.7.5 权限工具函数使用
前端权限检查使用`@/utils/permission.js`中的工具函数：
- `hasRole(role)`：检查是否有指定角色
- `hasAnyRole(requiredRoles)`：检查是否有任一角色
- `canEditUser(targetUserRoles)`：检查是否可以编辑指定用户
- `canAssignRole(roleCode)`：检查是否可以分配指定角色

**使用示例：**
```javascript
import { hasAnyRole, canEditUser, canAssignRole } from '@/utils/permission'

// 检查按钮显示权限
<el-button v-if="hasAnyRole(['ROLE_SYSTEM_ADMIN', 'ROLE_SCHOOL_ADMIN'])" />

// 检查是否可以编辑用户
<el-button :disabled="!canEditUser(row.roles || [])" />

// 过滤可分配的角色
const filteredRoles = roleList.filter(role => canAssignRole(role.roleCode))
```

##### 3.7.5.1 权限检查函数详细说明
- **工具文件**：`@/utils/permission.js`
- **函数特点**：权限函数会自动从Store获取当前用户角色，无需手动传入
- **常用函数**：
  ```javascript
  import { hasRole, hasAnyRole, hasAllRoles, canEditUser, canAssignRole } from '@/utils/permission'
  
  // 检查是否拥有指定角色（自动从Store获取用户角色）
  hasRole('ROLE_SYSTEM_ADMIN')
  
  // 检查是否拥有任意一个角色（自动从Store获取用户角色）
  hasAnyRole(['ROLE_SYSTEM_ADMIN', 'ROLE_SCHOOL_ADMIN'])
  
  // 检查是否拥有所有指定角色（自动从Store获取用户角色）
  hasAllRoles(['ROLE_SYSTEM_ADMIN', 'ROLE_SCHOOL_ADMIN'])
  
  // 检查是否可以编辑指定用户（需要传入目标用户的角色列表）
  canEditUser(['ROLE_COLLEGE_LEADER'])
  
  // 检查是否可以分配指定角色（需要传入角色代码）
  canAssignRole('ROLE_CLASS_TEACHER')
  ```
- **兼容性说明**：函数同时支持旧代码的调用方式（传入角色列表作为第一个参数），但推荐使用新方式（自动从Store获取）

##### 3.7.5.2 获取当前用户角色
- **自动获取**：权限函数会自动从Store获取当前用户角色，通常不需要手动获取
- **如需手动获取**：用户登录后，角色信息存储在Store中
- **使用示例**：
  ```javascript
  import { useAuthStore } from '@/store/modules/auth'
  
  const authStore = useAuthStore()
  const roles = authStore.roles  // 获取当前用户角色列表
  ```

#### 3.7.4 路由权限控制

##### 3.7.4.1 路由配置规范
- **路由meta配置**：在路由配置中添加`roles`字段，指定可访问的角色
- **配置示例**：
  ```javascript
  {
    path: '/admin/student',
    name: 'StudentManagement',
    component: () => import('@/views/admin/StudentManagement.vue'),
    meta: {
      title: '学生管理',
      requiresAuth: true,
      roles: ['ROLE_SYSTEM_ADMIN', 'ROLE_CLASS_TEACHER']  // 指定可访问的角色
    }
  }
  ```

##### 3.7.4.2 路由守卫实现
- **全局前置守卫**：在`router/index.js`中实现`beforeEach`守卫
- **权限检查逻辑**：
  ```javascript
  router.beforeEach((to, from, next) => {
    // 1. 检查是否需要登录
    if (to.meta.requiresAuth) {
      const token = getToken()
      if (!token) {
        next('/login')
        return
      }
    }
    
    // 2. 检查路由权限
    if (to.meta.roles) {
      const roles = store.getters.roles
      const hasPermission = to.meta.roles.some(role => roles.includes(role))
      if (!hasPermission) {
        // 无权限，跳转到403页面或首页
        next('/403')
        return
      }
    }
    
    next()
  })
  ```

#### 3.7.5 菜单权限控制

##### 3.7.5.1 菜单显示控制
- **根据角色过滤菜单**：在菜单组件中根据用户角色过滤显示的菜单项
- **实现示例**：
  ```javascript
  // 在MainLayout.vue或菜单组件中
  const menuItems = computed(() => {
    const roles = store.getters.roles
    return allMenuItems.filter(item => {
      // 如果没有配置roles，则所有角色都可以访问
      if (!item.roles) {
        return true
      }
      // 检查用户是否拥有菜单要求的角色
      return item.roles.some(role => roles.includes(role))
    })
  })
  ```

##### 3.7.5.2 菜单配置示例
```javascript
const menuItems = [
  {
    title: '学生管理',
    path: '/admin/student',
    icon: 'User',
    roles: ['ROLE_SYSTEM_ADMIN', 'ROLE_CLASS_TEACHER']  // 只有系统管理员和班主任可以访问
  },
  {
    title: '企业管理',
    path: '/admin/enterprise',
    icon: 'OfficeBuilding',
    roles: ['ROLE_SYSTEM_ADMIN', 'ROLE_SCHOOL_ADMIN']  // 系统管理员和学校管理员可以访问
  }
]
```

#### 3.7.6 按钮权限控制

##### 3.7.6.1 使用v-if控制按钮显示
- **推荐方式**：使用`v-if`和权限检查函数控制按钮显示
- **实现示例**：
  ```vue
  <template>
    <!-- 只有系统管理员和班主任可以显示批量导入按钮 -->
    <el-button 
      v-if="hasAnyRole(['ROLE_SYSTEM_ADMIN', 'ROLE_CLASS_TEACHER'])"
      @click="handleImport"
    >
      批量导入
    </el-button>
    
    <!-- 只有系统管理员和企业管理员可以显示编辑按钮 -->
    <el-button 
      v-if="hasAnyRole(['ROLE_SYSTEM_ADMIN', 'ROLE_ENTERPRISE_ADMIN'])"
      @click="handleEdit"
    >
      编辑
    </el-button>
    
    <!-- 学校管理员只能查看，不能编辑 -->
    <el-button 
      v-if="hasRole('ROLE_SCHOOL_ADMIN')"
      @click="handleView"
    >
      查看
    </el-button>
  </template>
  
  <script setup>
  import { hasRole, hasAnyRole } from '@/utils/permission'
  // 注意：权限函数会自动从Store获取用户角色，无需手动传入
  </script>
  ```

##### 3.7.6.2 权限指令（可选）
- **创建权限指令**：`v-permission`，用于控制元素显示
- **实现示例**：
  ```javascript
  // directives/permission.js
  import { hasAnyRole } from '@/utils/permission'
  
  export default {
    mounted(el, binding) {
      const { value } = binding
      if (value && !hasAnyRole(value)) {
        el.parentNode && el.parentNode.removeChild(el)
      }
    }
  }
  ```
- **使用示例**：
  ```vue
  <el-button v-permission="['ROLE_SYSTEM_ADMIN', 'ROLE_ENTERPRISE_ADMIN']">
    编辑
  </el-button>
  ```

#### 3.7.7 特殊业务权限控制规则

##### 3.7.7.1 企业管理页面权限规则
- **查看权限**：系统管理员、学校管理员、企业管理员都可以查看
- **编辑按钮**：只显示给系统管理员和企业管理员（学校管理员不显示编辑按钮）
- **实现示例**：
  ```vue
  <template>
    <el-table-column label="操作">
      <template #default="{ row }">
        <!-- 只有系统管理员和企业管理员可以编辑 -->
        <el-button 
          v-if="hasAnyRole(['ROLE_SYSTEM_ADMIN', 'ROLE_ENTERPRISE_ADMIN'])"
          @click="handleEdit(row)"
        >
          编辑
        </el-button>
        <!-- 所有有查看权限的角色都可以查看详情 -->
        <el-button 
          v-if="hasAnyRole(['ROLE_SYSTEM_ADMIN', 'ROLE_SCHOOL_ADMIN', 'ROLE_ENTERPRISE_ADMIN'])"
          @click="handleView(row)"
        >
          查看
        </el-button>
      </template>
    </el-table-column>
  </template>
  ```

##### 3.7.7.2 企业导师管理页面权限规则
- **查看权限**：系统管理员、学校管理员、企业管理员都可以查看
- **管理按钮**：只显示给系统管理员和企业管理员（学校管理员不显示添加/编辑/删除按钮）
- **实现示例**：
  ```vue
  <template>
    <!-- 只有系统管理员和企业管理员可以添加企业导师 -->
    <el-button 
      v-if="hasAnyRole(['ROLE_SYSTEM_ADMIN', 'ROLE_ENTERPRISE_ADMIN'])"
      @click="handleAdd"
    >
      添加企业导师
    </el-button>
    
    <el-table-column label="操作">
      <template #default="{ row }">
        <!-- 只有系统管理员和企业管理员可以编辑/删除 -->
        <el-button 
          v-if="hasAnyRole(['ROLE_SYSTEM_ADMIN', 'ROLE_ENTERPRISE_ADMIN'])"
          @click="handleEdit(row)"
        >
          编辑
        </el-button>
        <el-button 
          v-if="hasAnyRole(['ROLE_SYSTEM_ADMIN', 'ROLE_ENTERPRISE_ADMIN'])"
          @click="handleDelete(row)"
        >
          删除
        </el-button>
      </template>
    </el-table-column>
  </template>
  ```

##### 3.7.7.3 学生管理页面权限规则
- **查看权限**：系统管理员、班主任可以查看
- **批量导入按钮**：只显示给系统管理员和班主任
- **实现示例**：
  ```vue
  <template>
    <!-- 只有系统管理员和班主任可以批量导入 -->
    <el-button 
      v-if="hasAnyRole(['ROLE_SYSTEM_ADMIN', 'ROLE_CLASS_TEACHER'])"
      @click="handleImport"
    >
      批量导入
    </el-button>
  </template>
  ```

##### 3.7.7.4 用户编辑权限规则
- **权限层级**：
  1. **系统管理员**：可以编辑所有用户
  2. **学校管理员**：不能编辑系统管理员，可以编辑其他所有用户
  3. **学院负责人**：不能编辑系统管理员、学校管理员，可以编辑教师、学生等
  4. **班主任**：不能编辑系统管理员、学校管理员、学院负责人，可以编辑学生等
- **实现方式**：
  - 使用 `canEditUser(targetUserRoles)` 函数判断是否可以编辑指定用户
  - 在用户列表和教师列表中，根据权限禁用编辑按钮
- **代码示例**：
  ```vue
  <!-- 编辑按钮：根据权限禁用 -->
  <el-button 
    v-if="hasAnyRole(['ROLE_SYSTEM_ADMIN', 'ROLE_SCHOOL_ADMIN', 'ROLE_COLLEGE_LEADER'])" 
    :disabled="!canEditUser(row.roles || [])"
    @click="handleEdit(row)"
  >
    编辑
  </el-button>
  ```
  ```javascript
  import { canEditUser } from '@/utils/permission'
  
  // 在组件中使用
  // canEditUser 函数会自动从 Store 获取当前用户角色，并判断是否可以编辑目标用户
  ```

##### 3.7.7.5 角色分配权限规则
- **权限层级**：
  1. **系统管理员**：可以分配所有角色
  2. **学校管理员**：不能分配系统管理员角色，可以分配其他角色
  3. **学院负责人**：不能分配系统管理员、学校管理员角色，可以分配教师、学生等角色
  4. **班主任**：不能分配系统管理员、学校管理员、学院负责人角色，可以分配学生角色
- **实现方式**：
  - 使用 `canAssignRole(roleCode)` 函数判断是否可以分配指定角色
  - 在添加/编辑教师时，使用计算属性过滤角色下拉列表
- **代码示例**：
  ```vue
  <!-- 角色选择下拉框：根据权限过滤 -->
  <el-select v-model="formData.roleCode" placeholder="请选择角色">
    <el-option
      v-for="role in filteredRoleList"
      :key="role.roleCode"
      :label="role.roleName"
      :value="role.roleCode"
    />
  </el-select>
  ```
  ```javascript
  import { canAssignRole } from '@/utils/permission'
  import { computed } from 'vue'
  
  // 过滤后的角色列表（根据当前用户权限）
  const filteredRoleList = computed(() => {
    return roleList.value.filter(role => canAssignRole(role.roleCode))
  })
  ```

##### 3.7.7.6 实习管理模块菜单权限规则
- **实习管理主菜单（internship-admin）**：
  - **可见角色**：`ROLE_SYSTEM_ADMIN`、`ROLE_SCHOOL_ADMIN`、`ROLE_COLLEGE_LEADER`、`ROLE_CLASS_TEACHER`
  - **子菜单权限**：
    - **实习计划管理**：`ROLE_SYSTEM_ADMIN`、`ROLE_SCHOOL_ADMIN`、`ROLE_COLLEGE_LEADER`
    - **实习申请审核**：`ROLE_SYSTEM_ADMIN`、`ROLE_SCHOOL_ADMIN`、`ROLE_COLLEGE_LEADER`、`ROLE_CLASS_TEACHER`
    - **实习日志批阅**：`ROLE_SYSTEM_ADMIN`、`ROLE_SCHOOL_ADMIN`、`ROLE_COLLEGE_LEADER`、`ROLE_CLASS_TEACHER`
    - **周报批阅**：`ROLE_SYSTEM_ADMIN`、`ROLE_SCHOOL_ADMIN`、`ROLE_COLLEGE_LEADER`、`ROLE_CLASS_TEACHER`
    - **成果审核**：`ROLE_SYSTEM_ADMIN`、`ROLE_SCHOOL_ADMIN`、`ROLE_COLLEGE_LEADER`、`ROLE_CLASS_TEACHER`
    - **问题反馈处理**：`ROLE_ENTERPRISE_MENTOR`、`ROLE_CLASS_TEACHER`
- **说明**：
  - 系统管理员可以看到所有实习管理子菜单
  - 学校管理员和学院负责人可以批阅日志、周报、成果
  - 学院负责人可以创建和管理本学院的实习计划
  - 学院负责人可以查看全学院的实习申请审核
  - 原指导教师（`ROLE_INSTRUCTOR`）角色已合并到班主任（`ROLE_CLASS_TEACHER`）角色中

#### 3.7.8 权限控制最佳实践

##### 3.7.8.1 权限检查函数封装
- **统一封装**：在`@/utils/permission.js`中封装权限检查函数
- **自动获取角色**：函数会自动从Store获取当前用户角色，无需手动传入
- **实现示例**：
  ```javascript
  // utils/permission.js
  import { useAuthStore } from '@/store/modules/auth'
  
  /**
   * 获取当前用户角色列表
   * @param {string[]} [providedRoles] 可选：提供的角色列表（用于兼容旧代码）
   * @returns {string[]} 角色列表
   */
  function getCurrentUserRoles(providedRoles) {
    // 如果提供了角色列表，优先使用（兼容旧代码）
    if (providedRoles && Array.isArray(providedRoles)) {
      return providedRoles
    }
    // 否则从Store获取
    try {
      const authStore = useAuthStore()
      return authStore.roles || []
    } catch (error) {
      return []
    }
  }
  
  /**
   * 检查是否拥有指定角色
   * @param {string} role 角色代码
   * @returns {boolean}
   */
  export function hasRole(role) {
    if (!role) {
      return false
    }
    const roles = getCurrentUserRoles()
    return roles.includes(role)
  }
  
  /**
   * 检查是否拥有任意一个角色
   * @param {string[]} requiredRoles 需要的角色代码数组
   * @returns {boolean}
   */
  export function hasAnyRole(requiredRoles) {
    if (!requiredRoles || !Array.isArray(requiredRoles) || requiredRoles.length === 0) {
      return false
    }
    const roles = getCurrentUserRoles()
    if (!roles || roles.length === 0) {
      return false
    }
    return requiredRoles.some(role => roles.includes(role))
  }
  
  /**
   * 检查是否拥有所有指定角色
   * @param {string[]} requiredRoles 需要的角色代码数组
   * @returns {boolean}
   */
  export function hasAllRoles(requiredRoles) {
    if (!requiredRoles || !Array.isArray(requiredRoles) || requiredRoles.length === 0) {
      return false
    }
    const roles = getCurrentUserRoles()
    if (!roles || roles.length === 0) {
      return false
    }
    return requiredRoles.every(role => roles.includes(role))
  }
  ```

##### 3.7.8.2 组合式API中使用权限
```vue
<script setup>
import { computed } from 'vue'
import { hasRole, hasAnyRole } from '@/utils/permission'

// 计算属性：是否显示编辑按钮（权限函数自动从Store获取角色）
const canEdit = computed(() => {
  return hasAnyRole(['ROLE_SYSTEM_ADMIN', 'ROLE_ENTERPRISE_ADMIN'])
})

// 计算属性：是否显示删除按钮（权限函数自动从Store获取角色）
const canDelete = computed(() => {
  return hasAnyRole(['ROLE_SYSTEM_ADMIN', 'ROLE_ENTERPRISE_ADMIN'])
})
</script>

<template>
  <el-button v-if="canEdit" @click="handleEdit">编辑</el-button>
  <el-button v-if="canDelete" @click="handleDelete">删除</el-button>
</template>
```

#### 3.7.9 筛选框权限控制规范

##### 3.7.9.1 筛选框权限控制概述
在管理页面中，根据当前用户的角色自动设置筛选框的默认值和禁用状态，提升用户体验并确保数据权限安全。

##### 3.7.9.2 筛选框权限控制规则

**学校管理员（ROLE_SCHOOL_ADMIN）**：
- 所属学校：自动绑定当前用户所在的学校，筛选框禁用，不允许修改
- 所属学院：可以下拉选择（本学校的所有学院）
- 所属班级：可以下拉选择（根据选择的学院）

**学院负责人（ROLE_COLLEGE_LEADER）**：
- 所属学校：自动绑定当前用户所在的学校，筛选框禁用，不允许修改
- 所属学院：自动绑定当前用户所在的学院，筛选框禁用，不允许修改
- 所属班级：可以下拉选择（本学院的所有班级）

**班主任（ROLE_CLASS_TEACHER）**：
- 所属学校：自动绑定当前用户所在的学校，筛选框禁用，不允许修改
- 所属学院：自动绑定当前用户所在的学院，筛选框禁用，不允许修改
- 所属班级：可以下拉选择（管理的多个班级，支持多选）

**系统管理员（ROLE_SYSTEM_ADMIN）**：
- 所有筛选框都可以自由选择，无任何限制

##### 3.7.9.3 获取当前用户组织信息API

**接口路径**：`GET /user/current/org-info`

**返回数据**：
```json
{
  "code": 200,
  "message": "查询成功",
  "data": {
    "schoolId": 1,
    "schoolName": "XX大学",
    "collegeId": 2,
    "collegeName": "计算机学院",
    "classIds": [10, 11, 12],
    "classNames": ["计算机1班", "计算机2班", "计算机3班"]
  }
}
```

**实现说明**：
- 系统管理员：返回空对象（不限制）
- 学校管理员：返回学校ID和学校名称
- 学院负责人：返回学校ID、学校名称、学院ID、学院名称
- 班主任：返回学校ID、学校名称、学院ID、学院名称、班级ID列表、班级名称列表

##### 3.7.9.4 筛选框权限控制实现示例

```javascript
import { userApi } from '@/api/user/user'
import { hasAnyRole } from '@/utils/permission'

// 当前用户组织信息
const currentOrgInfo = ref({
  schoolId: null,
  schoolName: '',
  collegeId: null,
  collegeName: '',
  classIds: [],
  classNames: []
})

// 计算属性：学校下拉框是否禁用
const isSchoolDisabled = computed(() => {
  return hasAnyRole(['ROLE_SCHOOL_ADMIN', 'ROLE_COLLEGE_LEADER', 'ROLE_CLASS_TEACHER'])
})

// 计算属性：学院下拉框是否禁用
const isCollegeDisabled = computed(() => {
  return hasAnyRole(['ROLE_COLLEGE_LEADER', 'ROLE_CLASS_TEACHER'])
})

// 计算属性：班级下拉框是否支持多选（班主任支持多选）
const isClassMultiple = computed(() => {
  return hasAnyRole(['ROLE_CLASS_TEACHER'])
})

// 计算属性：过滤后的班级列表（班主任只能看到管理的班级）
const filteredClassList = computed(() => {
  if (hasAnyRole(['ROLE_CLASS_TEACHER']) && currentOrgInfo.value.classIds && currentOrgInfo.value.classIds.length > 0) {
    return classList.value.filter(c => currentOrgInfo.value.classIds.includes(c.classId))
  }
  return classList.value
})

// 加载当前用户组织信息
const loadCurrentUserOrgInfo = async () => {
  try {
    const res = await userApi.getCurrentUserOrgInfo()
    if (res.code === 200 && res.data) {
      currentOrgInfo.value = {
        schoolId: res.data.schoolId || null,
        schoolName: res.data.schoolName || '',
        collegeId: res.data.collegeId || null,
        collegeName: res.data.collegeName || '',
        classIds: res.data.classIds || [],
        classNames: res.data.classNames || []
      }
      
      // 根据角色设置筛选框默认值
      if (hasAnyRole(['ROLE_SCHOOL_ADMIN', 'ROLE_COLLEGE_LEADER', 'ROLE_CLASS_TEACHER'])) {
        if (currentOrgInfo.value.schoolId) {
          searchForm.schoolId = currentOrgInfo.value.schoolId
        }
      }
      
      if (hasAnyRole(['ROLE_COLLEGE_LEADER', 'ROLE_CLASS_TEACHER'])) {
        if (currentOrgInfo.value.collegeId) {
          searchForm.collegeId = currentOrgInfo.value.collegeId
        }
      }
    }
  } catch (error) {
    console.error('获取组织信息失败:', error)
  }
}

// 在 onMounted 中调用
onMounted(async () => {
  await loadCurrentUserOrgInfo()
  loadData()
})
```

**模板示例**：
```vue
<template>
  <el-form-item label="所属学校">
    <el-select
      v-model="searchForm.schoolId"
      placeholder="请选择学校"
      :disabled="isSchoolDisabled"
      @change="handleSchoolChange"
    >
      <el-option
        v-for="school in schoolList"
        :key="school.schoolId"
        :label="school.schoolName"
        :value="school.schoolId"
      />
    </el-select>
  </el-form-item>
  
  <el-form-item label="所属学院">
    <el-select
      v-model="searchForm.collegeId"
      placeholder="请选择学院"
      :disabled="isCollegeDisabled || !searchForm.schoolId"
      @change="handleCollegeChange"
    >
      <el-option
        v-for="college in collegeList"
        :key="college.collegeId"
        :label="college.collegeName"
        :value="college.collegeId"
      />
    </el-select>
  </el-form-item>
  
  <el-form-item label="所属班级">
    <el-select
      v-model="searchForm.classId"
      placeholder="请选择班级"
      :disabled="!searchForm.collegeId"
      :multiple="isClassMultiple"
    >
      <el-option
        v-for="classItem in filteredClassList"
        :key="classItem.classId"
        :label="classItem.className"
        :value="classItem.classId"
      />
    </el-select>
  </el-form-item>
</template>
```

##### 3.7.9.5 重置筛选条件时的处理
重置筛选条件时，需要保持组织信息的绑定，不能清空：

```javascript
const handleReset = () => {
  searchForm.otherField = ''
  
  // 根据角色重置筛选条件，保持组织信息的绑定
  if (hasAnyRole(['ROLE_SCHOOL_ADMIN', 'ROLE_COLLEGE_LEADER', 'ROLE_CLASS_TEACHER'])) {
    searchForm.schoolId = currentOrgInfo.value.schoolId || null
  } else {
    searchForm.schoolId = null
  }
  
  if (hasAnyRole(['ROLE_COLLEGE_LEADER', 'ROLE_CLASS_TEACHER'])) {
    searchForm.collegeId = currentOrgInfo.value.collegeId || null
  } else {
    searchForm.collegeId = null
  }
  
  handleSearch()
}
```

##### 3.7.9.6 需要实现筛选框权限控制的页面
以下页面必须实现筛选框权限控制：
- 用户管理页面
- 教师管理页面
- 学生管理页面
- 班级管理页面
- 学院管理页面
- 专业管理页面
- 实习计划管理页面

#### 3.7.10 权限控制检查清单
开发新页面时，必须检查以下权限控制点：
- [ ] 路由是否配置了`roles`字段
- [ ] 菜单项是否根据角色过滤显示
- [ ] 按钮是否根据角色控制显示/隐藏
- [ ] 筛选框是否根据角色设置了默认值和禁用状态
- [ ] 是否使用了统一的权限检查函数
- [ ] 是否考虑了所有角色的权限需求
- [ ] 是否测试了不同角色的权限控制效果
- [ ] 权限控制是否与后端保持一致

### 3.8 页面设计规范

#### 3.8.1 布局规范
- 统一使用响应式布局，支持PC、平板、移动端
- 顶部导航栏：用户信息、消息通知、系统设置
- 左侧菜单栏：根据角色动态生成
- 主内容区：页面具体内容

#### 3.8.2 页面组件规范
- 列表页面：搜索栏、数据表格、分页组件
- 表单页面：表单验证、提交按钮、取消按钮
- 详情页面：信息展示、操作按钮
- 仪表盘页面：统计卡片、图表组件

#### 3.8.3 交互规范
- 操作反馈：成功提示、错误提示、加载状态
- 表单验证：实时验证、提交前验证
- 数据加载：显示加载状态、骨架屏
- 错误处理：友好的错误提示

#### 3.8.4 表单控件选择规范

##### 3.8.4.1 下拉框（el-select）使用规范

**使用场景**：
- 当字段有固定的可选值时，必须使用下拉框（`el-select`）而不是文本输入框（`el-input`）
- 用于提高数据一致性和用户体验

**必须使用下拉框的字段类型**：

1. **枚举类型字段**：
   - 合作类型：实习基地、校企合作、人才培养、产学研合作、其他
   - 企业规模：大型企业、中型企业、小型企业、微型企业
   - 实习类型：生产实习、毕业实习、认知实习、专业实习
   - 薪资类型：月薪、日薪、时薪、面议
   - 状态字段：启用/禁用、进行中/已结束等

2. **关联选择字段**：
   - 所属学校、所属学院、所属专业、所属班级
   - 合作学校、合作企业
   - 学期选择

3. **角色选择**：
   - 教师角色：学院负责人、班主任（原指导教师角色已合并到班主任角色）

**下拉框实现规范**：

```vue
<template>
  <!-- 基础下拉框 -->
  <el-form-item label="合作类型" prop="cooperationType">
    <el-select
      v-model="formData.cooperationType"
      placeholder="请选择合作类型"
      style="width: 100%"
    >
      <el-option label="实习基地" value="实习基地" />
      <el-option label="校企合作" value="校企合作" />
      <el-option label="人才培养" value="人才培养" />
      <el-option label="产学研合作" value="产学研合作" />
      <el-option label="其他" value="其他" />
    </el-select>
  </el-form-item>

  <!-- 可搜索的下拉框（选项较多时） -->
  <el-form-item label="所属学校" prop="schoolId">
    <el-select
      v-model="formData.schoolId"
      placeholder="请选择学校"
      style="width: 100%"
      filterable
      clearable
    >
      <el-option
        v-for="school in schoolList"
        :key="school.schoolId"
        :label="school.schoolName"
        :value="school.schoolId"
      />
    </el-select>
  </el-form-item>

  <!-- 级联下拉框（有依赖关系时） -->
  <el-form-item label="所属学院" prop="collegeId">
    <el-select
      v-model="formData.collegeId"
      placeholder="请选择学院"
      style="width: 100%"
      :disabled="!formData.schoolId"
      clearable
    >
      <el-option
        v-for="college in collegeList"
        :key="college.collegeId"
        :label="college.collegeName"
        :value="college.collegeId"
      />
    </el-select>
    <div v-if="!formData.schoolId" style="color: #f56c6c; font-size: 12px;">
      请先选择所属学校
    </div>
  </el-form-item>
</template>
```

**下拉框选项配置规范**：

1. **选项值统一性**：
   - 选项的`value`值必须与后端数据库存储值保持一致
   - 选项的`label`值用于显示，应该清晰易懂

2. **必填字段处理**：
   - 必填的下拉框必须添加`prop`属性用于表单验证
   - 在表单验证规则中添加必填验证

3. **禁用状态处理**：
   - 级联下拉框：当父级未选择时，子级应该禁用
   - 编辑模式：某些字段在编辑时应该禁用（如企业代码）

4. **清空功能**：
   - 非必填字段的下拉框应该添加`clearable`属性
   - 必填字段根据业务需求决定是否允许清空

5. **搜索功能**：
   - 选项数量较多（>10个）时，应该添加`filterable`属性
   - 支持用户输入关键词快速筛选选项

**表单验证规则**：

```javascript
const formRules = {
  cooperationType: [
    { required: true, message: '请选择合作类型', trigger: 'change' }
  ],
  schoolId: [
    { required: true, message: '请选择所属学校', trigger: 'change' }
  ]
}
```

**常见下拉框选项配置**：

```javascript
// 合作类型选项
const cooperationTypeOptions = [
  { label: '实习基地', value: '实习基地' },
  { label: '校企合作', value: '校企合作' },
  { label: '人才培养', value: '人才培养' },
  { label: '产学研合作', value: '产学研合作' },
  { label: '其他', value: '其他' }
]

// 企业规模选项
const enterpriseScaleOptions = [
  { label: '大型企业（500人以上）', value: '大型企业' },
  { label: '中型企业（100-500人）', value: '中型企业' },
  { label: '小型企业（20-100人）', value: '小型企业' },
  { label: '微型企业（20人以下）', value: '微型企业' }
]

// 实习类型选项
const planTypeOptions = [
  { label: '生产实习', value: '生产实习' },
  { label: '毕业实习', value: '毕业实习' },
  { label: '认知实习', value: '认知实习' },
  { label: '专业实习', value: '专业实习' }
]

// 薪资类型选项
const salaryTypeOptions = [
  { label: '月薪', value: '月薪' },
  { label: '日薪', value: '日薪' },
  { label: '时薪', value: '时薪' },
  { label: '面议', value: '面议' }
]
```

**禁止事项**：
- ❌ 禁止将枚举类型字段使用文本输入框（`el-input`）
- ❌ 禁止在表单中使用自由文本输入枚举值
- ❌ 禁止下拉框选项值与显示文本不一致
- ❌ 禁止在级联下拉框中不处理依赖关系

**检查清单**：
开发表单时，必须检查以下字段是否使用了正确的控件：
- [ ] 合作类型是否使用下拉框
- [ ] 企业规模是否使用下拉框
- [ ] 实习类型是否使用下拉框
- [ ] 薪资类型是否使用下拉框
- [ ] 状态字段是否使用下拉框或单选框
- [ ] 关联选择字段是否使用下拉框
- [ ] 级联下拉框是否正确处理依赖关系

### 3.9 样式规范

#### 3.9.1 CSS命名规范
- 使用BEM命名规范或类名语义化
- 避免使用全局样式，使用scoped样式
- 公共样式放在`assets/styles`目录

#### 3.9.2 样式组织规范
- 组件样式使用`<style scoped>`
- 公共样式使用全局样式文件
- 主题色、字体等使用CSS变量

### 3.9 富文本编辑器使用规范

#### 3.9.1 富文本编辑器组件
- **组件位置**：`@/components/common/RichTextEditor.vue`
- **依赖库**：Quill 1.3.7
- **使用方式**：
  ```vue
  <RichTextEditor
    v-model="content"
    placeholder="请输入内容..."
    :height="'300px'"
  />
  ```

#### 3.9.2 富文本编辑器功能
- ✅ 支持文本格式化（标题、字体、大小、颜色、背景色）
- ✅ 支持文本样式（加粗、斜体、下划线、删除线、上下标）
- ✅ 支持列表（有序列表、无序列表）
- ✅ 支持对齐方式（左对齐、居中、右对齐、两端对齐）
- ✅ 支持引用和代码块
- ✅ 支持链接和图片插入
- ✅ 内容以HTML格式存储

#### 3.9.3 富文本内容显示
- 使用`v-html`指令显示富文本内容
- 注意XSS防护，确保内容来源可信
- 示例：
  ```vue
  <div v-html="content" style="max-width: 100%; word-wrap: break-word;"></div>
  ```

### 3.10 文件上传规范

#### 3.10.1 文件上传API
- **API位置**：`@/api/common/file.js`
- **上传单文件**：`fileApi.uploadFile(file)`
- **上传多文件**：`fileApi.uploadFiles(files)`
- **返回格式**：返回文件URL或URL数组

#### 3.10.2 文件上传组件使用
- 使用Element Plus的`el-upload`组件
- 配置`auto-upload="false"`，手动控制上传时机
- 文件验证在`before-upload`钩子中进行
- 示例：
  ```vue
  <el-upload
    v-model:file-list="fileList"
    :auto-upload="false"
    :before-upload="beforeUpload"
    multiple
    :limit="5"
  >
    <el-button type="primary">选择文件</el-button>
  </el-upload>
  ```

#### 3.10.3 文件上传限制
- **支持的文件类型**：Word文档（.doc, .docx）、PDF、图片、Excel、压缩文件等
- **文件大小限制**：单个文件最大10MB
- **文件数量限制**：最多上传5个文件（可根据业务调整）

#### 3.10.4 附件存储和显示
- **存储格式**：多个附件URL用逗号分隔存储在数据库字段中
- **附件列表显示**：解析逗号分隔的URL字符串，循环显示
- **附件下载**：使用`el-link`组件，设置`target="_blank"`在新窗口打开
- 示例：
  ```vue
  <div v-for="(url, index) in attachmentUrls.split(',').filter(u => u)" :key="index">
    <el-link :href="url" target="_blank" type="primary">{{ getFileName(url) }}</el-link>
  </div>
  ```

#### 3.10.5 文件上传流程
1. 用户选择文件（`el-upload`组件）
2. 文件验证（`before-upload`钩子）
3. 文件添加到列表（`on-change`钩子）
4. 提交表单时统一上传（调用`fileApi.uploadFiles`）
5. 获取文件URL列表
6. 将URL列表（逗号分隔）保存到数据库

### 3.11 代码注释规范

#### 3.11.1 组件注释
- 组件文件头部添加组件说明
- 组件注释只包含功能描述，不包含作者和日期信息
- 复杂逻辑添加行内注释
- 方法添加注释说明功能

#### 3.11.2 API注释
- API方法添加注释，说明接口功能、参数、返回值

## 四、开发工具配置规范

### 4.1 代码格式化
- 使用Prettier进行代码格式化
- 使用ESLint进行代码检查
- 提交前自动格式化代码

### 4.2 Git提交规范
- 提交信息格式：`类型(范围): 描述`
- 类型：`feat`（新功能）、`fix`（修复）、`docs`（文档）、`style`（格式）、`refactor`（重构）、`test`（测试）、`chore`（构建）
- 示例：`feat(user): 添加学生注册功能`

### 4.3 接口文档规范
- 使用Swagger生成API文档
- 所有Controller方法必须添加`@ApiOperation`注解
- 所有实体类必须添加`@ApiModel`注解
- 所有参数必须添加`@ApiParam`或`@ApiModelProperty`注解

## 五、安全规范

### 5.1 数据安全
- 敏感数据加密存储（密码使用BCrypt加密）
- SQL注入防护：使用参数化查询
- XSS防护：前后端数据校验和转义

### 5.2 接口安全
- 所有接口必须进行身份认证（除登录、注册接口）
- 敏感操作必须进行二次验证
- 接口请求频率限制，防止暴力攻击

### 5.3 前端安全
- Token存储在localStorage或sessionStorage
- 敏感信息不在前端存储
- 用户输入必须进行校验和转义

## 六、测试规范

### 6.1 单元测试
- Service层方法必须编写单元测试
- 测试覆盖率要求达到70%以上
- 使用JUnit进行单元测试

### 6.2 接口测试
- 所有接口必须进行接口测试
- 使用Postman或Swagger进行接口测试
- 测试用例覆盖正常流程和异常流程

### 6.3 前端测试
- 关键功能进行E2E测试
- 使用Cypress或Playwright进行测试

## 七、部署规范

### 7.1 环境配置
- 开发环境：本地开发
- 测试环境：内网测试服务器
- 生产环境：正式服务器

### 7.2 配置文件管理
- 使用`application.yml`进行配置
- 不同环境使用不同的配置文件
- 敏感信息使用环境变量或配置中心

### 7.3 日志规范
- 使用Logback进行日志管理
- 日志级别：DEBUG、INFO、WARN、ERROR
- 日志文件按日期分割，保留30天

## 八、性能优化规范

### 8.1 数据库优化
- 合理使用索引，避免全表扫描
- 避免N+1查询问题，使用关联查询
- 大数据量查询使用分页

### 8.2 缓存优化
- 频繁查询的数据使用Redis缓存
- 缓存过期时间合理设置
- 缓存更新策略：先更新数据库，再更新缓存

### 8.3 前端优化
- 路由懒加载，减少首屏加载时间
- 图片懒加载，优化页面性能
- 合理使用防抖和节流

## 九、文档规范

### 9.1 代码文档
- 所有公共方法必须添加JavaDoc注释
- 复杂业务逻辑必须添加注释说明
- API接口必须生成Swagger文档

### 9.2 开发文档
- 数据库设计文档
- 接口设计文档
- 部署文档
- 运维文档


