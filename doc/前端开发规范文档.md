## 三、前端开发规范

### 3.1 项目结构规范

#### 3.1.1 目录结构
```
internship-web/
├── public/                 # 静态资源
├── src/
│   ├── api/               # API接口定义
│   │   ├── system.js      # 系统管理API
│   │   ├── user.js        # 用户管理API
│   │   ├── internship.js  # 实习管理API
│   │   ├── evaluation.js  # 评价管理API
│   │   └── cooperation.js # 校企协同API
│   ├── assets/            # 资源文件
│   ├── components/        # 公共组件
│   │   ├── common/        # 通用组件
│   │   └── business/      # 业务组件
│   ├── router/            # 路由配置
│   │   ├── index.js       # 路由入口
│   │   └── modules/       # 路由模块
│   ├── store/             # 状态管理
│   │   ├── modules/       # 状态模块
│   │   └── index.js       # Store入口
│   ├── utils/             # 工具函数
│   │   ├── request.js     # 请求封装
│   │   ├── auth.js        # 认证工具
│   │   ├── permission.js  # 权限工具
│   │   └── dateUtils.js   # 日期时间格式化工具
│   ├── views/             # 页面组件
│   │   ├── student/       # 学生端页面
│   │   ├── teacher/       # 教师端页面
│   │   ├── admin/         # 管理员端页面
│   │   └── enterprise/    # 企业端页面
│   ├── App.vue            # 根组件
│   └── main.js            # 入口文件
├── package.json
└── vite.config.js
```

### 3.2 组件开发规范

#### 3.2.1 组件命名规范
- 组件文件使用大驼峰命名，如：`StudentList.vue`
- 组件名必须具有业务含义，避免使用通用名称
- 公共组件放在`components/common`目录
- 业务组件放在`components/business`目录

#### 3.2.2 组件结构规范
```vue
<template>
  <!-- 模板内容 -->
</template>

<script>
// 脚本内容
</script>

<style scoped>
/* 样式内容 */
</style>
```

#### 3.2.3 组件职责规范
- **单一职责**：每个组件只负责一个功能
- **可复用性**：公共组件设计要考虑复用性
- **可维护性**：组件代码要清晰易懂，注释完整

### 3.3 工具函数规范

#### 3.3.1 日期时间格式化规范
- **工具文件**：使用 `@/utils/dateUtils.js` 中的格式化函数
- **标准格式**：日期时间统一使用 `yyyy-MM-dd HH:mm:ss` 格式（年月日 时分秒）
- **函数使用**：
  ```javascript
  import { formatDateTime, formatDate, formatTime } from '@/utils/dateUtils'
  
  // 格式化日期时间（年月日 时分秒）
  formatDateTime(new Date()) // '2024-01-01 12:00:00'
  formatDateTime(dateString) // '2024-01-01 12:00:00'
  
  // 格式化日期（年月日）
  formatDate(new Date()) // '2024-01-01'
  
  // 格式化时间（时分秒）
  formatTime(new Date()) // '12:00:00'
  ```
- **显示规范**：
  - 列表页、详情页中的日期时间字段必须使用 `formatDateTime` 格式化
  - 日期选择器、时间选择器显示格式统一为 `yyyy-MM-dd HH:mm:ss`
  - 后端返回的日期时间字符串（如 ISO 8601 格式）必须格式化后再显示
- **禁止事项**：
  - 禁止直接显示后端返回的原始日期时间字符串
  - 禁止使用其他日期格式化库（如 moment.js、dayjs），统一使用项目提供的工具函数

#### 3.3.2 其他工具函数规范
- **文件命名**：工具函数文件使用小驼峰命名，如：`dateUtils.js`、`formatUtils.js`
- **函数导出**：使用具名导出（named export），不使用默认导出
- **函数注释**：所有公共工具函数必须添加 JSDoc 注释，说明参数、返回值和使用示例

### 3.4 API接口调用规范

#### 3.4.1 API文件组织
- **按业务模块划分API目录**：每个业务模块创建独立的目录，如：`api/system/`、`api/user/`
- **按功能细分API文件**：每个业务模块下按功能细分多个API文件，避免将所有API挤在一个文件中
  - 示例：`api/user/` 目录下应包含：
    - `user.js` - 用户基础管理API
    - `student.js` - 学生管理API
    - `teacher.js` - 教师管理API
    - `enterprise.js` - 企业管理API
    - `auth.js` - 认证授权API
    - `index.js` - 统一导出文件
- **统一导出**：每个模块目录下创建`index.js`文件，统一导出该模块下的所有API
- **禁止混用**：不同功能的API必须分开到不同文件，不能将所有API放在一个文件中
- API方法命名使用动词开头，如：`getSchoolList`、`addSchool`

#### 3.4.2 请求封装规范
- 统一使用axios进行HTTP请求
- 请求拦截器：添加Token、设置请求头
- 响应拦截器：统一处理响应、错误处理
- 请求超时时间：设置为30秒

#### 3.4.3 错误处理规范
- 网络错误：提示"网络连接失败，请检查网络"
- 401错误：清除Token，跳转到登录页
- 403错误：提示"无权限访问"
- 500错误：提示"服务器错误，请稍后重试"
- 业务错误：显示后端返回的错误消息

### 3.5 路由管理规范

#### 3.5.1 路由配置规范
- 路由按角色划分，不同角色使用不同的路由配置
- 路由路径使用小写字母和连字符，如：`/student/internship-apply`
- 路由必须配置`meta`信息，包含：标题、权限、图标等

#### 3.5.2 路由守卫规范
- 全局前置守卫：检查登录状态、Token有效性
- 路由守卫：检查页面访问权限
- 权限不足时跳转到403页面或首页

#### 3.5.3 动态路由规范
- 根据用户角色动态生成路由
- 不同角色显示不同的菜单和页面
- 路由配置从后端获取或前端根据角色配置

### 3.6 状态管理规范

#### 3.6.1 Store模块划分
- 按业务模块划分Store模块，如：`user`、`system`、`internship`
- 每个模块包含：`state`、`mutations`、`actions`、`getters`

#### 3.6.2 状态管理原则
- 全局状态：用户信息、权限信息、系统配置
- 局部状态：页面数据、表单数据（使用组件内部状态）
- 避免过度使用全局状态

### 3.7 权限控制规范

#### 3.7.1 前端权限控制方式
- **菜单权限**：根据用户角色动态显示菜单
- **按钮权限**：根据用户角色控制按钮显示/隐藏
- **路由权限**：路由守卫检查页面访问权限
- **数据权限**：根据用户角色过滤数据（后端已实现，前端无需额外处理）

#### 3.7.2 角色定义
系统定义八种角色（与后端保持一致）：
1. **ROLE_SYSTEM_ADMIN**：系统管理员（最高权限）
2. **ROLE_SCHOOL_ADMIN**：学校管理员（单所学校权限）
3. **ROLE_COLLEGE_LEADER**：学院负责人（单个学院权限）
4. **ROLE_CLASS_TEACHER**：班主任（单个班级权限）
5. **ROLE_INSTRUCTOR**：指导教师（分配学生权限）
6. **ROLE_ENTERPRISE_ADMIN**：企业管理员（本企业权限）
7. **ROLE_ENTERPRISE_MENTOR**：企业导师（本企业实习生权限）
8. **ROLE_STUDENT**：学生（个人数据权限）

#### 3.7.3 权限工具函数使用

##### 3.7.3.1 权限检查函数
- **工具文件**：`@/utils/permission.js`
- **函数特点**：权限函数会自动从Store获取当前用户角色，无需手动传入
- **常用函数**：
  ```javascript
  import { hasRole, hasAnyRole, hasAllRoles } from '@/utils/permission'
  
  // 检查是否拥有指定角色（自动从Store获取用户角色）
  hasRole('ROLE_SYSTEM_ADMIN')
  
  // 检查是否拥有任意一个角色（自动从Store获取用户角色）
  hasAnyRole(['ROLE_SYSTEM_ADMIN', 'ROLE_SCHOOL_ADMIN'])
  
  // 检查是否拥有所有指定角色（自动从Store获取用户角色）
  hasAllRoles(['ROLE_SYSTEM_ADMIN', 'ROLE_SCHOOL_ADMIN'])
  ```
- **兼容性说明**：函数同时支持旧代码的调用方式（传入角色列表作为第一个参数），但推荐使用新方式（自动从Store获取）

##### 3.7.3.2 获取当前用户角色
- **自动获取**：权限函数会自动从Store获取当前用户角色，通常不需要手动获取
- **如需手动获取**：用户登录后，角色信息存储在Store中
- **使用示例**：
  ```javascript
  import { useAuthStore } from '@/store/modules/auth'
  
  const authStore = useAuthStore()
  const roles = authStore.roles  // 获取当前用户角色列表
  ```

#### 3.7.4 路由权限控制

##### 3.7.4.1 路由配置规范
- **路由meta配置**：在路由配置中添加`roles`字段，指定可访问的角色
- **配置示例**：
  ```javascript
  {
    path: '/admin/student',
    name: 'StudentManagement',
    component: () => import('@/views/admin/StudentManagement.vue'),
    meta: {
      title: '学生管理',
      requiresAuth: true,
      roles: ['ROLE_SYSTEM_ADMIN', 'ROLE_CLASS_TEACHER']  // 指定可访问的角色
    }
  }
  ```

##### 3.7.4.2 路由守卫实现
- **全局前置守卫**：在`router/index.js`中实现`beforeEach`守卫
- **权限检查逻辑**：
  ```javascript
  router.beforeEach((to, from, next) => {
    // 1. 检查是否需要登录
    if (to.meta.requiresAuth) {
      const token = getToken()
      if (!token) {
        next('/login')
        return
      }
    }
    
    // 2. 检查路由权限
    if (to.meta.roles) {
      const roles = store.getters.roles
      const hasPermission = to.meta.roles.some(role => roles.includes(role))
      if (!hasPermission) {
        // 无权限，跳转到403页面或首页
        next('/403')
        return
      }
    }
    
    next()
  })
  ```

#### 3.7.5 菜单权限控制

##### 3.7.5.1 菜单显示控制
- **根据角色过滤菜单**：在菜单组件中根据用户角色过滤显示的菜单项
- **实现示例**：
  ```javascript
  // 在MainLayout.vue或菜单组件中
  const menuItems = computed(() => {
    const roles = store.getters.roles
    return allMenuItems.filter(item => {
      // 如果没有配置roles，则所有角色都可以访问
      if (!item.roles) {
        return true
      }
      // 检查用户是否拥有菜单要求的角色
      return item.roles.some(role => roles.includes(role))
    })
  })
  ```

##### 3.7.5.2 菜单配置示例
```javascript
const menuItems = [
  {
    title: '学生管理',
    path: '/admin/student',
    icon: 'User',
    roles: ['ROLE_SYSTEM_ADMIN', 'ROLE_CLASS_TEACHER']  // 只有系统管理员和班主任可以访问
  },
  {
    title: '企业管理',
    path: '/admin/enterprise',
    icon: 'OfficeBuilding',
    roles: ['ROLE_SYSTEM_ADMIN', 'ROLE_SCHOOL_ADMIN']  // 系统管理员和学校管理员可以访问
  }
]
```

#### 3.7.6 按钮权限控制

##### 3.7.6.1 使用v-if控制按钮显示
- **推荐方式**：使用`v-if`和权限检查函数控制按钮显示
- **实现示例**：
  ```vue
  <template>
    <!-- 只有系统管理员和班主任可以显示批量导入按钮 -->
    <el-button 
      v-if="hasAnyRole(['ROLE_SYSTEM_ADMIN', 'ROLE_CLASS_TEACHER'])"
      @click="handleImport"
    >
      批量导入
    </el-button>
    
    <!-- 只有系统管理员和企业管理员可以显示编辑按钮 -->
    <el-button 
      v-if="hasAnyRole(['ROLE_SYSTEM_ADMIN', 'ROLE_ENTERPRISE_ADMIN'])"
      @click="handleEdit"
    >
      编辑
    </el-button>
    
    <!-- 学校管理员只能查看，不能编辑 -->
    <el-button 
      v-if="hasRole('ROLE_SCHOOL_ADMIN')"
      @click="handleView"
    >
      查看
    </el-button>
  </template>
  
  <script setup>
  import { hasRole, hasAnyRole } from '@/utils/permission'
  // 注意：权限函数会自动从Store获取用户角色，无需手动传入
  </script>
  ```

##### 3.7.6.2 权限指令（可选）
- **创建权限指令**：`v-permission`，用于控制元素显示
- **实现示例**：
  ```javascript
  // directives/permission.js
  import { hasAnyRole } from '@/utils/permission'
  
  export default {
    mounted(el, binding) {
      const { value } = binding
      if (value && !hasAnyRole(value)) {
        el.parentNode && el.parentNode.removeChild(el)
      }
    }
  }
  ```
- **使用示例**：
  ```vue
  <el-button v-permission="['ROLE_SYSTEM_ADMIN', 'ROLE_ENTERPRISE_ADMIN']">
    编辑
  </el-button>
  ```

#### 3.7.7 特殊业务权限控制规则

##### 3.7.7.1 企业管理页面权限规则
- **查看权限**：系统管理员、学校管理员、企业管理员都可以查看
- **编辑按钮**：只显示给系统管理员和企业管理员（学校管理员不显示编辑按钮）
- **实现示例**：
  ```vue
  <template>
    <el-table-column label="操作">
      <template #default="{ row }">
        <!-- 只有系统管理员和企业管理员可以编辑 -->
        <el-button 
          v-if="hasAnyRole(['ROLE_SYSTEM_ADMIN', 'ROLE_ENTERPRISE_ADMIN'])"
          @click="handleEdit(row)"
        >
          编辑
        </el-button>
        <!-- 所有有查看权限的角色都可以查看详情 -->
        <el-button 
          v-if="hasAnyRole(['ROLE_SYSTEM_ADMIN', 'ROLE_SCHOOL_ADMIN', 'ROLE_ENTERPRISE_ADMIN'])"
          @click="handleView(row)"
        >
          查看
        </el-button>
      </template>
    </el-table-column>
  </template>
  ```

##### 3.7.7.2 企业导师管理页面权限规则
- **查看权限**：系统管理员、学校管理员、企业管理员都可以查看
- **管理按钮**：只显示给系统管理员和企业管理员（学校管理员不显示添加/编辑/删除按钮）
- **实现示例**：
  ```vue
  <template>
    <!-- 只有系统管理员和企业管理员可以添加企业导师 -->
    <el-button 
      v-if="hasAnyRole(['ROLE_SYSTEM_ADMIN', 'ROLE_ENTERPRISE_ADMIN'])"
      @click="handleAdd"
    >
      添加企业导师
    </el-button>
    
    <el-table-column label="操作">
      <template #default="{ row }">
        <!-- 只有系统管理员和企业管理员可以编辑/删除 -->
        <el-button 
          v-if="hasAnyRole(['ROLE_SYSTEM_ADMIN', 'ROLE_ENTERPRISE_ADMIN'])"
          @click="handleEdit(row)"
        >
          编辑
        </el-button>
        <el-button 
          v-if="hasAnyRole(['ROLE_SYSTEM_ADMIN', 'ROLE_ENTERPRISE_ADMIN'])"
          @click="handleDelete(row)"
        >
          删除
        </el-button>
      </template>
    </el-table-column>
  </template>
  ```

##### 3.7.7.3 学生管理页面权限规则
- **查看权限**：系统管理员、班主任可以查看
- **批量导入按钮**：只显示给系统管理员和班主任
- **实现示例**：
  ```vue
  <template>
    <!-- 只有系统管理员和班主任可以批量导入 -->
    <el-button 
      v-if="hasAnyRole(['ROLE_SYSTEM_ADMIN', 'ROLE_CLASS_TEACHER'])"
      @click="handleImport"
    >
      批量导入
    </el-button>
  </template>
  ```

#### 3.7.8 权限控制最佳实践

##### 3.7.8.1 权限检查函数封装
- **统一封装**：在`@/utils/permission.js`中封装权限检查函数
- **自动获取角色**：函数会自动从Store获取当前用户角色，无需手动传入
- **实现示例**：
  ```javascript
  // utils/permission.js
  import { useAuthStore } from '@/store/modules/auth'
  
  /**
   * 获取当前用户角色列表
   * @param {string[]} [providedRoles] 可选：提供的角色列表（用于兼容旧代码）
   * @returns {string[]} 角色列表
   */
  function getCurrentUserRoles(providedRoles) {
    // 如果提供了角色列表，优先使用（兼容旧代码）
    if (providedRoles && Array.isArray(providedRoles)) {
      return providedRoles
    }
    // 否则从Store获取
    try {
      const authStore = useAuthStore()
      return authStore.roles || []
    } catch (error) {
      return []
    }
  }
  
  /**
   * 检查是否拥有指定角色
   * @param {string} role 角色代码
   * @returns {boolean}
   */
  export function hasRole(role) {
    if (!role) {
      return false
    }
    const roles = getCurrentUserRoles()
    return roles.includes(role)
  }
  
  /**
   * 检查是否拥有任意一个角色
   * @param {string[]} requiredRoles 需要的角色代码数组
   * @returns {boolean}
   */
  export function hasAnyRole(requiredRoles) {
    if (!requiredRoles || !Array.isArray(requiredRoles) || requiredRoles.length === 0) {
      return false
    }
    const roles = getCurrentUserRoles()
    if (!roles || roles.length === 0) {
      return false
    }
    return requiredRoles.some(role => roles.includes(role))
  }
  
  /**
   * 检查是否拥有所有指定角色
   * @param {string[]} requiredRoles 需要的角色代码数组
   * @returns {boolean}
   */
  export function hasAllRoles(requiredRoles) {
    if (!requiredRoles || !Array.isArray(requiredRoles) || requiredRoles.length === 0) {
      return false
    }
    const roles = getCurrentUserRoles()
    if (!roles || roles.length === 0) {
      return false
    }
    return requiredRoles.every(role => roles.includes(role))
  }
  ```

##### 3.7.8.2 组合式API中使用权限
```vue
<script setup>
import { computed } from 'vue'
import { hasRole, hasAnyRole } from '@/utils/permission'

// 计算属性：是否显示编辑按钮（权限函数自动从Store获取角色）
const canEdit = computed(() => {
  return hasAnyRole(['ROLE_SYSTEM_ADMIN', 'ROLE_ENTERPRISE_ADMIN'])
})

// 计算属性：是否显示删除按钮（权限函数自动从Store获取角色）
const canDelete = computed(() => {
  return hasAnyRole(['ROLE_SYSTEM_ADMIN', 'ROLE_ENTERPRISE_ADMIN'])
})
</script>

<template>
  <el-button v-if="canEdit" @click="handleEdit">编辑</el-button>
  <el-button v-if="canDelete" @click="handleDelete">删除</el-button>
</template>
```

#### 3.7.9 权限控制检查清单
开发新页面时，必须检查以下权限控制点：
- [ ] 路由是否配置了`roles`字段
- [ ] 菜单项是否根据角色过滤显示
- [ ] 按钮是否根据角色控制显示/隐藏
- [ ] 是否使用了统一的权限检查函数
- [ ] 是否考虑了所有角色的权限需求
- [ ] 是否测试了不同角色的权限控制效果
- [ ] 权限控制是否与后端保持一致

### 3.8 页面设计规范

#### 3.8.1 布局规范
- 统一使用响应式布局，支持PC、平板、移动端
- 顶部导航栏：用户信息、消息通知、系统设置
- 左侧菜单栏：根据角色动态生成
- 主内容区：页面具体内容

#### 3.8.2 页面组件规范
- 列表页面：搜索栏、数据表格、分页组件
- 表单页面：表单验证、提交按钮、取消按钮
- 详情页面：信息展示、操作按钮
- 仪表盘页面：统计卡片、图表组件

#### 3.8.3 交互规范
- 操作反馈：成功提示、错误提示、加载状态
- 表单验证：实时验证、提交前验证
- 数据加载：显示加载状态、骨架屏
- 错误处理：友好的错误提示

### 3.9 样式规范

#### 3.9.1 CSS命名规范
- 使用BEM命名规范或类名语义化
- 避免使用全局样式，使用scoped样式
- 公共样式放在`assets/styles`目录

#### 3.9.2 样式组织规范
- 组件样式使用`<style scoped>`
- 公共样式使用全局样式文件
- 主题色、字体等使用CSS变量

### 3.9 代码注释规范

#### 3.9.1 组件注释
- 组件文件头部添加组件说明
- 组件注释只包含功能描述，不包含作者和日期信息
- 复杂逻辑添加行内注释
- 方法添加注释说明功能

#### 3.9.2 API注释
- API方法添加注释，说明接口功能、参数、返回值

## 四、开发工具配置规范

### 4.1 代码格式化
- 使用Prettier进行代码格式化
- 使用ESLint进行代码检查
- 提交前自动格式化代码

### 4.2 Git提交规范
- 提交信息格式：`类型(范围): 描述`
- 类型：`feat`（新功能）、`fix`（修复）、`docs`（文档）、`style`（格式）、`refactor`（重构）、`test`（测试）、`chore`（构建）
- 示例：`feat(user): 添加学生注册功能`

### 4.3 接口文档规范
- 使用Swagger生成API文档
- 所有Controller方法必须添加`@ApiOperation`注解
- 所有实体类必须添加`@ApiModel`注解
- 所有参数必须添加`@ApiParam`或`@ApiModelProperty`注解

## 五、安全规范

### 5.1 数据安全
- 敏感数据加密存储（密码使用BCrypt加密）
- SQL注入防护：使用参数化查询
- XSS防护：前后端数据校验和转义

### 5.2 接口安全
- 所有接口必须进行身份认证（除登录、注册接口）
- 敏感操作必须进行二次验证
- 接口请求频率限制，防止暴力攻击

### 5.3 前端安全
- Token存储在localStorage或sessionStorage
- 敏感信息不在前端存储
- 用户输入必须进行校验和转义

## 六、测试规范

### 6.1 单元测试
- Service层方法必须编写单元测试
- 测试覆盖率要求达到70%以上
- 使用JUnit进行单元测试

### 6.2 接口测试
- 所有接口必须进行接口测试
- 使用Postman或Swagger进行接口测试
- 测试用例覆盖正常流程和异常流程

### 6.3 前端测试
- 关键功能进行E2E测试
- 使用Cypress或Playwright进行测试

## 七、部署规范

### 7.1 环境配置
- 开发环境：本地开发
- 测试环境：内网测试服务器
- 生产环境：正式服务器

### 7.2 配置文件管理
- 使用`application.yml`进行配置
- 不同环境使用不同的配置文件
- 敏感信息使用环境变量或配置中心

### 7.3 日志规范
- 使用Logback进行日志管理
- 日志级别：DEBUG、INFO、WARN、ERROR
- 日志文件按日期分割，保留30天

## 八、性能优化规范

### 8.1 数据库优化
- 合理使用索引，避免全表扫描
- 避免N+1查询问题，使用关联查询
- 大数据量查询使用分页

### 8.2 缓存优化
- 频繁查询的数据使用Redis缓存
- 缓存过期时间合理设置
- 缓存更新策略：先更新数据库，再更新缓存

### 8.3 前端优化
- 路由懒加载，减少首屏加载时间
- 图片懒加载，优化页面性能
- 合理使用防抖和节流

## 九、文档规范

### 9.1 代码文档
- 所有公共方法必须添加JavaDoc注释
- 复杂业务逻辑必须添加注释说明
- API接口必须生成Swagger文档

### 9.2 开发文档
- 数据库设计文档
- 接口设计文档
- 部署文档
- 运维文档


