# 评价功能融合方案设计

## 一、现状分析

### 1.1 现有功能
- **日志批阅**：教师对学生的实习日志进行批阅，包含批阅意见（reviewComment）和批阅评分（reviewScore，0-100分）
- **周报批阅**：教师对学生的周报进行批阅，包含批阅意见和批阅评分
- **成果审核**：教师对学生的阶段性成果进行审核
- **考勤管理**：企业管理员/企业导师可以确认考勤，班主任、学院负责人、学校管理员可以查看考勤（只读）

### 1.2 新增功能
- **企业评价**：实习结束后，企业导师对学生的5项指标进行评价
- **学校评价**：实习结束后，教师对学生的4项指标进行评价
- **学生自评**：实习结束后，学生进行自我评价
- **综合成绩**：自动计算综合成绩（企业40% + 学校40% + 自评20%）

### 1.3 功能定位区别
- **日志/周报批阅**：过程跟踪中的日常批阅，用于指导学生学习，评分是单项评分
- **评价功能**：实习结束后的综合评价，用于最终成绩评定，评分是多维度综合评分

### 1.4 学校评价指标说明
**学校评价的4项指标与现有功能的对应关系：**
1. **日志周报质量**：基于日志和周报的批阅评分（可自动计算或手动评分）
2. **过程表现**：教师根据学生整体表现评分（可参考日志、周报、考勤记录）
3. **成果展示**：基于阶段性成果的审核情况评分（可查看成果详情）
4. **总结反思**：根据学生自评中的总结反思评分（可查看学生自评内容）

**注意：** 系统没有"实习报告"功能，因此用"日志周报质量"替代"实习报告质量"指标。

---

## 二、融合方案设计（方案一：保留分离方案）⭐

### 2.1 设计理念
**保持功能定位清晰，日志/周报批阅用于过程指导，评价功能用于最终评定**

### 2.2 功能设计

#### 2.2.1 日志/周报批阅（保留现有功能）
- **功能定位**：过程跟踪中的日常批阅和指导
- **使用场景**：实习过程中，教师随时批阅学生的日志和周报
- **评分作用**：用于过程表现参考，不作为最终成绩
- **保留字段**：`reviewComment`（批阅意见）、`reviewScore`（批阅评分）

#### 2.2.2 评价功能（新增）
- **功能定位**：实习结束后的综合评价
- **使用场景**：实习结束后，三方进行最终评价
- **评分作用**：用于计算最终综合成绩
- **评价时机**：实习状态为"实习结束"时才能填写

### 2.3 菜单设计

#### 2.3.1 企业端菜单
```
实习管理
├── 岗位管理
├── 申请管理
├── 实习学生管理
├── 面试管理
├── 考勤管理
├── 实习日志查看（查看学生日志，可批阅）
├── 周报查看（查看学生周报，可批阅）
├── 成果审核
├── 问题反馈处理
└── 学生评价管理（新增）⭐
    ├── 待评价学生列表
    ├── 已评价记录
    └── 评价统计
```

#### 2.3.2 教师端菜单
```
实习管理
├── 实习日志批阅（过程批阅，保留评分功能）
├── 周报批阅（过程批阅，保留评分功能）
├── 成果审核
├── 问题反馈处理
├── 考勤查看（只读，新增）⭐
└── 学生评价管理（新增）⭐
    ├── 待评价学生列表
    ├── 已评价记录
    └── 评价统计
```

#### 2.3.3 学生端菜单
```
实习管理
├── 岗位列表
├── 实习申请
├── 我的面试
├── 我的实习
├── 实习日志（查看批阅意见和评分）
├── 周报（查看批阅意见和评分）
├── 我的考勤
├── 阶段性成果
├── 问题反馈
├── 自我评价（新增）⭐
└── 综合成绩查看（新增）⭐
```

#### 2.3.4 管理员端菜单
```
实习管理
├── 实习计划管理
├── 岗位管理
├── 实习申请审核
├── 实习日志批阅
├── 周报批阅
├── 成果审核
├── 考勤查看（只读，新增）⭐
└── 评价管理（新增）⭐
    ├── 评价进度监控
    ├── 综合成绩管理
    └── 评价统计分析
```

### 2.4 页面设计

#### 2.4.1 企业评价页面
- 显示待评价学生列表（实习已结束的学生）
- 点击学生进入评价表单
- 5项指标打分（0-100分）+ 评价意见
- **参考数据**：显示该学生的日志、周报、阶段性成果、考勤记录（只读，作为参考）

#### 2.4.2 学校评价页面
- 显示待评价学生列表（实习已结束的学生）
- 点击学生进入评价表单
- 4项指标打分（日志周报质量、过程表现、成果展示、总结反思，0-100分）+ 评价意见
- **参考数据**：显示该学生的日志、周报、阶段性成果、考勤记录（只读，作为参考）

#### 2.4.3 综合成绩页面
- 显示综合成绩详情
- 显示企业评价、学校评价、学生自评的详细分数
- 显示日志/周报的平均批阅分数（作为参考，不参与计算）

### 2.5 考勤查看权限说明

**考勤查看权限：**
- **学生**：可以查看自己的考勤记录
- **企业管理员/企业导师**：可以查看本企业实习生的考勤记录，并且可以确认考勤
- **班主任**：可以查看本班学生的考勤记录（只读，不能确认）
- **学院负责人**：可以查看本院学生的考勤记录（只读，不能确认）
- **学校管理员**：可以查看本校学生的考勤记录（只读，不能确认）
- **系统管理员**：可以查看所有考勤记录

**考勤确认权限：**
- 只有**企业管理员**和**企业导师**可以确认考勤
- 学校端的角色（班主任、学院负责人、学校管理员）只能查看考勤，不能确认考勤

### 2.6 优势
✅ 功能定位清晰，过程批阅和最终评价分离  
✅ 不影响现有功能，向后兼容  
✅ 日志/周报批阅评分可作为学校评价的参考依据  
✅ 用户体验好，功能职责明确  
✅ 企业评价和学校评价都有充分的参考数据  

### 2.7 劣势
❌ 需要维护两套评分体系  
❌ 可能造成用户困惑（为什么有两个评分）  

---

## 三、菜单名称设计方案

### 3.1 不同角色的菜单名称

#### 3.1.1 企业端菜单名称
```
实习管理
├── 岗位管理
├── 申请管理
├── 实习学生管理
├── 面试管理
├── 考勤管理
├── 实习日志查看（或：学生日志查看）
├── 周报查看（或：学生周报查看）
├── 成果查看
├── 问题反馈处理
└── 学生评价（或：实习生评价、学生评价管理）
```

#### 3.1.2 教师端菜单名称
```
实习管理
├── 实习日志批阅（或：日志批阅）
├── 周报批阅
├── 成果审核
├── 问题反馈处理
├── 考勤查看（新增）⭐
└── 学生评价（或：实习评价、学生评价管理）
```

#### 3.1.3 学生端菜单名称
```
实习管理
├── 岗位列表
├── 实习申请
├── 我的面试
├── 我的实习
├── 实习日志
├── 周报
├── 我的考勤
├── 阶段性成果
├── 问题反馈
├── 自我评价（或：我的自评）
└── 综合成绩（或：我的成绩、实习成绩）
```

#### 3.1.4 管理员端菜单名称
```
实习管理
├── 实习计划管理
├── 岗位管理
├── 实习申请审核
├── 实习日志批阅
├── 周报批阅
├── 成果审核
├── 考勤查看（新增）⭐
└── 评价管理（或：实习评价管理、评价统计分析）
```

### 3.2 菜单配置示例

```javascript
// 企业端菜单
{
  index: '/enterprise/evaluation',
  title: '学生评价',  // 或：实习生评价
  icon: DocumentChecked,
  roles: ['ROLE_ENTERPRISE_ADMIN', 'ROLE_ENTERPRISE_MENTOR'],
  titleMap: {
    'ROLE_ENTERPRISE_ADMIN': '学生评价',
    'ROLE_ENTERPRISE_MENTOR': '实习生评价'
  }
}

// 教师端菜单
{
  index: '/teacher/evaluation',
  title: '学生评价',
  icon: DocumentChecked,
  roles: ['ROLE_CLASS_TEACHER', 'ROLE_SCHOOL_ADMIN', 'ROLE_COLLEGE_LEADER']
}

// 学生端菜单
{
  index: '/student/self-evaluation',
  title: '自我评价',
  icon: EditPen,
  roles: ['ROLE_STUDENT']
},
{
  index: '/student/comprehensive-score',
  title: '综合成绩',
  icon: DocumentChecked,
  roles: ['ROLE_STUDENT']
}

// 管理员端菜单
{
  index: '/admin/evaluation',
  title: '评价管理',
  icon: DocumentChecked,
  roles: ['ROLE_SYSTEM_ADMIN', 'ROLE_SCHOOL_ADMIN', 'ROLE_COLLEGE_LEADER']
}
```

---

## 四、详细页面设计

### 4.1 企业评价页面详细设计

#### 4.1.1 待评价学生列表页面

**页面布局：**
```
┌─────────────────────────────────────────────────┐
│ 学生评价管理                                    │
├─────────────────────────────────────────────────┤
│ 筛选条件：                                       │
│ [实习状态：实习结束 ▼] [学生姓名：____] [搜索] │
├─────────────────────────────────────────────────┤
│ 学生列表：                                       │
│ ┌───────────────────────────────────────────┐ │
│ │ 学号    │ 姓名 │ 企业 │ 实习时间 │ 状态 │操作│ │
│ ├───────────────────────────────────────────┤ │
│ │ 2021001 │ 张三 │ XX公司│ 3-6月   │待评价│评价│ │
│ │ 2021002 │ 李四 │ YY公司│ 3-6月   │已评价│查看│ │
│ └───────────────────────────────────────────┘ │
│ 分页：[1] [2] [3]                               │
└─────────────────────────────────────────────────┘
```

**功能说明：**
- 只显示实习状态为"实习结束"的学生
- 显示评价状态：待评价、已评价
- 支持按学生姓名、企业名称筛选
- 点击"评价"按钮进入评价表单

#### 4.1.2 企业评价表单页面

**页面布局：**
```
┌─────────────────────────────────────────────────┐
│ 企业评价 - 张三（学号：2021001）                │
├─────────────────────────────────────────────────┤
│ 学生信息：                                       │
│ 姓名：张三 | 学号：2021001 | 企业：XX科技有限公司│
│ 实习时间：2024-03-01 至 2024-06-30              │
├─────────────────────────────────────────────────┤
│ 参考信息（可折叠）：                             │
│ ▼ 日志周报情况                                   │
│   日志：已提交15篇，平均批阅分数：85分           │
│   周报：已提交12篇，平均批阅分数：88分           │
│   [查看日志列表] [查看周报列表]                  │
│ ▼ 阶段性成果                                     │
│   已提交3个成果，全部通过审核                    │
│   [查看成果列表]                                 │
│ ▼ 考勤记录                                       │
│   出勤率95%，迟到2次，请假1次                    │
│   [查看考勤记录]                                 │
├─────────────────────────────────────────────────┤
│ 评价指标（必填）：                               │
│ 1. 工作态度：[输入框 0-100分] ⭐                 │
│ 2. 专业知识应用：[输入框 0-100分] ⭐             │
│ 3. 专业技能：[输入框 0-100分] ⭐                 │
│ 4. 团队协作：[输入框 0-100分] ⭐                 │
│ 5. 创新意识：[输入框 0-100分] ⭐                 │
│                                                  │
│ 总分：[自动计算显示] 82.00分                     │
│                                                  │
│ 评价意见：[文本域，可选]                         │
│ ┌───────────────────────────────────────────┐ │
│ │                                            │ │
│ │                                            │ │
│ └───────────────────────────────────────────┘ │
│                                                  │
│ [保存草稿] [提交评价] [取消]                    │
└─────────────────────────────────────────────────┘
```

**功能说明：**
- 5项指标必填，每项0-100分
- 总分自动计算（5项指标的平均分）
- 可查看学生的日志、周报、阶段性成果、考勤记录作为参考（只读）
- 支持保存草稿，可多次编辑
- 提交后7天内可修改

### 4.2 学校评价页面详细设计

#### 4.2.1 待评价学生列表页面

**页面布局：**
```
┌─────────────────────────────────────────────────┐
│ 学生评价管理                                    │
├─────────────────────────────────────────────────┤
│ 筛选条件：                                       │
│ [专业：____] [班级：____] [学生姓名：____] [搜索]│
├─────────────────────────────────────────────────┤
│ 学生列表：                                       │
│ ┌───────────────────────────────────────────┐ │
│ │ 学号    │ 姓名 │ 企业 │ 实习时间 │ 状态 │操作│ │
│ ├───────────────────────────────────────────┤ │
│ │ 2021001 │ 张三 │ XX公司│ 3-6月   │待评价│评价│ │
│ │ 2021002 │ 李四 │ YY公司│ 3-6月   │已评价│查看│ │
│ └───────────────────────────────────────────┘ │
│ 分页：[1] [2] [3]                               │
└─────────────────────────────────────────────────┘
```

#### 4.2.2 学校评价表单页面

**页面布局：**
```
┌─────────────────────────────────────────────────┐
│ 学校评价 - 张三（学号：2021001）                │
├─────────────────────────────────────────────────┤
│ 学生信息：                                       │
│ 姓名：张三 | 学号：2021001 | 专业：计算机科学   │
│ 企业：XX科技有限公司 | 实习时间：2024-03-01 至 2024-06-30│
├─────────────────────────────────────────────────┤
│ 参考数据（标签页）：                             │
│ [日志周报] [考勤记录] [阶段性成果] [学生自评]   │
│                                                  │
│ 日志周报情况：                                   │
│ • 日志：已提交15篇，平均批阅分数：85分           │
│   [查看日志列表]                                 │
│ • 周报：已提交12篇，平均批阅分数：88分           │
│   [查看周报列表]                                 │
│ • 建议分数：86.5分（日志85分×50% + 周报88分×50%）│
├─────────────────────────────────────────────────┤
│ 评价指标（必填）：                               │
│ 1. 日志周报质量：[输入框 0-100分] ⭐             │
│    [参考：建议86.5分] [一键填入建议分数]         │
│                                                  │
│ 2. 过程表现：[输入框 0-100分] ⭐                 │
│    [查看日志] [查看周报] [查看考勤] [查看反馈]   │
│                                                  │
│ 3. 成果展示：[输入框 0-100分] ⭐                 │
│    [查看成果列表]（已提交3个成果，全部通过审核） │
│                                                  │
│ 4. 总结反思：[输入框 0-100分] ⭐                 │
│    [查看学生自评]（已填写，总结反思字数：500字） │
│                                                  │
│ 总分：[自动计算显示] 85.00分                     │
│                                                  │
│ 评价意见：[文本域，可选]                         │
│ ┌───────────────────────────────────────────┐ │
│ │                                            │ │
│ │                                            │ │
│ └───────────────────────────────────────────┘ │
│                                                  │
│ [保存草稿] [提交评价] [取消]                    │
└─────────────────────────────────────────────────┘
```

**功能说明：**
- 4项指标必填，每项0-100分
- 日志周报质量可参考建议分数，支持一键填入
- 可查看学生的日志、周报、考勤、成果、自评作为参考
- 总分自动计算（4项指标的平均分）
- 支持保存草稿，可多次编辑
- 提交后7天内可修改

### 4.3 学生自评页面详细设计

**页面布局：**
```
┌─────────────────────────────────────────────────┐
│ 自我评价                                        │
├─────────────────────────────────────────────────┤
│ 实习信息：                                       │
│ 企业：XX科技有限公司                             │
│ 实习时间：2024-03-01 至 2024-06-30              │
│ 实习岗位：Java开发工程师                         │
├─────────────────────────────────────────────────┤
│ 自评表单：                                       │
│                                                  │
│ 自评分数：[输入框 0-100分] ⭐                    │
│ 说明：请根据自己在实习期间的表现，给自己打分    │
│                                                  │
│ 自我反思和总结：[富文本编辑器] ⭐                │
│ ┌───────────────────────────────────────────┐ │
│ │                                            │ │
│ │ 请填写：                                    │ │
│ │ 1. 实习期间的主要工作内容和收获             │ │
│ │ 2. 遇到的困难和解决方法                     │ │
│ │ 3. 对实习过程的反思和总结                   │ │
│ │ 4. 未来的职业规划                           │ │
│ │                                            │ │
│ └───────────────────────────────────────────┘ │
│                                                  │
│ [保存草稿] [提交自评] [取消]                    │
└─────────────────────────────────────────────────┘
```

**功能说明：**
- 自评分数必填，0-100分
- 自我反思和总结使用富文本编辑器（RichTextEditor组件）
- 支持保存草稿，可多次编辑
- 提交后7天内可修改

### 4.4 综合成绩查看页面详细设计

#### 4.4.1 学生端综合成绩页面

**页面布局：**
```
┌─────────────────────────────────────────────────┐
│ 我的综合成绩                                    │
├─────────────────────────────────────────────────┤
│ 实习信息：                                       │
│ 企业：XX科技有限公司                             │
│ 实习时间：2024-03-01 至 2024-06-30              │
├─────────────────────────────────────────────────┤
│ 综合成绩：                                       │
│ ┌───────────────────────────────────────────┐ │
│ │ 综合成绩：85.60分                          │ │
│ │ 等级：良好                                 │ │
│ │ 计算时间：2024-07-01 10:30:00              │ │
│ └───────────────────────────────────────────┘ │
├─────────────────────────────────────────────────┤
│ 评价详情：                                       │
│                                                  │
│ 1. 企业评价：82.00分（权重40%）                 │
│    ┌───────────────────────────────────────┐ │
│    │ 工作态度：85分                         │ │
│    │ 专业知识应用：80分                     │ │
│    │ 专业技能：82分                         │ │
│    │ 团队协作：88分                         │ │
│    │ 创新意识：75分                         │ │
│    │ 评价意见：该学生工作认真负责...         │ │
│    └───────────────────────────────────────┘ │
│                                                  │
│ 2. 学校评价：85.00分（权重40%）                 │
│    ┌───────────────────────────────────────┐ │
│    │ 日志周报质量：86.5分                   │ │
│    │ 过程表现：85分                         │ │
│    │ 成果展示：88分                         │ │
│    │ 总结反思：80分                         │ │
│    │ 评价意见：该学生实习表现良好...         │ │
│    └───────────────────────────────────────┘ │
│                                                  │
│ 3. 学生自评：90.00分（权重20%）                 │
│    ┌───────────────────────────────────────┐ │
│    │ 自评分数：90分                         │ │
│    │ 自我反思和总结：[显示富文本内容]        │ │
│    └───────────────────────────────────────┘ │
├─────────────────────────────────────────────────┤
│ 成绩计算说明：                                   │
│ 综合成绩 = 企业评价82.00分 × 40% + 学校评价85.00分 × 40% + 自评90.00分 × 20%│
│ = 32.80 + 34.00 + 18.00 = 84.80分              │
└─────────────────────────────────────────────────┘
```

#### 4.4.2 教师/管理员端综合成绩列表页面

**页面布局：**
```
┌─────────────────────────────────────────────────┐
│ 综合成绩管理                                    │
├─────────────────────────────────────────────────┤
│ 筛选条件：                                       │
│ [专业：____] [班级：____] [成绩范围：____] [搜索]│
├─────────────────────────────────────────────────┤
│ 成绩列表：                                       │
│ ┌───────────────────────────────────────────┐ │
│ │ 学号    │ 姓名 │ 企业评价│学校评价│自评│综合│等级│操作│ │
│ ├───────────────────────────────────────────┤ │
│ │ 2021001 │ 张三 │ 82.00   │ 85.00  │90 │85.6│良好│查看│ │
│ │ 2021002 │ 李四 │ 88.00   │ 90.00  │85 │88.2│良好│查看│ │
│ └───────────────────────────────────────────┘ │
│ 分页：[1] [2] [3]                               │
│ [导出Excel]                                     │
└─────────────────────────────────────────────────┘
```

---

## 五、数据流转与状态管理

### 5.1 评价流程状态流转

```
实习申请状态流转：
已录用(3) → 实习中(6) → 实习结束(7) → 已评价(8)

评价完成状态：
┌─────────────┐
│ 实习结束(7) │
└──────┬──────┘
       │
       ├─→ 企业评价完成
       ├─→ 学校评价完成
       └─→ 学生自评完成
            │
            ↓
       ┌─────────────┐
       │ 三个评价都完成 │
       └──────┬──────┘
              │
              ↓
       ┌─────────────┐
       │ 自动计算综合成绩 │
       └──────┬──────┘
              │
              ↓
       ┌─────────────┐
       │ 已评价(8)    │
       └─────────────┘
```

### 5.2 评价完成检查逻辑

**后端实现：**
```java
/**
 * 检查三个评价是否都完成
 * @param applyId 申请ID
 * @return true-都完成，false-未完成
 */
public boolean checkAllEvaluationsCompleted(Long applyId) {
    // 1. 检查企业评价
    EnterpriseEvaluation enterpriseEval = enterpriseEvaluationMapper.selectOne(
        new LambdaQueryWrapper<EnterpriseEvaluation>()
            .eq(EnterpriseEvaluation::getApplyId, applyId)
            .eq(EnterpriseEvaluation::getDeleteFlag, DeleteFlag.NORMAL.getCode())
    );
    
    // 2. 检查学校评价
    SchoolEvaluation schoolEval = schoolEvaluationMapper.selectOne(
        new LambdaQueryWrapper<SchoolEvaluation>()
            .eq(SchoolEvaluation::getApplyId, applyId)
            .eq(SchoolEvaluation::getDeleteFlag, DeleteFlag.NORMAL.getCode())
    );
    
    // 3. 检查学生自评
    SelfEvaluation selfEval = selfEvaluationMapper.selectOne(
        new LambdaQueryWrapper<SelfEvaluation>()
            .eq(SelfEvaluation::getApplyId, applyId)
            .eq(SelfEvaluation::getDeleteFlag, DeleteFlag.NORMAL.getCode())
    );
    
    return enterpriseEval != null && schoolEval != null && selfEval != null;
}
```

### 5.3 综合成绩自动计算触发

**事件监听方式（推荐）：**
```java
// 在企业评价、学校评价、学生自评提交后发布事件
@Autowired
private ApplicationEventPublisher eventPublisher;

public EnterpriseEvaluation addEvaluation(EnterpriseEvaluation evaluation) {
    // ... 保存评价
    
    // 发布评价完成事件
    EvaluationCompletedEvent event = new EvaluationCompletedEvent();
    event.setApplyId(evaluation.getApplyId());
    event.setStudentId(evaluation.getStudentId());
    event.setEvaluationType("ENTERPRISE");
    eventPublisher.publishEvent(event);
    
    return evaluation;
}

// 事件监听器
@Async
@EventListener
public void handleEvaluationCompleted(EvaluationCompletedEvent event) {
    // 检查三个评价是否都完成
    if (checkAllEvaluationsCompleted(event.getApplyId())) {
        // 自动计算综合成绩
        comprehensiveScoreService.calculateComprehensiveScore(event.getApplyId());
        
        // 更新实习申请状态为"已评价"
        InternshipApply apply = applyMapper.selectById(event.getApplyId());
        apply.setStatus(InternshipApplyStatus.EVALUATED.getCode());
        applyMapper.updateById(apply);
    }
}
```

---

## 六、菜单配置完整代码

### 6.1 更新 menu.config.js

```javascript
// 在 menu.config.js 中添加评价相关菜单

// 企业端菜单 - 在"实习管理"下添加
{
  index: '/enterprise/evaluation',
  title: '学生评价',
  icon: DocumentChecked,
  roles: ['ROLE_ENTERPRISE_ADMIN', 'ROLE_ENTERPRISE_MENTOR'],
  titleMap: {
    'ROLE_ENTERPRISE_ADMIN': '学生评价管理',
    'ROLE_ENTERPRISE_MENTOR': '实习生评价'
  }
}

// 教师端菜单 - 在"实习管理"下添加
{
  index: '/teacher/evaluation',
  title: '学生评价',
  icon: DocumentChecked,
  roles: ['ROLE_CLASS_TEACHER', 'ROLE_SCHOOL_ADMIN', 'ROLE_COLLEGE_LEADER']
}

// 学生端菜单 - 在"实习管理"下添加
{
  index: '/student/self-evaluation',
  title: '自我评价',
  icon: EditPen,
  roles: ['ROLE_STUDENT']
},
{
  index: '/student/comprehensive-score',
  title: '综合成绩',
  icon: DocumentChecked,
  roles: ['ROLE_STUDENT']
}

// 管理员端菜单 - 在"实习管理"下添加
{
  index: '/admin/evaluation',
  title: '评价管理',
  icon: DocumentChecked,
  roles: ['ROLE_SYSTEM_ADMIN', 'ROLE_SCHOOL_ADMIN', 'ROLE_COLLEGE_LEADER']
}
```

---

## 七、实施步骤建议

### 7.1 第一阶段：数据库和实体类（1天）
1. 创建4张评价相关表
2. 创建实体类（EnterpriseEvaluation、SchoolEvaluation、SelfEvaluation、ComprehensiveScore）
3. 创建DTO类
4. 创建Mapper接口

### 7.2 第二阶段：后端Service层（2天）
1. 开发企业评价Service（第1天上午）
2. 开发学校评价Service（第1天下午）
3. 开发学生自评Service（第2天上午）
4. 开发综合成绩Service（第2天下午）
5. 实现事件监听机制

### 7.3 第三阶段：后端Controller层（1天）
1. 开发企业评价Controller
2. 开发学校评价Controller
3. 开发学生自评Controller
4. 开发综合成绩Controller
5. 添加权限控制和Swagger注解

### 7.4 第四阶段：前端API和页面（2天）
1. 创建API接口文件（第1天上午）
2. 开发企业评价页面（第1天下午）
3. 开发学校评价页面（第2天上午）
4. 开发学生自评页面（第2天下午）
5. 开发综合成绩查看页面

### 7.5 第五阶段：菜单和路由（0.5天）
1. 更新菜单配置
2. 添加路由配置
3. 测试菜单显示和权限控制

### 7.6 第六阶段：测试和优化（1.5天）
1. 功能测试
2. 权限测试
3. 边界情况测试
4. 性能优化

---

## 八、注意事项

### 8.1 数据一致性
- 确保评价提交时，实习状态为"实习结束"
- 确保综合成绩计算时，三个评价都已完成
- 确保状态更新和成绩计算的原子性（使用事务）

### 8.2 权限控制
- **企业评价**：只有企业管理员和企业导师可以评价本企业的学生
- **学校评价**：只有教师、班主任、学校管理员、学院负责人可以评价
- **学生自评**：只有学生本人可以填写和查看
- **综合成绩**：学生可以查看自己的，教师和管理员可以查看权限范围内的
- **考勤查看**：
  - 学生：可以查看自己的考勤记录
  - 企业管理员/企业导师：可以查看本企业实习生的考勤记录，并且可以确认考勤
  - 班主任：可以查看本班学生的考勤记录（只读，不能确认）
  - 学院负责人：可以查看本院学生的考勤记录（只读，不能确认）
  - 学校管理员：可以查看本校学生的考勤记录（只读，不能确认）
  - 系统管理员：可以查看所有考勤记录
- **考勤确认**：只有企业管理员和企业导师可以确认考勤

### 8.3 边界情况处理
- 学生没有提交日志/周报：日志周报质量由教师手动评分
- 学生没有提交阶段性成果：成果展示由教师根据其他表现评分
- 学生没有填写自评：总结反思由教师根据其他信息评分
- 评价提交后7天内可修改，超过7天不可修改

### 8.4 性能优化
- 评价列表查询使用分页
- 参考数据（日志、周报等）使用懒加载
- 综合成绩计算使用异步处理
- 统计查询使用Redis缓存

---

## 九、最终建议

**采用保留分离方案**，理由：
1. 功能定位清晰，不会造成用户困惑
2. 向后兼容，不影响现有功能
3. 实施简单，风险低
4. 灵活性高，教师可以参考过程批阅情况
5. 企业评价和学校评价都有充分的参考数据

**菜单名称建议：**
- 企业端：`学生评价` 或 `实习生评价`
- 教师端：`学生评价` 或 `实习评价`
- 学生端：`自我评价` 和 `综合成绩`
- 管理员端：`评价管理` 或 `实习评价管理`

---

**文档版本：** v3.0  
**最后更新：** 2024-11-25  
**更新内容：** 
- 只保留方案一（保留分离方案）的设计
- 补充企业评价的参考数据（阶段性成果、考勤记录）
- 添加考勤查看权限说明（班主任、学院负责人、学校管理员可以查看考勤，但考勤确认仍由企业负责）
- 更新考勤权限控制代码（Controller和Service层）

