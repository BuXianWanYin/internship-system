# 筛选功能优化方案

## 一、需求分析

### 1.1 当前状态
- **学院管理**：只有"学院名称"搜索，表格显示"所属学校ID"
- **专业管理**：只有"专业名称"搜索，表格显示"所属学院ID"
- **班级管理**：只有"班级名称"搜索，表格显示"所属专业ID"

### 1.2 优化需求
- **学院管理**：添加"所属学校"列（显示学校名称），添加"学校"筛选
- **专业管理**：添加"所属学院"列（显示学院名称），添加"学校"和"学院"筛选（级联）
- **班级管理**：添加"所属专业"列（显示专业名称），添加"学校"、"学院"、"专业"筛选（级联）

---

## 二、方案设计

### 2.1 学院管理页面优化

#### 2.1.1 表格列优化
**当前**：
- `所属学校ID`（显示ID数字）

**优化后**：
- `所属学校`（显示学校名称）
- 保留`所属学校ID`（可选，用于调试）

#### 2.1.2 筛选条件优化
**当前**：
- 学院名称（文本输入）

**优化后**：
- 学院名称（文本输入）
- 所属学校（下拉选择器，可选）

#### 2.1.3 数据加载
- 页面加载时，获取学校列表（用于下拉选择器）
- 查询学院列表时，同时加载学校信息（用于显示学校名称）
- 支持按学校ID筛选

---

### 2.2 专业管理页面优化

#### 2.2.1 表格列优化
**当前**：
- `所属学院ID`（显示ID数字）

**优化后**：
- `所属学院`（显示学院名称）
- `所属学校`（显示学校名称，通过学院关联）
- 保留`所属学院ID`（可选，用于调试）

#### 2.2.2 筛选条件优化
**当前**：
- 专业名称（文本输入）

**优化后**：
- 专业名称（文本输入）
- 所属学校（下拉选择器，可选）
- 所属学院（下拉选择器，可选，级联：选择学校后，学院列表自动过滤）

#### 2.2.3 级联逻辑
1. 选择学校 → 自动加载该学校下的学院列表
2. 选择学院 → 专业列表按学院筛选
3. 清空学校 → 清空学院选择，加载所有学院
4. 清空学院 → 专业列表按学校筛选（如果有选择学校）

#### 2.2.4 数据加载
- 页面加载时，获取学校列表
- 选择学校后，动态加载该学校的学院列表
- 查询专业列表时，同时加载学院和学校信息（用于显示名称）

---

### 2.3 班级管理页面优化

#### 2.3.1 表格列优化
**当前**：
- `所属专业ID`（显示ID数字）

**优化后**：
- `所属专业`（显示专业名称）
- `所属学院`（显示学院名称，通过专业关联）
- `所属学校`（显示学校名称，通过专业→学院关联）
- 保留`所属专业ID`（可选，用于调试）

#### 2.3.2 筛选条件优化
**当前**：
- 班级名称（文本输入）

**优化后**：
- 班级名称（文本输入）
- 所属学校（下拉选择器，可选）
- 所属学院（下拉选择器，可选，级联：选择学校后，学院列表自动过滤）
- 所属专业（下拉选择器，可选，级联：选择学院后，专业列表自动过滤）

#### 2.3.3 级联逻辑
1. 选择学校 → 自动加载该学校下的学院列表，清空学院和专业选择
2. 选择学院 → 自动加载该学院下的专业列表，清空专业选择
3. 选择专业 → 班级列表按专业筛选
4. 清空学校 → 清空学院和专业选择，加载所有学院
5. 清空学院 → 清空专业选择，加载该学校下的所有专业（如果有选择学校）
6. 清空专业 → 班级列表按学院筛选（如果有选择学院）

#### 2.3.4 数据加载
- 页面加载时，获取学校列表
- 选择学校后，动态加载该学校的学院列表
- 选择学院后，动态加载该学院的专业列表
- 查询班级列表时，同时加载专业、学院和学校信息（用于显示名称）

---

## 三、技术实现方案

### 3.1 后端接口支持

#### 3.1.1 学院管理接口
**当前支持**：
- `GET /system/college/page?schoolId=xxx` ✅（已支持）

**无需修改**，后端已支持`schoolId`参数。

#### 3.1.2 专业管理接口
**当前支持**：
- `GET /system/major/page?collegeId=xxx` ✅（已支持）

**需要添加**：
- `GET /system/major/page?schoolId=xxx&collegeId=xxx`（支持按学校筛选）

**实现方式**：
- 在`MajorController.getMajorPage()`中添加`schoolId`参数
- 在`MajorServiceImpl.getMajorPage()`中添加`schoolId`过滤逻辑

#### 3.1.3 班级管理接口
**当前支持**：
- `GET /system/class/page?majorId=xxx` ✅（已支持）

**需要添加**：
- `GET /system/class/page?schoolId=xxx&collegeId=xxx&majorId=xxx`（支持按学校和学院筛选）

**实现方式**：
- 在`ClassController.getClassPage()`中添加`schoolId`和`collegeId`参数
- 在`ClassServiceImpl.getClassPage()`中添加`schoolId`和`collegeId`过滤逻辑

#### 3.1.4 数据关联查询优化
**方案A：前端关联查询**（推荐）
- 查询列表后，根据ID批量查询关联数据（学校、学院、专业）
- 优点：后端简单，前端灵活
- 缺点：需要多次请求

**方案B：后端关联查询**
- 后端返回数据时，自动关联查询并返回名称
- 优点：一次请求，数据完整
- 缺点：需要修改后端返回结构

**推荐方案A**，因为：
1. 后端接口已支持，无需大改
2. 前端可以缓存关联数据，减少请求
3. 灵活性更高

---

### 3.2 前端实现方案

#### 3.2.1 数据加载策略

**学院管理页面**：
```javascript
// 1. 加载学校列表（用于下拉选择器）
const schoolList = ref([])
const loadSchoolList = async () => {
  const res = await schoolApi.getSchoolPage({ current: 1, size: 1000 })
  schoolList.value = res.data.records || []
}

// 2. 加载学院列表（带学校信息）
const loadCollegeList = async () => {
  // 查询学院
  const res = await collegeApi.getCollegePage({...})
  tableData.value = res.data.records || []
  
  // 批量查询学校信息
  const schoolIds = [...new Set(tableData.value.map(item => item.schoolId))]
  await loadSchoolInfo(schoolIds)
}

// 3. 学校信息映射
const schoolMap = ref({})
const loadSchoolInfo = async (schoolIds) => {
  for (const schoolId of schoolIds) {
    if (!schoolMap.value[schoolId]) {
      const res = await schoolApi.getSchoolById(schoolId)
      if (res.code === 200) {
        schoolMap.value[schoolId] = res.data
      }
    }
  }
}
```

**专业管理页面**：
```javascript
// 1. 加载学校列表
const schoolList = ref([])
const loadSchoolList = async () => { ... }

// 2. 加载学院列表（根据选择的学校）
const collegeList = ref([])
const loadCollegeList = async (schoolId) => {
  if (schoolId) {
    const res = await collegeApi.getCollegePage({ 
      current: 1, 
      size: 1000, 
      schoolId 
    })
    collegeList.value = res.data.records || []
  } else {
    const res = await collegeApi.getCollegePage({ current: 1, size: 1000 })
    collegeList.value = res.data.records || []
  }
}

// 3. 监听学校选择变化
watch(() => searchForm.schoolId, (newVal) => {
  searchForm.collegeId = null // 清空学院选择
  loadCollegeList(newVal)
})

// 4. 加载专业列表（带学院和学校信息）
const loadMajorList = async () => {
  const res = await majorApi.getMajorPage({
    schoolId: searchForm.schoolId,
    collegeId: searchForm.collegeId,
    ...
  })
  tableData.value = res.data.records || []
  
  // 批量查询学院和学校信息
  const collegeIds = [...new Set(tableData.value.map(item => item.collegeId))]
  await loadCollegeInfo(collegeIds)
}
```

**班级管理页面**：
```javascript
// 类似专业管理，但需要三级级联：学校 → 学院 → 专业
// 1. 加载学校列表
// 2. 选择学校 → 加载学院列表
// 3. 选择学院 → 加载专业列表
// 4. 选择专业 → 加载班级列表
```

#### 3.2.2 表格列显示优化

**学院管理**：
```vue
<el-table-column label="所属学校" min-width="150">
  <template #default="{ row }">
    <span v-if="schoolMap[row.schoolId]">
      {{ schoolMap[row.schoolId].schoolName }}
    </span>
    <span v-else style="color: #909399">加载中...</span>
  </template>
</el-table-column>
```

**专业管理**：
```vue
<el-table-column label="所属学院" min-width="150">
  <template #default="{ row }">
    <span v-if="collegeMap[row.collegeId]">
      {{ collegeMap[row.collegeId].collegeName }}
    </span>
    <span v-else style="color: #909399">加载中...</span>
  </template>
</el-table-column>
<el-table-column label="所属学校" min-width="150">
  <template #default="{ row }">
    <span v-if="collegeMap[row.collegeId] && schoolMap[collegeMap[row.collegeId].schoolId]">
      {{ schoolMap[collegeMap[row.collegeId].schoolId].schoolName }}
    </span>
    <span v-else style="color: #909399">加载中...</span>
  </template>
</el-table-column>
```

**班级管理**：
```vue
<el-table-column label="所属专业" min-width="150">
  <template #default="{ row }">
    <span v-if="majorMap[row.majorId]">
      {{ majorMap[row.majorId].majorName }}
    </span>
    <span v-else style="color: #909399">加载中...</span>
  </template>
</el-table-column>
<el-table-column label="所属学院" min-width="150">
  <template #default="{ row }">
    <span v-if="majorMap[row.majorId] && collegeMap[majorMap[row.majorId].collegeId]">
      {{ collegeMap[majorMap[row.majorId].collegeId].collegeName }}
    </span>
    <span v-else style="color: #909399">加载中...</span>
  </template>
</el-table-column>
<el-table-column label="所属学校" min-width="150">
  <template #default="{ row }">
    <span v-if="majorMap[row.majorId] && 
                collegeMap[majorMap[row.majorId].collegeId] && 
                schoolMap[collegeMap[majorMap[row.majorId].collegeId].schoolId]">
      {{ schoolMap[collegeMap[majorMap[row.majorId].collegeId].schoolId].schoolName }}
    </span>
    <span v-else style="color: #909399">加载中...</span>
  </template>
</el-table-column>
```

#### 3.2.3 筛选表单优化

**学院管理**：
```vue
<el-form-item label="所属学校">
  <el-select
    v-model="searchForm.schoolId"
    placeholder="请选择学校"
    clearable
    style="width: 200px"
  >
    <el-option
      v-for="school in schoolList"
      :key="school.schoolId"
      :label="school.schoolName"
      :value="school.schoolId"
    />
  </el-select>
</el-form-item>
```

**专业管理**：
```vue
<el-form-item label="所属学校">
  <el-select
    v-model="searchForm.schoolId"
    placeholder="请选择学校"
    clearable
    style="width: 200px"
    @change="handleSchoolChange"
  >
    <el-option
      v-for="school in schoolList"
      :key="school.schoolId"
      :label="school.schoolName"
      :value="school.schoolId"
    />
  </el-select>
</el-form-item>
<el-form-item label="所属学院">
  <el-select
    v-model="searchForm.collegeId"
    placeholder="请选择学院"
    clearable
    style="width: 200px"
    :disabled="!searchForm.schoolId"
  >
    <el-option
      v-for="college in collegeList"
      :key="college.collegeId"
      :label="college.collegeName"
      :value="college.collegeId"
    />
  </el-select>
</el-form-item>
```

**班级管理**：
```vue
<el-form-item label="所属学校">
  <el-select
    v-model="searchForm.schoolId"
    placeholder="请选择学校"
    clearable
    style="width: 200px"
    @change="handleSchoolChange"
  >
    <el-option
      v-for="school in schoolList"
      :key="school.schoolId"
      :label="school.schoolName"
      :value="school.schoolId"
    />
  </el-select>
</el-form-item>
<el-form-item label="所属学院">
  <el-select
    v-model="searchForm.collegeId"
    placeholder="请选择学院"
    clearable
    style="width: 200px"
    :disabled="!searchForm.schoolId"
    @change="handleCollegeChange"
  >
    <el-option
      v-for="college in collegeList"
      :key="college.collegeId"
      :label="college.collegeName"
      :value="college.collegeId"
    />
  </el-select>
</el-form-item>
<el-form-item label="所属专业">
  <el-select
    v-model="searchForm.majorId"
    placeholder="请选择专业"
    clearable
    style="width: 200px"
    :disabled="!searchForm.collegeId"
  >
    <el-option
      v-for="major in majorList"
      :key="major.majorId"
      :label="major.majorName"
      :value="major.majorId"
    />
  </el-select>
</el-form-item>
```

---

## 四、实现步骤

### 4.1 后端修改（如需要）

#### 步骤1：专业管理接口添加schoolId参数
- 修改`MajorController.getMajorPage()`，添加`schoolId`参数
- 修改`MajorServiceImpl.getMajorPage()`，添加`schoolId`过滤逻辑

#### 步骤2：班级管理接口添加schoolId和collegeId参数
- 修改`ClassController.getClassPage()`，添加`schoolId`和`collegeId`参数
- 修改`ClassServiceImpl.getClassPage()`，添加`schoolId`和`collegeId`过滤逻辑

### 4.2 前端修改

#### 步骤1：学院管理页面
1. 添加学校下拉选择器
2. 添加学校信息映射和加载逻辑
3. 修改表格列，显示学校名称
4. 更新查询参数，支持按学校筛选

#### 步骤2：专业管理页面
1. 添加学校和学院下拉选择器（级联）
2. 添加学院和学校信息映射和加载逻辑
3. 修改表格列，显示学院和学校名称
4. 更新查询参数，支持按学校和学院筛选
5. 实现级联逻辑（选择学校后，自动加载学院列表）

#### 步骤3：班级管理页面
1. 添加学校、学院、专业下拉选择器（三级级联）
2. 添加专业、学院、学校信息映射和加载逻辑
3. 修改表格列，显示专业、学院、学校名称
4. 更新查询参数，支持按学校、学院、专业筛选
5. 实现级联逻辑（学校→学院→专业）

---

## 五、方案对比

### 5.1 方案A：前端关联查询（推荐）

**优点**：
- ✅ 后端改动小（只需添加筛选参数）
- ✅ 前端灵活，可以缓存关联数据
- ✅ 实现简单，易于维护

**缺点**：
- ⚠️ 需要多次请求（但可以批量查询，影响不大）

### 5.2 方案B：后端关联查询

**优点**：
- ✅ 一次请求，数据完整
- ✅ 前端简单

**缺点**：
- ❌ 需要修改后端返回结构（DTO）
- ❌ 后端逻辑复杂
- ❌ 灵活性较低

**推荐方案A**，因为实现简单，且性能影响不大（可以批量查询）。

---

## 六、注意事项

### 6.1 性能优化
1. **批量查询关联数据**：不要逐条查询，而是收集所有ID后批量查询
2. **数据缓存**：查询到的学校、学院、专业信息可以缓存，避免重复查询
3. **懒加载**：只在需要显示时才加载关联数据

### 6.2 用户体验
1. **级联选择器禁用状态**：上级未选择时，下级选择器应禁用
2. **清空逻辑**：清空上级选择时，自动清空下级选择
3. **加载提示**：关联数据加载时，显示"加载中..."提示
4. **默认值**：根据用户权限，可以设置默认的学校/学院/专业

### 6.3 数据权限
- 系统管理员：可以看到所有学校、学院、专业
- 学校管理员：只能看到本校的学院和专业
- 学院负责人：只能看到本院的专业
- 班主任：只能看到本班的专业

**实现方式**：
- 下拉选择器的数据列表，应该根据用户权限自动过滤
- 后端接口已实现数据权限过滤，前端直接调用即可

---

## 七、其他管理页面筛选优化

### 7.1 学期管理页面优化

#### 7.1.1 当前状态
- **筛选条件**：只有"学期名称"（文本输入）

#### 7.1.2 优化方案
**添加筛选条件**：
- ✅ 学期名称（保留，文本输入）
- ✅ **年份筛选**（下拉选择器，可选）
- ✅ **当前学期筛选**（下拉选择器：全部/是/否）
- ✅ **日期范围筛选**（日期选择器：开始日期-结束日期）

**表格列优化**：
- 当前列已足够，无需修改

**后端接口**：
- 需要添加：`year`（年份）、`isCurrent`（是否当前学期）、`startDate`、`endDate`参数

---

### 7.2 用户管理页面优化

#### 7.2.1 当前状态
- **筛选条件**：用户名、真实姓名、手机号（文本输入）

#### 7.2.2 优化方案
**添加筛选条件**：
- ✅ 用户名（保留，文本输入）
- ✅ 真实姓名（保留，文本输入）
- ✅ 手机号（保留，文本输入）
- ✅ **状态筛选**（下拉选择器：全部/启用/禁用）
- ✅ **角色筛选**（下拉选择器，多选，可选）
- ✅ **学校筛选**（下拉选择器，可选）
- ✅ **学院筛选**（下拉选择器，可选，级联：选择学校后过滤）
- ✅ **班级筛选**（下拉选择器，可选，级联：选择学院后过滤）

**表格列优化**：
- 添加"所属角色"列（显示角色名称，多个角色用逗号分隔）
- 添加"所属组织"列（显示学校/学院/班级，根据用户类型）

**后端接口**：
- 需要添加：`status`、`roleCodes`（角色代码数组）、`schoolId`、`collegeId`、`classId`参数

**实现说明**：
- 用户可能属于多个角色，需要支持多选
- 用户可能属于学生、教师、企业等不同类型，筛选时需要根据类型过滤
- 建议：先选择角色，再根据角色类型显示对应的组织筛选（学生→班级，教师→学院，企业→不显示组织筛选）

---

### 7.3 学生管理页面优化

#### 7.3.1 当前状态
- **筛选条件**：学号、班级（下拉选择器）

#### 7.3.2 优化方案
**添加筛选条件**：
- ✅ 学号（保留，文本输入）
- ✅ **学校筛选**（下拉选择器，可选）
- ✅ **学院筛选**（下拉选择器，可选，级联：选择学校后过滤）
- ✅ **专业筛选**（下拉选择器，可选，级联：选择学院后过滤）
- ✅ **班级筛选**（下拉选择器，可选，级联：选择专业后过滤）
- ✅ **状态筛选**（下拉选择器：全部/已审核/待审核）
- ✅ **入学年份筛选**（下拉选择器，可选）

**表格列优化**：
- 添加"所属专业"列（显示专业名称）
- 添加"所属学院"列（显示学院名称）
- 添加"所属学校"列（显示学校名称）

**后端接口**：
- ✅ 已支持：`studentNo`、`classId`、`majorId`、`collegeId`、`schoolId`
- 需要添加：`status`（状态筛选）、`enrollmentYear`（入学年份）

**级联逻辑**：
1. 选择学校 → 自动加载该学校下的学院列表，清空学院、专业、班级选择
2. 选择学院 → 自动加载该学院下的专业列表，清空专业、班级选择
3. 选择专业 → 自动加载该专业下的班级列表，清空班级选择
4. 选择班级 → 学生列表按班级筛选

---

### 7.4 教师管理页面优化

#### 7.4.1 当前状态
- **筛选条件**：工号、学院（下拉选择器）
- **表格列**：已显示"所属学院"和"所属学校"（名称）

#### 7.4.2 优化方案
**添加筛选条件**：
- ✅ 工号（保留，文本输入）
- ✅ **学校筛选**（下拉选择器，可选）
- ✅ 学院筛选（保留，下拉选择器，级联：选择学校后过滤）
- ✅ **状态筛选**（下拉选择器：全部/启用/禁用）

**表格列优化**：
- 当前列已足够，无需修改

**后端接口**：
- ✅ 已支持：`teacherNo`、`collegeId`、`schoolId`
- 需要添加：`status`（状态筛选）

**级联逻辑**：
1. 选择学校 → 自动加载该学校下的学院列表，清空学院选择
2. 选择学院 → 教师列表按学院筛选
3. 清空学校 → 清空学院选择，加载所有学院

---

## 八、筛选功能汇总表

### 8.1 各页面筛选条件汇总

| 页面 | 当前筛选 | 新增筛选 | 级联关系 |
|-----|---------|---------|---------|
| **学院管理** | 学院名称 | 所属学校 | - |
| **专业管理** | 专业名称 | 所属学校、所属学院 | 学校→学院 |
| **班级管理** | 班级名称 | 所属学校、所属学院、所属专业 | 学校→学院→专业 |
| **学期管理** | 学期名称 | 年份、当前学期、日期范围 | - |
| **用户管理** | 用户名、真实姓名、手机号 | 状态、角色、学校、学院、班级 | 学校→学院→班级 |
| **学生管理** | 学号、班级 | 学校、学院、专业、状态、入学年份 | 学校→学院→专业→班级 |
| **教师管理** | 工号、学院 | 学校、状态 | 学校→学院 |

### 8.2 后端接口参数需求汇总

| 接口 | 需要添加的参数 |
|-----|--------------|
| `GET /system/college/page` | ✅ 已支持 `schoolId` |
| `GET /system/major/page` | `schoolId` |
| `GET /system/class/page` | `schoolId`、`collegeId` |
| `GET /system/semester/page` | `year`、`isCurrent`、`startDate`、`endDate` |
| `GET /user/page` | `status`、`roleCodes[]`、`schoolId`、`collegeId`、`classId` |
| `GET /user/student/page` | `status`、`enrollmentYear`（✅ 已支持其他） |
| `GET /user/teacher/page` | `status`（✅ 已支持其他） |

---

## 九、实现优先级建议

### 9.1 第一阶段（核心筛选）
1. ✅ **学院管理**：添加学校筛选
2. ✅ **专业管理**：添加学校、学院筛选（级联）
3. ✅ **班级管理**：添加学校、学院、专业筛选（三级级联）
4. ✅ **学生管理**：添加学校、学院、专业筛选（三级级联），状态筛选
5. ✅ **教师管理**：添加学校筛选（级联），状态筛选

### 9.2 第二阶段（增强筛选）
6. **学期管理**：添加年份、当前学期、日期范围筛选
7. **用户管理**：添加状态、角色、组织筛选

---

## 十、总结

### 10.1 核心改动
1. **表格列**：显示名称而不是ID（学院、专业、班级、学生、教师管理）
2. **筛选条件**：添加级联下拉选择器（学校→学院→专业→班级）
3. **数据加载**：批量查询关联数据，使用Map缓存
4. **级联逻辑**：实现多级级联（最多四级：学校→学院→专业→班级）
5. **状态筛选**：添加状态筛选（用户、学生、教师管理）
6. **日期筛选**：添加日期范围筛选（学期管理）

### 10.2 预期效果
- ✅ 用户可以直观看到所属关系（名称而不是ID）
- ✅ 用户可以快速筛选数据（通过下拉选择器和级联选择）
- ✅ 级联选择器提供良好的用户体验
- ✅ 数据加载高效（批量查询和缓存）
- ✅ 筛选功能完善，满足管理员快速查找需求

---

**请确认方案后，我将开始实现。**

