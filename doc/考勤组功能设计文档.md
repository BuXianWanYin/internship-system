# 考勤组功能设计文档

## 一、功能概述

### 1.1 功能目标
实现企业导师为学生设置考勤规则（考勤组），系统根据考勤组规则自动计算缺勤天数，提高考勤管理的准确性和灵活性。

### 1.2 核心功能
- 企业导师可以创建和管理考勤组
- 考勤组支持配置工作日（周一到周五/周六/周日等直观选项）、多个时间段（早班、晚班等）
- 学生可以分配到考勤组
- 学生打卡时可以选择考勤组中的时间段
- 学生可以申请休息或请假（不受时间段限制）
- 系统根据考勤组规则自动计算应出勤日期和缺勤天数
- 考勤统计基于考勤组规则进行准确计算

### 1.3 设计方案说明

#### 方案对比

**方案A：简化版（单一时间段）**
- 工作日配置：周一到周五/周六/周日等预设选项
- 上班时间：统一配置（如9:00-18:00）
- 学生打卡：使用统一的上班时间
- **优点**：简单易用，适合大多数企业
- **缺点**：不支持轮班制，灵活性较低

**方案B：灵活版（多时间段，推荐）** ⭐
- 工作日配置：周一到周五/周六/周日等预设选项
- 上班时间：可配置多个时间段（如早班8:00-17:00、晚班14:00-23:00）
- 学生打卡：可以选择使用哪个时间段
- **优点**：
  - 支持轮班制、弹性工作制
  - 适应不同企业的工作安排
  - 学生可以根据实际情况选择时间段
  - 更贴近实际考勤管理需求
- **缺点**：配置稍复杂，但通过良好的UI设计可以解决

**本设计文档采用方案B（灵活版）**，原因：
1. 更贴近实际：不同企业工作制度不同，有些需要轮班
2. 更准确：避免将不同班次混在一起统计
3. 更灵活：支持个性化实习安排
4. 更专业：符合企业考勤管理习惯

## 二、数据库设计

### 2.1 考勤组表 (attendance_group)

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| group_id | BIGINT | 考勤组ID | 主键，自增 |
| enterprise_id | BIGINT | 所属企业ID | 非空，外键 |
| mentor_id | BIGINT | 创建人（企业导师ID） | 非空，外键 |
| group_name | VARCHAR(100) | 考勤组名称 | 非空 |
| group_description | VARCHAR(500) | 考勤组描述 | 可为空 |
| work_days_type | INT | 工作日类型：1-周一到周五，2-周一到周六，3-周一到周日，4-自定义 | 非空，默认1 |
| work_days_config | VARCHAR(50) | 工作日配置（自定义时使用，JSON格式） | 可为空 |
| default_work_hours | DECIMAL(4,2) | 默认工作时长（小时） | 非空，默认8.0 |
| status | INT | 状态：1-启用，0-禁用 | 非空，默认1 |
| delete_flag | INT | 删除标志：0-未删除，1-已删除 | 非空，默认0 |
| create_time | DATETIME | 创建时间 | 非空 |
| update_time | DATETIME | 更新时间 | 非空 |
| create_user_id | BIGINT | 创建人ID | 非空 |
| update_user_id | BIGINT | 更新人ID | 可为空 |

**字段说明：**
- `work_days_type`: 
  - 1-周一到周五（标准5天工作制）
  - 2-周一到周六（6天工作制）
  - 3-周一到周日（7天工作制）
  - 4-自定义（使用work_days_config）
- `work_days_config`: 仅当work_days_type=4时使用，JSON格式，例如：`{"monday": true, "tuesday": true, "wednesday": false, ...}`

**前端实现说明：**
- 前端界面使用可视化的复选框选择（周一至周日）
- 用户选择后，前端将选择结果转换为JSON格式
- 转换逻辑：
  ```javascript
  // 前端数据结构
  const workDays = {
    monday: true,
    tuesday: true,
    wednesday: true,
    thursday: true,
    friday: true,
    saturday: false,
    sunday: false
  }
  
  // 提交时转换为JSON字符串
  const workDaysConfig = JSON.stringify(workDays)
  
  // 后端接收后直接存储为JSON字符串
  // 查询时，后端返回JSON字符串，前端解析后显示为复选框状态
  ```
- 这样设计的好处：
  - 前端用户体验好（可视化选择）
  - 后端存储规范（JSON格式）
  - 数据格式统一，便于扩展

**索引：**
- PRIMARY KEY (group_id)
- INDEX idx_enterprise_id (enterprise_id)
- INDEX idx_mentor_id (mentor_id)
- INDEX idx_delete_flag (delete_flag)

### 2.2 考勤组时间段表 (attendance_group_time_slot)

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| slot_id | BIGINT | 时间段ID | 主键，自增 |
| group_id | BIGINT | 考勤组ID | 非空，外键 |
| slot_name | VARCHAR(50) | 时间段名称（如：早班、晚班、标准班） | 非空 |
| start_time | TIME | 上班时间 | 非空 |
| end_time | TIME | 下班时间 | 非空 |
| work_hours | DECIMAL(4,2) | 工作时长（小时） | 非空 |
| is_default | INT | 是否默认：1-是，0-否 | 非空，默认0 |
| sort_order | INT | 排序顺序 | 非空，默认0 |
| delete_flag | INT | 删除标志：0-未删除，1-已删除 | 非空，默认0 |
| create_time | DATETIME | 创建时间 | 非空 |
| update_time | DATETIME | 更新时间 | 非空 |

**字段说明：**
- 一个考勤组可以有多个时间段（如早班、晚班、标准班等）
- 学生打卡时可以选择使用哪个时间段
- `is_default`: 默认时间段，学生打卡时默认使用该时间段
- `work_hours`: 自动计算或手动设置，用于统计工作时长

**索引：**
- PRIMARY KEY (slot_id)
- INDEX idx_group_id (group_id)
- INDEX idx_delete_flag (delete_flag)

### 2.3 考勤组规则表 (attendance_group_rule)

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| rule_id | BIGINT | 规则ID | 主键，自增 |
| group_id | BIGINT | 考勤组ID | 非空，外键 |
| rule_type | INT | 规则类型：1-工作日，2-节假日，3-特殊日期 | 非空 |
| rule_date | DATE | 规则日期 | 可为空（工作日规则可为空） |
| rule_start_date | DATE | 规则开始日期 | 可为空 |
| rule_end_date | DATE | 规则结束日期 | 可为空 |
| rule_value | VARCHAR(200) | 规则值（JSON格式） | 可为空 |
| description | VARCHAR(500) | 规则描述 | 可为空 |
| delete_flag | INT | 删除标志：0-未删除，1-已删除 | 非空，默认0 |
| create_time | DATETIME | 创建时间 | 非空 |
| update_time | DATETIME | 更新时间 | 非空 |

**字段说明：**
- `rule_type`: 
  - 1-工作日：覆盖默认工作日配置（如某周的特殊工作日安排）
  - 2-节假日：排除的日期（如法定节假日、企业放假）
  - 3-特殊日期：特殊安排的日期（如调休、企业活动日等）
- `rule_date`: 单个日期（用于节假日、特殊日期）
- `rule_start_date` + `rule_end_date`: 日期范围（用于工作日规则、连续节假日）
- `rule_value`: JSON格式，存储规则详细信息，例如：
  - 工作日规则：`{"is_workday": true, "work_hours": 8.0}`
  - 节假日规则：`{"holiday_name": "春节", "is_paid": false}`
  - 特殊日期：`{"is_workday": false, "reason": "企业年会"}`

**索引：**
- PRIMARY KEY (rule_id)
- INDEX idx_group_id (group_id)
- INDEX idx_rule_type (rule_type)
- INDEX idx_rule_date (rule_date)
- INDEX idx_delete_flag (delete_flag)

### 2.4 考勤组学生关联表 (attendance_group_student)

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| id | BIGINT | 关联ID | 主键，自增 |
| group_id | BIGINT | 考勤组ID | 非空，外键 |
| apply_id | BIGINT | 实习申请ID | 非空，外键，唯一 |
| student_id | BIGINT | 学生ID | 非空，外键 |
| effective_start_date | DATE | 生效开始日期 | 非空 |
| effective_end_date | DATE | 生效结束日期 | 可为空 |
| status | INT | 状态：1-生效，0-失效 | 非空，默认1 |
| delete_flag | INT | 删除标志：0-未删除，1-已删除 | 非空，默认0 |
| create_time | DATETIME | 创建时间 | 非空 |
| update_time | DATETIME | 更新时间 | 非空 |
| create_user_id | BIGINT | 创建人ID | 非空 |

**字段说明：**
- `apply_id`: 关联实习申请，一个申请只能属于一个考勤组
- `effective_start_date`: 考勤组对该学生生效的开始日期（通常等于实习开始日期）
- `effective_end_date`: 考勤组对该学生生效的结束日期（通常等于实习结束日期，可为空表示持续有效）

**索引：**
- PRIMARY KEY (id)
- UNIQUE KEY uk_apply_id (apply_id)
- INDEX idx_group_id (group_id)
- INDEX idx_student_id (student_id)
- INDEX idx_delete_flag (delete_flag)

### 2.5 考勤表修改 (attendance)

在现有 `attendance` 表中添加字段：

| 字段名 | 类型 | 说明 | 约束 |
|--------|------|------|------|
| group_id | BIGINT | 考勤组ID | 可为空，外键 |
| time_slot_id | BIGINT | 时间段ID | 可为空，外键 |

**说明：**
- `group_id`: 用于关联考勤记录所属的考勤组
- `time_slot_id`: 用于记录学生打卡时选择的时间段
- 可为空，兼容历史数据
- 新增考勤记录时，自动关联学生所属的考勤组和选择的时间段

## 三、功能模块设计

### 3.1 权限分工

#### 3.1.1 企业管理员（ROLE_ENTERPRISE_ADMIN）
- **职责**：创建和管理考勤组
- **功能**：
  - 创建考勤组
  - 编辑考勤组
  - 删除考勤组
  - 配置考勤组规则（节假日、特殊日期）
  - 查看考勤组列表
  - 查看考勤组详情

#### 3.1.2 企业导师（ROLE_ENTERPRISE_MENTOR）
- **职责**：将学生分配到考勤组
- **功能**：
  - 查看考勤组列表（只读）
  - 将学生分配到考勤组
  - 批量分配学生到考勤组
  - 解除学生考勤组关联
  - 查看学生所属考勤组

### 3.2 考勤组管理模块（企业管理员）

#### 3.2.1 功能位置
独立的前端页面，放在"企业管理"菜单下

#### 3.2.2 菜单配置
**菜单路径：** 企业管理 > 考勤组管理
**页面路径：** `/enterprise/admin/attendance-group`
**权限：** `ROLE_ENTERPRISE_ADMIN`

#### 3.2.3 考勤组列表页面
**功能：**
1. 显示当前企业的所有考勤组
2. 支持创建、编辑、删除考勤组
3. 显示每个考勤组的学生数量、时间段数量
4. 支持启用/禁用考勤组
5. 支持配置考勤组规则（节假日、特殊日期）

**列表字段：**
- 考勤组名称
- 工作日类型（如：周一到周五）
- 时间段数量
- 学生数量
- 状态
- 创建人
- 创建时间
- 操作（编辑、删除、查看学生、配置规则）

#### 3.2.4 创建/编辑考勤组
**表单字段：**
- 考勤组名称*（必填）
- 考勤组描述（可选）
- 工作日配置*（必填）
  - 单选：○ 周一到周五  ○ 周一到周六  ○ 周一到周日  ○ 自定义
  - 如果选择"自定义"，显示周一至周日复选框
  - **前端实现**：复选框选择后，转换为JSON格式提交
- 时间段配置*（必填，至少一个）
  - 时间段列表（可添加多个）
  - 每个时间段包含：
    - 时间段名称*（如：标准班、早班、晚班）
    - 上班时间*（时:分，如：09:00）
    - 下班时间*（时:分，如：18:00）
    - 工作时长（自动计算，可手动调整）
    - 是否默认（单选，只能有一个默认）
  - 支持添加、删除、编辑时间段
- 状态（启用/禁用）

**工作日配置前端实现示例：**
```vue
<template>
  <el-radio-group v-model="form.workDaysType" @change="handleWorkDaysTypeChange">
    <el-radio :label="1">周一到周五（标准5天工作制）</el-radio>
    <el-radio :label="2">周一到周六（6天工作制）</el-radio>
    <el-radio :label="3">周一到周日（7天工作制）</el-radio>
    <el-radio :label="4">自定义</el-radio>
  </el-radio-group>
  
  <div v-if="form.workDaysType === 4" class="custom-work-days">
    <el-checkbox v-model="customDays.monday">周一</el-checkbox>
    <el-checkbox v-model="customDays.tuesday">周二</el-checkbox>
    <el-checkbox v-model="customDays.wednesday">周三</el-checkbox>
    <el-checkbox v-model="customDays.thursday">周四</el-checkbox>
    <el-checkbox v-model="customDays.friday">周五</el-checkbox>
    <el-checkbox v-model="customDays.saturday">周六</el-checkbox>
    <el-checkbox v-model="customDays.sunday">周日</el-checkbox>
  </div>
</template>

<script>
// 提交时转换
const submitForm = () => {
  const formData = {
    ...form.value,
    workDaysConfig: form.value.workDaysType === 4 
      ? JSON.stringify(customDays.value) 
      : null
  }
  // 提交到后端
}
</script>
```

**工作日配置示例：**
```
工作日类型：
○ 周一到周五（标准5天工作制）
○ 周一到周六（6天工作制）
○ 周一到周日（7天工作制）
◉ 自定义
  ☑ 周一  ☑ 周二  ☑ 周三  ☑ 周四  ☑ 周五  ☐ 周六  ☐ 周日
```

**时间段配置示例：**
```
时间段列表：
┌─────────────────────────────────────┐
│ 时间段名称 | 上班时间 | 下班时间 | 工作时长 | 默认 | 操作 │
├─────────────────────────────────────┤
│ 标准班    | 09:00   | 18:00   | 8.0小时 | ◉   | 编辑 删除│
│ 早班      | 08:00   | 17:00   | 8.0小时 | ○   | 编辑 删除│
│ 晚班      | 14:00   | 23:00   | 8.0小时 | ○   | 编辑 删除│
└─────────────────────────────────────┘
[+ 添加时间段]
```

#### 3.2.5 考勤组规则配置
**功能：**
1. 添加节假日
   - 单个日期选择
   - 日期范围选择（连续节假日）
   - 节假日名称
   - 是否带薪（可选）
2. 添加特殊日期
   - 日期选择
   - 是否工作日
   - 特殊原因说明
3. 查看规则列表
   - 按类型分组显示
   - 支持删除规则

**规则列表显示：**
```
节假日：
- 2025-01-01 元旦
- 2025-01-28 ~ 2025-02-03 春节

特殊日期：
- 2025-03-15 企业年会（非工作日）
- 2025-04-05 调休（工作日）
```

#### 3.1.4 创建/编辑考勤组
**表单字段：**
- 考勤组名称*（必填）
- 考勤组描述（可选）
- 工作日配置*（必填）
  - 单选：○ 周一到周五  ○ 周一到周六  ○ 周一到周日  ○ 自定义
  - 如果选择"自定义"，显示周一至周日复选框
- 时间段配置*（必填，至少一个）
  - 时间段列表（可添加多个）
  - 每个时间段包含：
    - 时间段名称*（如：标准班、早班、晚班）
    - 上班时间*（时:分，如：09:00）
    - 下班时间*（时:分，如：18:00）
    - 工作时长（自动计算，可手动调整）
    - 是否默认（单选，只能有一个默认）
  - 支持添加、删除、编辑时间段
- 状态（启用/禁用）

**工作日配置示例：**
```
工作日类型：
○ 周一到周五（标准5天工作制）
○ 周一到周六（6天工作制）
○ 周一到周日（7天工作制）
◉ 自定义
  ☑ 周一  ☑ 周二  ☑ 周三  ☑ 周四  ☑ 周五  ☐ 周六  ☐ 周日
```

**时间段配置示例：**
```
时间段列表：
┌─────────────────────────────────────┐
│ 时间段名称 | 上班时间 | 下班时间 | 工作时长 | 默认 | 操作 │
├─────────────────────────────────────┤
│ 标准班    | 09:00   | 18:00   | 8.0小时 | ◉   | 编辑 删除│
│ 早班      | 08:00   | 17:00   | 8.0小时 | ○   | 编辑 删除│
│ 晚班      | 14:00   | 23:00   | 8.0小时 | ○   | 编辑 删除│
└─────────────────────────────────────┘
[+ 添加时间段]
```

#### 3.1.5 考勤组规则配置
**功能：**
1. 添加节假日
   - 单个日期选择
   - 日期范围选择（连续节假日）
   - 节假日名称
   - 是否带薪（可选）
2. 添加特殊日期
   - 日期选择
   - 是否工作日
   - 特殊原因说明
3. 查看规则列表
   - 按类型分组显示
   - 支持删除规则

**规则列表显示：**
```
节假日：
- 2025-01-01 元旦
- 2025-01-28 ~ 2025-02-03 春节

特殊日期：
- 2025-03-15 企业年会（非工作日）
- 2025-04-05 调休（工作日）
```

### 3.3 学生分配考勤组模块（企业导师）

#### 3.3.1 功能位置
集成在企业导师的"我指导的学生"页面 (`MentorStudentManagement.vue`)

#### 3.3.2 功能入口
- 在学生列表页面添加"分配到考勤组"按钮
- 在学生详情/操作中支持"分配到考勤组"

#### 3.3.3 分配方式
1. **单个分配**：在学生列表中，点击"分配到考勤组"按钮
2. **批量分配**：在学生列表中，选择多个学生，批量分配到考勤组

#### 3.3.4 分配对话框
**字段：**
- 选择考勤组*（下拉选择，显示考勤组名称和工作日类型）
  - 只显示当前企业已启用的考勤组
  - 显示考勤组的基本信息（工作日类型、时间段数量）
- 生效开始日期*（默认：实习开始日期）
- 生效结束日期（默认：实习结束日期，可为空）

**逻辑：**
- 一个学生（一个实习申请）只能属于一个考勤组
- 分配新考勤组时，自动解除旧的考勤组关联
- 生效日期范围应在实习开始和结束日期范围内
- 分配后，学生可以使用该考勤组的所有时间段进行打卡

#### 3.3.5 学生列表显示
**新增字段：**
- 在学生列表中添加"考勤组"列，显示学生所属的考勤组名称
- 如果学生未分配考勤组，显示"未分配"（红色提示）

### 3.4 学生打卡选择时间段模块

#### 3.4.1 打卡流程
**学生打卡时的操作流程：**
1. 学生进入考勤页面
2. 系统自动获取学生所属的考勤组
3. 显示考勤组的所有可用时间段（如：标准班 09:00-18:00、早班 08:00-17:00、晚班 14:00-23:00）
4. 学生选择要使用的时间段（默认选择考勤组的默认时间段）
5. 学生点击"上班打卡"或"下班打卡"
6. 系统记录打卡时间和选择的时间段

#### 3.4.2 打卡界面设计
**上班打卡：**
```
┌─────────────────────────────────────┐
│  上班打卡                            │
├─────────────────────────────────────┤
│  当前时间：2025-01-15 08:55:30      │
│                                      │
│  选择时间段*:                        │
│  ○ 标准班（09:00-18:00）            │
│  ◉ 早班（08:00-17:00）              │
│  ○ 晚班（14:00-23:00）              │
│                                      │
│  预计下班时间：17:00                 │
│                                      │
│  [取消]  [确认打卡]                  │
└─────────────────────────────────────┘
```

**下班打卡：**
```
┌─────────────────────────────────────┐
│  下班打卡                            │
├─────────────────────────────────────┤
│  当前时间：2025-01-15 17:05:20      │
│  上班时间：2025-01-15 08:00         │
│  使用时间段：早班（08:00-17:00）    │
│                                      │
│  实际工作时长：9.08小时              │
│                                      │
│  [取消]  [确认打卡]                  │
└─────────────────────────────────────┘
```

#### 3.4.3 业务规则
- 学生必须选择时间段才能打卡
- 如果考勤组只有一个时间段，默认选中且不可更改
- 如果考勤组有多个时间段，学生可以选择任意一个
- 上班打卡和下班打卡必须使用同一个时间段
- 如果学生上班打卡选择了某个时间段，下班打卡时自动使用相同时间段

### 3.5 学生休息和请假模块

#### 3.5.1 休息功能
**功能说明：**
- 学生可以选择休息日期（非工作日或调休）
- 休息不算缺勤，但也不算出勤
- 休息需要企业导师确认

**操作流程：**
1. 学生选择"选择休息"
2. 选择休息日期（可以选择非今天的日期）
3. 提交休息申请
4. 等待企业导师确认

**界面设计：**
```
┌─────────────────────────────────────┐
│  选择休息                            │
├─────────────────────────────────────┤
│  休息日期*: [2025-01-20]            │
│  说明：休息不算缺勤，但也不算出勤    │
│                                      │
│  [取消]  [提交申请]                  │
└─────────────────────────────────────┘
```

#### 3.5.2 请假功能
**功能说明：**
- 学生可以申请请假（病假、事假等）
- 请假不算缺勤，但也不算出勤
- 请假需要企业导师确认

**操作流程：**
1. 学生选择"申请请假"
2. 选择请假日期
3. 选择请假类型（病假、事假、其他）
4. 填写请假原因
5. 提交请假申请
6. 等待企业导师确认

**界面设计：**
```
┌─────────────────────────────────────┐
│  申请请假                            │
├─────────────────────────────────────┤
│  请假日期*: [2025-01-20]            │
│  请假类型*: [下拉选择：病假/事假/其他]│
│  请假原因*: [____________]          │
│                                      │
│  [取消]  [提交申请]                  │
└─────────────────────────────────────┘
```

#### 3.5.3 与考勤组的关系
- 休息和请假不受考勤组时间段限制
- 休息和请假日期如果不在应出勤日期范围内，系统会提示但不阻止
- 休息和请假在统计时会被正确计算（不算缺勤，不算出勤）

### 3.6 考勤统计自动计算模块

#### 3.6.1 应出勤日期计算逻辑

**算法：**
```
1. 获取学生的实习开始日期和结束日期（从InternshipApply表）
2. 获取学生所属的考勤组
3. 根据考勤组的工作日配置，生成应出勤日期列表：
   - 遍历实习开始到结束的所有日期
   - 判断日期是否为工作日（根据work_days_config）
   - 排除节假日（rule_type=2）
   - 应用特殊日期规则（rule_type=3）
4. 得到最终的应出勤日期列表
```

**示例：**
```
实习日期：2025-01-01 ~ 2025-01-31
工作日配置：周一至周五
节假日：2025-01-01（元旦）、2025-01-28~2025-02-03（春节）

应出勤日期：
2025-01-02（周四）
2025-01-03（周五）
2025-01-06（周一）
...
2025-01-27（周一）
（排除：2025-01-01、2025-01-28~2025-02-03）
```

#### 3.6.2 缺勤天数计算逻辑

**算法：**
```
1. 获取应出勤日期列表（根据考勤组规则计算）
2. 获取学生的实际考勤记录（从Attendance表）
3. 对于每个应出勤日期：
   - 查找该日期是否有考勤记录
   - 如果有考勤记录：
     - 考勤类型为"正常"或"迟到"或"早退" → 已出勤
     - 考勤类型为"请假" → 已请假（不算缺勤）
     - 考勤类型为"休息" → 已休息（不算缺勤）
     - 考勤类型为"缺勤" → 缺勤
   - 如果没有考勤记录：
     - 如果日期已过（当前日期 > 应出勤日期）→ 缺勤
     - 如果日期未到（当前日期 <= 应出勤日期）→ 待考勤（不算缺勤）
4. 统计缺勤天数
```

**注意事项：**
- 只统计已过去的应出勤日期
- 请假和休息不算缺勤
- 待确认状态的考勤，如果类型是"正常/迟到/早退"，不算缺勤

#### 3.6.3 出勤率计算逻辑

**公式：**
```
出勤率 = (正常出勤天数 + 迟到天数 + 早退天数) / (应出勤天数 - 请假天数 - 休息天数) × 100%

其中：
- 应出勤天数 = 根据考勤组规则计算的应出勤日期数量
- 正常出勤天数 = 考勤类型为"正常"且已确认的天数
- 迟到天数 = 考勤类型为"迟到"且已确认的天数
- 早退天数 = 考勤类型为"早退"且已确认的天数
- 请假天数 = 考勤类型为"请假"的天数
- 休息天数 = 考勤类型为"休息"的天数
```

## 四、API接口设计

### 4.1 考勤组管理接口

#### 4.1.1 创建考勤组
```
POST /internship/attendance-group
权限：ROLE_ENTERPRISE_ADMIN（仅企业管理员）

请求体：
{
  "groupName": "标准5天工作制",
  "groupDescription": "周一至周五，每天8小时",
  "workDaysType": 1,  // 1-周一到周五，2-周一到周六，3-周一到周日，4-自定义
  "workDaysConfig": null,  // 仅当workDaysType=4时使用
  "timeSlots": [
    {
      "slotName": "标准班",
      "startTime": "09:00",
      "endTime": "18:00",
      "workHours": 8.0,
      "isDefault": true
    },
    {
      "slotName": "早班",
      "startTime": "08:00",
      "endTime": "17:00",
      "workHours": 8.0,
      "isDefault": false
    }
  ],
  "status": 1
}

响应：
{
  "code": 200,
  "message": "创建成功",
  "data": {
    "groupId": 1,
    ...
  }
}
```

#### 4.1.2 更新考勤组
```
PUT /internship/attendance-group
权限：ROLE_ENTERPRISE_ADMIN（仅企业管理员）

请求体：
{
  "groupId": 1,
  "groupName": "标准5天工作制",
  ...
}
```

#### 4.1.3 删除考勤组
```
DELETE /internship/attendance-group/{groupId}
权限：ROLE_ENTERPRISE_ADMIN（仅企业管理员）

说明：只能删除没有学生关联的考勤组
```

#### 4.1.4 查询考勤组列表
```
GET /internship/attendance-group/page
权限：ROLE_ENTERPRISE_ADMIN, ROLE_ENTERPRISE_MENTOR

说明：
- 企业管理员：可以查看本企业的所有考勤组，可以进行CRUD操作
- 企业导师：只能查看本企业的已启用考勤组（只读），用于分配学生

参数：
- current: 页码
- size: 每页数量
- groupName: 考勤组名称（可选）

响应：
{
  "code": 200,
  "data": {
    "records": [
      {
        "groupId": 1,
        "groupName": "标准5天工作制",
        "workDaysPerWeek": 5,
        "studentCount": 10,
        "status": 1,
        ...
      }
    ],
    "total": 10
  }
}
```

#### 4.1.5 查询考勤组详情
```
GET /internship/attendance-group/{groupId}
权限：ROLE_ENTERPRISE_ADMIN, ROLE_ENTERPRISE_MENTOR

说明：
- 企业管理员：可以查看所有考勤组详情
- 企业导师：只能查看已启用考勤组详情（只读）

响应：
{
  "code": 200,
  "data": {
    "groupId": 1,
    "groupName": "标准5天工作制",
    "workDaysConfig": {...},
    "rules": [
      {
        "ruleId": 1,
        "ruleType": 2,
        "ruleDate": "2025-01-01",
        "description": "元旦"
      }
    ],
    "students": [
      {
        "studentId": 1,
        "studentName": "张三",
        "studentNo": "2021001001"
      }
    ]
  }
}
```

### 4.2 考勤组规则管理接口

#### 4.2.1 添加规则
```
POST /internship/attendance-group/{groupId}/rule
权限：ROLE_ENTERPRISE_ADMIN（仅企业管理员）

请求体：
{
  "ruleType": 2,  // 1-工作日，2-节假日，3-特殊日期
  "ruleDate": "2025-01-01",  // 单个日期
  "ruleStartDate": null,  // 日期范围开始
  "ruleEndDate": null,  // 日期范围结束
  "ruleValue": {
    "holidayName": "元旦",
    "isPaid": false
  },
  "description": "元旦"
}
```

#### 4.2.2 删除规则
```
DELETE /internship/attendance-group/rule/{ruleId}
权限：ROLE_ENTERPRISE_ADMIN（仅企业管理员）
```

#### 4.2.3 查询规则列表
```
GET /internship/attendance-group/{groupId}/rules
权限：ROLE_ENTERPRISE_ADMIN, ROLE_ENTERPRISE_MENTOR

说明：
- 企业管理员：可以查看所有考勤组规则
- 企业导师：只能查看已启用考勤组规则（只读）

响应：
{
  "code": 200,
  "data": [
    {
      "ruleId": 1,
      "ruleType": 2,
      "ruleDate": "2025-01-01",
      "description": "元旦"
    }
  ]
}
```

### 4.3 学生分配考勤组接口

#### 4.3.1 分配学生到考勤组
```
POST /internship/attendance-group/{groupId}/assign-student
权限：ROLE_ENTERPRISE_MENTOR, ROLE_ENTERPRISE_ADMIN

说明：
- 企业管理员：可以分配学生到考勤组
- 企业导师：只能分配自己指导的学生到考勤组

请求体：
{
  "applyId": 1,  // 实习申请ID
  "effectiveStartDate": "2025-01-01",
  "effectiveEndDate": "2025-06-30"
}

说明：一个applyId只能属于一个考勤组，分配新组时自动解除旧组
```

#### 4.3.2 批量分配学生到考勤组
```
POST /internship/attendance-group/{groupId}/assign-students
权限：ROLE_ENTERPRISE_MENTOR, ROLE_ENTERPRISE_ADMIN

说明：
- 企业管理员：可以批量分配本企业的学生到考勤组
- 企业导师：只能批量分配自己指导的学生到考勤组

请求体：
{
  "applyIds": [1, 2, 3],
  "effectiveStartDate": "2025-01-01",
  "effectiveEndDate": "2025-06-30"
}
```

#### 4.3.3 解除学生考勤组关联
```
DELETE /internship/attendance-group/student/{applyId}
权限：ROLE_ENTERPRISE_MENTOR, ROLE_ENTERPRISE_ADMIN

说明：
- 企业管理员：可以解除本企业学生的考勤组关联
- 企业导师：只能解除自己指导的学生的考勤组关联
```

#### 4.3.4 查询考勤组的学生列表
```
GET /internship/attendance-group/{groupId}/students
权限：ROLE_ENTERPRISE_ADMIN, ROLE_ENTERPRISE_MENTOR

说明：
- 企业管理员：可以查看考勤组的所有学生
- 企业导师：只能查看考勤组中自己指导的学生

响应：
{
  "code": 200,
  "data": [
    {
      "applyId": 1,
      "studentId": 1,
      "studentName": "张三",
      "studentNo": "2021001001",
      "effectiveStartDate": "2025-01-01",
      "effectiveEndDate": "2025-06-30"
    }
  ]
}
```

### 4.4 考勤统计接口修改

#### 4.4.1 修改统计接口
```
GET /internship/attendance/statistics
权限：ROLE_STUDENT, ROLE_ENTERPRISE_MENTOR, ROLE_ENTERPRISE_ADMIN, ROLE_CLASS_TEACHER

参数：
- studentId: 学生ID（可选）
- applyId: 实习申请ID（可选）
- startDate: 开始日期（可选）
- endDate: 结束日期（可选）

响应（新增字段）：
{
  "code": 200,
  "data": {
    "totalDays": 100,  // 应出勤总天数（根据考勤组规则计算）
    "normalDays": 80,  // 正常出勤天数
    "lateDays": 5,  // 迟到天数
    "earlyLeaveDays": 2,  // 早退天数
    "leaveDays": 8,  // 请假天数
    "absentDays": 5,  // 缺勤天数（自动计算）
    "restDays": 0,  // 休息天数
    "attendanceRate": 91.95,  // 出勤率
    "totalWorkHours": 640.0  // 总工作时长
  }
}
```

#### 4.4.2 新增接口：获取学生考勤组和时间段
```
GET /internship/attendance-group/student/{applyId}
权限：ROLE_STUDENT, ROLE_ENTERPRISE_MENTOR, ROLE_ENTERPRISE_ADMIN

响应：
{
  "code": 200,
  "data": {
    "groupId": 1,
    "groupName": "标准5天工作制",
    "workDaysType": 1,
    "workDaysTypeText": "周一到周五",
    "timeSlots": [
      {
        "slotId": 1,
        "slotName": "标准班",
        "startTime": "09:00",
        "endTime": "18:00",
        "workHours": 8.0,
        "isDefault": true
      },
      {
        "slotId": 2,
        "slotName": "早班",
        "startTime": "08:00",
        "endTime": "17:00",
        "workHours": 8.0,
        "isDefault": false
      }
    ]
  }
}
```

#### 4.4.3 修改打卡接口：支持选择时间段
```
POST /internship/attendance/check-in
权限：ROLE_STUDENT

请求体：
{
  "timeSlotId": 1  // 时间段ID（必填）
}

响应：
{
  "code": 200,
  "message": "上班打卡成功",
  "data": {
    "attendanceId": 1,
    "checkInTime": "2025-01-15 08:00:00",
    "timeSlotId": 1,
    "timeSlotName": "早班"
  }
}
```

```
POST /internship/attendance/check-out
权限：ROLE_STUDENT

请求体：
{
  "timeSlotId": 1  // 时间段ID（必填，应与上班打卡时选择的一致）
}

响应：
{
  "code": 200,
  "message": "下班打卡成功",
  "data": {
    "attendanceId": 1,
    "checkInTime": "2025-01-15 08:00:00",
    "checkOutTime": "2025-01-15 17:05:00",
    "workHours": 9.08,
    "timeSlotId": 1,
    "timeSlotName": "早班"
  }
}
```

#### 4.4.4 新增接口：获取应出勤日期列表
```
GET /internship/attendance/expected-dates
权限：ROLE_STUDENT, ROLE_ENTERPRISE_MENTOR, ROLE_ENTERPRISE_ADMIN, ROLE_CLASS_TEACHER

参数：
- applyId: 实习申请ID（必填）
- startDate: 开始日期（可选）
- endDate: 结束日期（可选）

响应：
{
  "code": 200,
  "data": {
    "applyId": 1,
    "groupId": 1,
    "groupName": "标准5天工作制",
    "expectedDates": [
      "2025-01-02",
      "2025-01-03",
      "2025-01-06",
      ...
    ],
    "holidays": [
      "2025-01-01",
      "2025-01-28",
      ...
    ],
    "totalExpectedDays": 100
  }
}
```

## 五、前端页面设计

### 5.1 考勤组管理页面（企业管理员）

**页面路径：** `/enterprise/admin/attendance-group`
**菜单位置：** 企业管理 > 考勤组管理
**权限：** `ROLE_ENTERPRISE_ADMIN`

**页面结构：**
```
┌─────────────────────────────────────────┐
│  考勤组管理                              │
├─────────────────────────────────────────┤
│  [创建考勤组]                            │
├─────────────────────────────────────────┤
│  搜索：考勤组名称 [搜索] [重置]          │
├─────────────────────────────────────────┤
│  列表：                                  │
│  ┌──────────────────────────────────────────────┐  │
│  │ 考勤组名称 | 工作日 | 时间段 | 学生数 | 状态 | 操作│  │
│  ├──────────────────────────────────────────────┤  │
│  │ 标准5天工作制 | 周一~周五 | 3 | 10 | 启用 | ...│  │
│  └──────────────────────────────────────────────┘  │
└─────────────────────────────────────────┘
```

**功能说明：**
- 企业管理员可以创建、编辑、删除考勤组
- 可以配置考勤组规则（节假日、特殊日期）
- 可以查看考勤组的学生列表
- 可以启用/禁用考勤组

### 5.2 创建/编辑考勤组对话框

**表单结构：**
```
┌─────────────────────────────────────┐
│  创建考勤组                          │
├─────────────────────────────────────┤
│  考勤组名称*: [____________]         │
│  考勤组描述:  [____________]         │
│  工作日配置*:                        │
│    ☑ 周一  ☑ 周二  ☑ 周三  ☑ 周四   │
│    ☑ 周五  ☐ 周六  ☐ 周日           │
│    每周工作天数：5天                 │
│  默认工作时长*: [8.0] 小时           │
│  状态: ○ 启用  ○ 禁用               │
│                                      │
│  [取消]  [确定]                      │
└─────────────────────────────────────┘
```

### 5.3 考勤组规则配置页面

**页面结构：**
```
┌─────────────────────────────────────┐
│  考勤组规则配置 - 标准5天工作制      │
├─────────────────────────────────────┤
│  [添加节假日] [添加特殊日期]         │
├─────────────────────────────────────┤
│  节假日：                            │
│  ┌────────────────────────────────┐ │
│  │ 2025-01-01 元旦        [删除]  │ │
│  │ 2025-01-28~2025-02-03 春节 [删除]│ │
│  └────────────────────────────────┘ │
│                                      │
│  特殊日期：                          │
│  ┌────────────────────────────────┐ │
│  │ 2025-03-15 企业年会（非工作日）[删除]│ │
│  └────────────────────────────────┘ │
└─────────────────────────────────────┘
```

### 5.4 学生分配考勤组对话框

**表单结构：**
```
┌─────────────────────────────────────┐
│  分配到考勤组                        │
├─────────────────────────────────────┤
│  学生：张三（2021001001）            │
│  实习日期：2025-01-01 ~ 2025-06-30  │
│                                      │
│  选择考勤组*: [下拉选择]             │
│  生效开始日期*: [2025-01-01]        │
│  生效结束日期:  [2025-06-30]        │
│                                      │
│  [取消]  [确定]                      │
└─────────────────────────────────────┘
```

### 5.5 学生管理页面集成（企业导师）

**修改位置：** `internship-web/src/views/enterprise/MentorStudentManagement.vue`

**新增功能：**
1. 在学生列表中添加"考勤组"列，显示学生所属的考勤组名称
   - 如果未分配，显示"未分配"（红色提示）
2. 在操作列中添加"分配到考勤组"按钮
3. 支持批量选择学生，批量分配到考勤组
4. 考勤组下拉选择只显示已启用的考勤组

**列表修改：**
```
┌──────────────────────────────────────────────┐
│  我指导的学生                                 │
├──────────────────────────────────────────────┤
│  搜索栏...                                    │
├──────────────────────────────────────────────┤
│  序号 | 姓名 | 学号 | 考勤组 | ... | 操作    │
│   1  | 张三 | ... | 标准5天工作制 | ... | ...│
│   2  | 李四 | ... | 未分配 | ... | ...      │
└──────────────────────────────────────────────┘
```

**分配对话框：**
```
┌─────────────────────────────────────┐
│  分配到考勤组                        │
├─────────────────────────────────────┤
│  学生：张三（2021001001）            │
│  实习日期：2025-01-01 ~ 2025-06-30  │
│                                      │
│  选择考勤组*: [下拉选择]             │
│    - 标准5天工作制（周一到周五，3个时间段）│
│    - 6天工作制（周一到周六，2个时间段）   │
│  生效开始日期*: [2025-01-01]        │
│  生效结束日期:  [2025-06-30]        │
│                                      │
│  [取消]  [确定]                      │
└─────────────────────────────────────┘
```

## 六、后端实现要点

### 6.1 实体类设计

#### 6.1.1 AttendanceGroup
```java
@TableName("attendance_group")
public class AttendanceGroup {
    private Long groupId;
    private Long enterpriseId;
    private Long mentorId;
    private String groupName;
    private String groupDescription;
    private Integer workDaysType;  // 1-周一到周五，2-周一到周六，3-周一到周日，4-自定义
    private String workDaysConfig;  // JSON字符串（仅当workDaysType=4时使用）
    private BigDecimal defaultWorkHours;
    private Integer status;
    // ... 其他字段
}
```

#### 6.1.2 AttendanceGroupTimeSlot
```java
@TableName("attendance_group_time_slot")
public class AttendanceGroupTimeSlot {
    private Long slotId;
    private Long groupId;
    private String slotName;  // 时间段名称（如：早班、晚班、标准班）
    private LocalTime startTime;  // 上班时间
    private LocalTime endTime;  // 下班时间
    private BigDecimal workHours;  // 工作时长（小时）
    private Integer isDefault;  // 是否默认
    private Integer sortOrder;  // 排序顺序
    // ... 其他字段
}
```

#### 6.1.3 AttendanceGroupRule
```java
@TableName("attendance_group_rule")
public class AttendanceGroupRule {
    private Long ruleId;
    private Long groupId;
    private Integer ruleType;  // 1-工作日，2-节假日，3-特殊日期
    private LocalDate ruleDate;
    private LocalDate ruleStartDate;
    private LocalDate ruleEndDate;
    private String ruleValue;  // JSON字符串
    private String description;
    // ... 其他字段
}
```

#### 6.1.4 AttendanceGroupStudent
```java
@TableName("attendance_group_student")
public class AttendanceGroupStudent {
    private Long id;
    private Long groupId;
    private Long applyId;
    private Long studentId;
    private LocalDate effectiveStartDate;
    private LocalDate effectiveEndDate;
    private Integer status;
    // ... 其他字段
}
```

### 6.2 Service层实现

#### 6.2.1 应出勤日期计算服务
```java
public class AttendanceGroupService {
    /**
     * 根据考勤组规则计算应出勤日期列表
     */
    public List<LocalDate> calculateExpectedDates(
        Long groupId, 
        LocalDate startDate, 
        LocalDate endDate
    ) {
        // 1. 获取考勤组配置
        // 2. 获取节假日规则
        // 3. 获取特殊日期规则
        // 4. 遍历日期范围，生成应出勤日期列表
        // 5. 排除节假日，应用特殊日期规则
        // 6. 返回结果
    }
    
    /**
     * 计算缺勤天数
     */
    public int calculateAbsentDays(Long applyId, LocalDate startDate, LocalDate endDate) {
        // 1. 获取学生所属考勤组
        // 2. 计算应出勤日期列表
        // 3. 获取实际考勤记录
        // 4. 对比计算缺勤天数
        // 5. 返回结果
    }
}
```

### 6.3 数据权限控制

#### 6.3.1 考勤组管理权限
- **企业管理员（ROLE_ENTERPRISE_ADMIN）**：
  - 可以创建、编辑、删除本企业的所有考勤组
  - 可以配置考勤组规则（节假日、特殊日期）
  - 可以查看本企业的所有考勤组
  - 可以查看考勤组的所有学生列表
- **企业导师（ROLE_ENTERPRISE_MENTOR）**：
  - 只能查看本企业的已启用考勤组（只读）
  - 可以将自己指导的学生分配到考勤组
  - 可以查看考勤组中自己指导的学生
  - 不能创建、编辑、删除考勤组
  - 不能配置考勤组规则

#### 6.3.2 学生分配权限
- **企业管理员**：可以分配本企业的所有学生到考勤组
- **企业导师**：只能分配自己指导的学生到考勤组

#### 6.3.3 数据过滤
- 考勤组数据按企业ID进行权限过滤
- 企业导师只能看到自己企业的考勤组
- 学生只能查看自己所属的考勤组信息

## 七、统计功能修改

### 7.1 修改统计接口实现

**文件：** `AttendanceServiceImpl.java`

**修改方法：** `getAttendanceStatistics`

**修改内容：**
1. 获取学生所属的考勤组
2. 根据考勤组规则计算应出勤日期列表
3. 计算缺勤天数（自动计算，不再依赖手动标记）
4. 更新出勤率计算公式

### 7.2 前端统计显示修改

**修改文件：**
- `internship-web/src/views/student/Attendance.vue`
- `internship-web/src/views/teacher/Attendance.vue`
- `internship-web/src/views/enterprise/AttendanceManagement.vue`

**修改内容：**
- 缺勤天数显示为自动计算的结果
- 添加"应出勤天数"统计项（可选）
- 出勤率计算基于考勤组规则

## 八、开发计划

### 8.1 第一阶段：数据库和基础功能
1. 创建数据库表（attendance_group, attendance_group_time_slot, attendance_group_rule, attendance_group_student）
2. 修改考勤表（添加group_id和time_slot_id字段）
3. 创建实体类、Mapper、Service、Controller
4. 实现考勤组的CRUD功能（企业管理员）
5. 实现考勤组时间段的CRUD功能
6. 实现考勤组规则的CRUD功能（企业管理员）

### 8.2 第二阶段：学生分配功能
1. 实现学生分配到考勤组的功能
2. 在学生管理页面集成分配功能
3. 实现批量分配功能

### 8.3 第三阶段：自动计算逻辑
1. 实现应出勤日期计算算法
2. 实现缺勤天数自动计算算法
3. 修改统计接口，集成自动计算逻辑
4. 添加单元测试

### 8.4 第四阶段：前端页面开发
1. 开发考勤组管理页面（企业管理员）
   - 考勤组列表页面 (`/enterprise/admin/attendance-group`)
   - 创建/编辑考勤组对话框
   - 考勤组规则配置页面
   - 工作日配置前端实现（复选框转JSON）
2. 添加菜单配置（企业管理 > 考勤组管理）
   - 在 `menu.config.js` 中添加菜单项
   - 路径：`/enterprise/admin/attendance-group`
   - 权限：`ROLE_ENTERPRISE_ADMIN`
3. 在学生管理页面集成考勤组分配功能（企业导师）
   - 添加"考勤组"列
   - 添加"分配到考勤组"按钮和对话框
   - 批量分配功能
4. 修改学生打卡页面，支持选择时间段
5. 修改统计页面显示

#### 8.4.1 菜单配置示例
在 `internship-web/src/config/menu.config.js` 中添加：
```javascript
// ========== 企业管理（企业管理员） ==========
{
  index: 'enterprise',
  title: '企业管理',
  icon: OfficeBuilding,
  roles: ['ROLE_ENTERPRISE_ADMIN'],
  children: [
    // ... 其他菜单项
    {
      index: '/enterprise/admin/attendance-group',
      title: '考勤组管理',
      icon: Calendar,
      roles: ['ROLE_ENTERPRISE_ADMIN']
    }
  ]
}
```

#### 8.4.2 前端工作日配置实现
```vue
<template>
  <el-form-item label="工作日配置" prop="workDaysType">
    <el-radio-group v-model="form.workDaysType" @change="handleWorkDaysTypeChange">
      <el-radio :label="1">周一到周五（标准5天工作制）</el-radio>
      <el-radio :label="2">周一到周六（6天工作制）</el-radio>
      <el-radio :label="3">周一到周日（7天工作制）</el-radio>
      <el-radio :label="4">自定义</el-radio>
    </el-radio-group>
    
    <div v-if="form.workDaysType === 4" class="custom-work-days" style="margin-top: 10px;">
      <el-checkbox v-model="customDays.monday">周一</el-checkbox>
      <el-checkbox v-model="customDays.tuesday">周二</el-checkbox>
      <el-checkbox v-model="customDays.wednesday">周三</el-checkbox>
      <el-checkbox v-model="customDays.thursday">周四</el-checkbox>
      <el-checkbox v-model="customDays.friday">周五</el-checkbox>
      <el-checkbox v-model="customDays.saturday">周六</el-checkbox>
      <el-checkbox v-model="customDays.sunday">周日</el-checkbox>
    </div>
  </el-form-item>
</template>

<script setup>
import { ref, watch } from 'vue'

const form = ref({
  workDaysType: 1,  // 默认周一到周五
  workDaysConfig: null
})

const customDays = ref({
  monday: true,
  tuesday: true,
  wednesday: true,
  thursday: true,
  friday: true,
  saturday: false,
  sunday: false
})

// 处理工作日类型变化
const handleWorkDaysTypeChange = (value) => {
  if (value === 1) {
    // 周一到周五
    customDays.value = {
      monday: true, tuesday: true, wednesday: true,
      thursday: true, friday: true, saturday: false, sunday: false
    }
  } else if (value === 2) {
    // 周一到周六
    customDays.value = {
      monday: true, tuesday: true, wednesday: true,
      thursday: true, friday: true, saturday: true, sunday: false
    }
  } else if (value === 3) {
    // 周一到周日
    customDays.value = {
      monday: true, tuesday: true, wednesday: true,
      thursday: true, friday: true, saturday: true, sunday: true
    }
  }
}

// 提交表单时转换
const submitForm = async () => {
  const formData = {
    ...form.value,
    workDaysConfig: form.value.workDaysType === 4 
      ? JSON.stringify(customDays.value) 
      : null
  }
  // 提交到后端
  await api.createAttendanceGroup(formData)
}

// 编辑时加载数据
const loadGroupData = (group) => {
  form.value.workDaysType = group.workDaysType
  if (group.workDaysType === 4 && group.workDaysConfig) {
    customDays.value = JSON.parse(group.workDaysConfig)
  }
}
</script>
```

### 8.5 第五阶段：测试和优化
1. 功能测试
2. 性能优化
3. 边界情况处理
4. 文档完善

## 九、注意事项

### 9.1 数据兼容性
- 历史考勤数据没有考勤组关联，需要兼容处理
- 对于没有考勤组的学生，可以使用默认规则（周一至周五）或提示设置考勤组

### 9.2 性能考虑
- 应出勤日期计算可能涉及大量日期遍历，需要优化算法
- 可以考虑缓存计算结果
- 批量计算时使用异步处理

### 9.3 业务规则
- 一个学生只能属于一个考勤组
- 考勤组删除前需要检查是否有学生关联
- 考勤组规则修改后，需要重新计算相关学生的缺勤天数

### 9.4 用户体验
- 考勤组创建时提供常用模板（5天工作制、6天工作制等）
- 节假日支持批量导入（如导入全年法定节假日）
- 提供考勤组规则的预览功能

## 十、SQL建表语句

### 10.1 考勤组表
```sql
CREATE TABLE `attendance_group` (
  `group_id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '考勤组ID',
  `enterprise_id` BIGINT NOT NULL COMMENT '所属企业ID',
  `mentor_id` BIGINT NOT NULL COMMENT '创建人（企业导师ID）',
  `group_name` VARCHAR(100) NOT NULL COMMENT '考勤组名称',
  `group_description` VARCHAR(500) DEFAULT NULL COMMENT '考勤组描述',
  `work_days_type` INT NOT NULL DEFAULT 1 COMMENT '工作日类型：1-周一到周五，2-周一到周六，3-周一到周日，4-自定义',
  `work_days_config` VARCHAR(50) DEFAULT NULL COMMENT '工作日配置（自定义时使用，JSON格式）',
  `default_work_hours` DECIMAL(4,2) NOT NULL DEFAULT 8.00 COMMENT '默认工作时长（小时）',
  `status` INT NOT NULL DEFAULT 1 COMMENT '状态：1-启用，0-禁用',
  `delete_flag` INT NOT NULL DEFAULT 0 COMMENT '删除标志：0-未删除，1-已删除',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `create_user_id` BIGINT NOT NULL COMMENT '创建人ID',
  `update_user_id` BIGINT DEFAULT NULL COMMENT '更新人ID',
  PRIMARY KEY (`group_id`),
  KEY `idx_enterprise_id` (`enterprise_id`),
  KEY `idx_mentor_id` (`mentor_id`),
  KEY `idx_delete_flag` (`delete_flag`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='考勤组表';
```

### 10.2 考勤组时间段表
```sql
CREATE TABLE `attendance_group_time_slot` (
  `slot_id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '时间段ID',
  `group_id` BIGINT NOT NULL COMMENT '考勤组ID',
  `slot_name` VARCHAR(50) NOT NULL COMMENT '时间段名称（如：早班、晚班、标准班）',
  `start_time` TIME NOT NULL COMMENT '上班时间',
  `end_time` TIME NOT NULL COMMENT '下班时间',
  `work_hours` DECIMAL(4,2) NOT NULL COMMENT '工作时长（小时）',
  `is_default` INT NOT NULL DEFAULT 0 COMMENT '是否默认：1-是，0-否',
  `sort_order` INT NOT NULL DEFAULT 0 COMMENT '排序顺序',
  `delete_flag` INT NOT NULL DEFAULT 0 COMMENT '删除标志：0-未删除，1-已删除',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`slot_id`),
  KEY `idx_group_id` (`group_id`),
  KEY `idx_delete_flag` (`delete_flag`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='考勤组时间段表';
```

### 10.3 考勤组规则表
```sql
CREATE TABLE `attendance_group_rule` (
  `rule_id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '规则ID',
  `group_id` BIGINT NOT NULL COMMENT '考勤组ID',
  `rule_type` INT NOT NULL COMMENT '规则类型：1-工作日，2-节假日，3-特殊日期',
  `rule_date` DATE DEFAULT NULL COMMENT '规则日期（单个日期）',
  `rule_start_date` DATE DEFAULT NULL COMMENT '规则开始日期（日期范围）',
  `rule_end_date` DATE DEFAULT NULL COMMENT '规则结束日期（日期范围）',
  `rule_value` VARCHAR(200) DEFAULT NULL COMMENT '规则值（JSON格式）',
  `description` VARCHAR(500) DEFAULT NULL COMMENT '规则描述',
  `delete_flag` INT NOT NULL DEFAULT 0 COMMENT '删除标志：0-未删除，1-已删除',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`rule_id`),
  KEY `idx_group_id` (`group_id`),
  KEY `idx_rule_type` (`rule_type`),
  KEY `idx_rule_date` (`rule_date`),
  KEY `idx_delete_flag` (`delete_flag`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='考勤组规则表';
```

### 10.4 考勤组学生关联表
```sql
CREATE TABLE `attendance_group_student` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '关联ID',
  `group_id` BIGINT NOT NULL COMMENT '考勤组ID',
  `apply_id` BIGINT NOT NULL COMMENT '实习申请ID',
  `student_id` BIGINT NOT NULL COMMENT '学生ID',
  `effective_start_date` DATE NOT NULL COMMENT '生效开始日期',
  `effective_end_date` DATE DEFAULT NULL COMMENT '生效结束日期',
  `status` INT NOT NULL DEFAULT 1 COMMENT '状态：1-生效，0-失效',
  `delete_flag` INT NOT NULL DEFAULT 0 COMMENT '删除标志：0-未删除，1-已删除',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `create_user_id` BIGINT NOT NULL COMMENT '创建人ID',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_apply_id` (`apply_id`),
  KEY `idx_group_id` (`group_id`),
  KEY `idx_student_id` (`student_id`),
  KEY `idx_delete_flag` (`delete_flag`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='考勤组学生关联表';
```

### 10.5 修改考勤表
```sql
ALTER TABLE `attendance` 
ADD COLUMN `group_id` BIGINT DEFAULT NULL COMMENT '考勤组ID' AFTER `apply_id`,
ADD COLUMN `time_slot_id` BIGINT DEFAULT NULL COMMENT '时间段ID' AFTER `group_id`,
ADD KEY `idx_group_id` (`group_id`),
ADD KEY `idx_time_slot_id` (`time_slot_id`);
```

## 十一、扩展功能（可选）

### 10.1 考勤组模板
- 系统提供常用考勤组模板
- 企业可以基于模板创建考勤组

### 10.2 节假日库
- 系统维护法定节假日库
- 支持一键导入全年节假日

### 10.3 考勤组复制
- 支持复制现有考勤组
- 快速创建相似的考勤组

### 10.4 考勤组历史记录
- 记录考勤组规则的变更历史
- 支持查看历史规则对统计的影响

---

**文档版本：** v1.0  
**创建日期：** 2025-01-XX  
**最后更新：** 2025-01-XX

