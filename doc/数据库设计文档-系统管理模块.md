# 数据库设计文档 - 系统管理模块

## 一、数据库基本信息

- **数据库名称**：`internship_management_db`
- **数据库版本**：MySQL 8.0+
- **字符集**：`utf8mb4`
- **排序规则**：`utf8mb4_unicode_ci`
- **存储引擎**：`InnoDB`

## 二、表结构设计

### 2.1 学校信息表（school_info）

#### 表说明
存储学校基本信息，由系统管理员管理。

#### 字段设计

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| school_id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 学校ID（主键） |
| school_name | VARCHAR | 100 | NOT NULL | - | 学校名称 |
| school_code | VARCHAR | 50 | NOT NULL | - | 学校代码（唯一） |
| address | VARCHAR | 200 | NULL | - | 地址 |
| contact_person | VARCHAR | 50 | NULL | - | 联系人 |
| contact_phone | VARCHAR | 20 | NULL | - | 联系电话 |
| status | TINYINT | 1 | NOT NULL | 1 | 状态：1-启用，0-禁用 |
| delete_flag | TINYINT | 1 | NOT NULL | 0 | 删除标志：0-未删除，1-已删除 |
| create_time | DATETIME | 6 | NOT NULL | CURRENT_TIMESTAMP(6) | 创建时间 |
| update_time | DATETIME | 6 | NOT NULL | CURRENT_TIMESTAMP(6) | 更新时间 |

#### 索引设计
- **主键索引**：`school_id`
- **唯一索引**：`uk_school_code` (school_code)
- **普通索引**：`idx_delete_flag` (delete_flag)
- **普通索引**：`idx_status` (status)

#### 业务规则
- 学校代码必须唯一
- 软删除机制，删除时只更新delete_flag
- 状态字段控制学校是否启用

---

### 2.2 学院信息表（college_info）

#### 表说明
存储学院基本信息，由学校管理员管理，每个学院属于一个学校。

#### 字段设计

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| college_id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 学院ID（主键） |
| college_name | VARCHAR | 100 | NOT NULL | - | 学院名称 |
| college_code | VARCHAR | 50 | NOT NULL | - | 学院代码 |
| school_id | BIGINT | - | NOT NULL | - | 所属学校ID（外键） |
| dean_name | VARCHAR | 50 | NULL | - | 院长姓名 |
| contact_phone | VARCHAR | 20 | NULL | - | 联系电话 |
| status | TINYINT | 1 | NOT NULL | 1 | 状态：1-启用，0-禁用 |
| delete_flag | TINYINT | 1 | NOT NULL | 0 | 删除标志：0-未删除，1-已删除 |
| create_time | DATETIME | 6 | NOT NULL | CURRENT_TIMESTAMP(6) | 创建时间 |
| update_time | DATETIME | 6 | NOT NULL | CURRENT_TIMESTAMP(6) | 更新时间 |

#### 索引设计
- **主键索引**：`college_id`
- **唯一索引**：`uk_college_code_school` (college_code, school_id) - 学院代码在同一学校内唯一
- **普通索引**：`idx_school_id` (school_id)
- **普通索引**：`idx_delete_flag` (delete_flag)
- **普通索引**：`idx_status` (status)

#### 外键约束
- **fk_college_school**：`school_id` → `school_info.school_id`
  - ON DELETE RESTRICT
  - ON UPDATE CASCADE

#### 业务规则
- 学院代码在同一学校内必须唯一
- 必须关联一个学校
- 软删除机制

---

### 2.3 专业信息表（major_info）

#### 表说明
存储专业基本信息，由学院负责人管理，每个专业属于一个学院。

#### 字段设计

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| major_id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 专业ID（主键） |
| major_name | VARCHAR | 100 | NOT NULL | - | 专业名称 |
| major_code | VARCHAR | 50 | NOT NULL | - | 专业代码 |
| college_id | BIGINT | - | NOT NULL | - | 所属学院ID（外键） |
| duration | INT | - | NULL | - | 学制年限 |
| training_objective | TEXT | - | NULL | - | 培养目标 |
| status | TINYINT | 1 | NOT NULL | 1 | 状态：1-启用，0-禁用 |
| delete_flag | TINYINT | 1 | NOT NULL | 0 | 删除标志：0-未删除，1-已删除 |
| create_time | DATETIME | 6 | NOT NULL | CURRENT_TIMESTAMP(6) | 创建时间 |
| update_time | DATETIME | 6 | NOT NULL | CURRENT_TIMESTAMP(6) | 更新时间 |

#### 索引设计
- **主键索引**：`major_id`
- **唯一索引**：`uk_major_code_college` (major_code, college_id) - 专业代码在同一学院内唯一
- **普通索引**：`idx_college_id` (college_id)
- **普通索引**：`idx_delete_flag` (delete_flag)
- **普通索引**：`idx_status` (status)

#### 外键约束
- **fk_major_college**：`college_id` → `college_info.college_id`
  - ON DELETE RESTRICT
  - ON UPDATE CASCADE

#### 业务规则
- 专业代码在同一学院内必须唯一
- 必须关联一个学院
- 软删除机制

---

### 2.4 班级信息表（class_info）

#### 表说明
存储班级基本信息，由班主任管理，每个班级属于一个专业。包含班级分享码功能，用于学生自主注册。

#### 字段设计

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| class_id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 班级ID（主键） |
| class_name | VARCHAR | 100 | NOT NULL | - | 班级名称 |
| class_code | VARCHAR | 50 | NOT NULL | - | 班级代码 |
| major_id | BIGINT | - | NOT NULL | - | 所属专业ID（外键） |
| enrollment_year | INT | - | NOT NULL | - | 入学年份 |
| class_teacher_id | BIGINT | - | NULL | - | 班主任ID（外键，关联用户表） |
| share_code | VARCHAR | 8 | NULL | - | 班级分享码（唯一） |
| share_code_expire_time | DATETIME | 6 | NULL | - | 分享码过期时间 |
| share_code_generate_time | DATETIME | 6 | NULL | - | 分享码生成时间 |
| share_code_use_count | INT | - | NOT NULL | 0 | 分享码使用次数 |
| status | TINYINT | 1 | NOT NULL | 1 | 状态：1-启用，0-禁用 |
| delete_flag | TINYINT | 1 | NOT NULL | 0 | 删除标志：0-未删除，1-已删除 |
| create_time | DATETIME | 6 | NOT NULL | CURRENT_TIMESTAMP(6) | 创建时间 |
| update_time | DATETIME | 6 | NOT NULL | CURRENT_TIMESTAMP(6) | 更新时间 |

#### 索引设计
- **主键索引**：`class_id`
- **唯一索引**：`uk_class_code_major` (class_code, major_id) - 班级代码在同一专业内唯一
- **唯一索引**：`uk_share_code` (share_code) - 分享码全局唯一
- **普通索引**：`idx_major_id` (major_id)
- **普通索引**：`idx_class_teacher_id` (class_teacher_id)
- **普通索引**：`idx_delete_flag` (delete_flag)
- **普通索引**：`idx_status` (status)

#### 外键约束
- **fk_class_major**：`major_id` → `major_info.major_id`
  - ON DELETE RESTRICT
  - ON UPDATE CASCADE
- **fk_class_teacher**：`class_teacher_id` → `user_info.user_id`（待创建用户表后添加）

#### 业务规则
- 班级代码在同一专业内必须唯一
- 必须关联一个专业
- 分享码全局唯一，6-8位数字字母组合
- 分享码默认有效期30天
- 分享码使用次数统计
- 软删除机制

---

### 2.5 学期信息表（semester_info）

#### 表说明
存储学期信息，由系统管理员管理，用于实习计划的时间管理。

#### 字段设计

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| semester_id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 学期ID（主键） |
| semester_name | VARCHAR | 50 | NOT NULL | - | 学期名称（唯一） |
| start_date | DATE | - | NOT NULL | - | 开始日期 |
| end_date | DATE | - | NOT NULL | - | 结束日期 |
| is_current | TINYINT | 1 | NOT NULL | 0 | 是否当前学期：1-是，0-否 |
| delete_flag | TINYINT | 1 | NOT NULL | 0 | 删除标志：0-未删除，1-已删除 |
| create_time | DATETIME | 6 | NOT NULL | CURRENT_TIMESTAMP(6) | 创建时间 |
| update_time | DATETIME | 6 | NOT NULL | CURRENT_TIMESTAMP(6) | 更新时间 |

#### 索引设计
- **主键索引**：`semester_id`
- **唯一索引**：`uk_semester_name` (semester_name)
- **普通索引**：`idx_is_current` (is_current)
- **普通索引**：`idx_delete_flag` (delete_flag)

#### 业务规则
- 学期名称必须唯一
- 同一时间段内只能有一个当前学期
- 软删除机制

---

### 2.6 系统配置表（system_config）

#### 表说明
存储系统配置信息，由系统管理员管理，用于存储系统参数和全局设置。

#### 字段设计

| 字段名 | 类型 | 长度 | 是否为空 | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| config_id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 配置ID（主键） |
| config_key | VARCHAR | 100 | NOT NULL | - | 配置键（唯一） |
| config_value | TEXT | - | NULL | - | 配置值 |
| config_type | VARCHAR | 50 | NULL | - | 配置类型 |
| description | VARCHAR | 200 | NULL | - | 配置描述 |
| delete_flag | TINYINT | 1 | NOT NULL | 0 | 删除标志：0-未删除，1-已删除 |
| create_time | DATETIME | 6 | NOT NULL | CURRENT_TIMESTAMP(6) | 创建时间 |
| update_time | DATETIME | 6 | NOT NULL | CURRENT_TIMESTAMP(6) | 更新时间 |

#### 索引设计
- **主键索引**：`config_id`
- **唯一索引**：`uk_config_key` (config_key)
- **普通索引**：`idx_config_type` (config_type)
- **普通索引**：`idx_delete_flag` (delete_flag)

#### 业务规则
- 配置键必须唯一
- 可用于存储实习类型定义、评价参数配置、系统通知模板等
- 软删除机制

---

## 三、表关系图

```
school_info (学校)
    │
    ├── college_info (学院)
    │       │
    │       └── major_info (专业)
    │               │
    │               └── class_info (班级)
    │                       │
    │                       └── class_teacher_id → user_info (班主任)
    │
semester_info (学期) - 独立表
system_config (系统配置) - 独立表
```

## 四、数据权限设计

### 4.1 数据权限范围

- **系统管理员**：可以访问所有学校、学院、专业、班级数据
- **学校管理员**：只能访问本校的学院、专业、班级数据
- **学院负责人**：只能访问本院的专业、班级数据
- **班主任**：只能访问本班数据

### 4.2 数据权限实现

在Service层查询时，根据当前登录用户角色自动添加查询条件：
- 系统管理员：不添加过滤条件
- 学校管理员：添加 `school_id = 当前用户学校ID`
- 学院负责人：添加 `college_id = 当前用户学院ID`
- 班主任：添加 `class_id = 当前用户班级ID`

## 五、索引优化建议

1. **外键字段**：所有外键字段已创建索引，提高关联查询性能
2. **查询字段**：delete_flag、status等常用查询字段已创建索引
3. **唯一性约束**：所有唯一性约束字段已创建唯一索引
4. **复合索引**：学院代码+学校ID、专业代码+学院ID、班级代码+专业ID创建复合唯一索引

## 六、软删除机制

所有表都实现了软删除机制：
- `delete_flag = 0`：未删除
- `delete_flag = 1`：已删除
- 所有查询必须过滤 `delete_flag = 0` 的数据
- 删除操作只更新 `delete_flag` 字段，不物理删除数据

## 七、时间字段

所有表都包含时间字段：
- `create_time`：创建时间，自动设置为当前时间
- `update_time`：更新时间，自动更新为当前时间
- 使用 `DATETIME(6)` 类型，支持微秒精度

## 八、后续扩展

1. **用户表**：待创建用户相关表后，完善班级表的班主任外键约束
2. **审计字段**：可考虑添加创建人、更新人字段
3. **版本控制**：可考虑添加版本号字段，支持乐观锁

