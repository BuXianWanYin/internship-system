# 班主任学生成绩管理页面方案

## 一、现状分析

### 1.1 现有实现

#### 学生端
- **位置**：`internship-web/src/views/student/ComprehensiveScore.vue`
- **功能**：学生可以查看自己的综合成绩和详情
- **显示内容**：
  - 综合成绩总分和等级
  - 企业评价详情（各指标分数）
  - 学校评价详情（各指标分数）
  - 学生自评详情
  - 成绩计算公式

#### 班主任端
- **位置**：`internship-web/src/views/teacher/StudentEvaluation.vue`
- **功能**：班主任评价学生
- **显示内容**：
  - 学生列表
  - 评价状态
  - **综合成绩列**（已添加，显示总分和等级）
  - 操作按钮（评价/查看）

#### 后端API
- **综合成绩查询**：`GET /evaluation/comprehensive-score/page` - 分页查询综合成绩列表
- **综合成绩详情**：`GET /evaluation/comprehensive-score/apply/{applyId}` - 根据申请ID查询
- **企业评价详情**：`GET /evaluation/enterprise/apply/{applyId}` - 查询企业评价详情
- **学校评价详情**：`GET /evaluation/school/apply/{applyId}` - 查询学校评价详情
- **学生自评详情**：`GET /evaluation/self/apply/{applyId}` - 查询学生自评详情

### 1.2 存在的问题

1. **缺少专门的成绩管理页面**：
   - 班主任评价页面主要用于评价，不是专门查看成绩的
   - 没有统一的成绩列表页面，无法快速查看所有学生的成绩

2. **成绩详情查看不便**：
   - 需要点击"查看"才能看到评价详情
   - 无法直接看到企业评分、班主任评分、学生自评的分数
   - 无法快速查看每个评价的详细指标分数

3. **缺少成绩汇总功能**：
   - 无法批量查看所有学生的成绩
   - 无法导出成绩报表

## 二、需求分析

### 2.1 功能需求

1. **新增"学生成绩"菜单**：
   - 位置：班主任用户菜单下
   - 菜单名称：学生成绩
   - 路由：`/teacher/evaluation/student-score`

2. **成绩列表页面**：
   - 显示所有实习结束的学生
   - 列表列包括：
     - 序号
     - 学号
     - 姓名
     - 企业名称
     - 实习时间
     - **企业评分**（总分）
     - **班主任评分**（总分）
     - **学生自评**（总分）
     - **综合成绩**（总分 + 等级）
     - 操作（查看详情）

3. **成绩详情查看**：
   - 点击"查看详情"按钮，弹出详情对话框
   - 详情对话框显示：
     - **企业评价详情**：
       - 工作态度：XX分
       - 专业知识应用：XX分
       - 专业技能：XX分
       - 团队协作：XX分
       - 创新意识：XX分
       - 日志周报质量：XX分
       - 总分：XX分
       - 权重：40%
       - 评价意见（如果有）
     - **学校评价详情**：
       - 日志周报质量：XX分
       - 过程表现：XX分
       - 成果展示：XX分
       - 总结反思：XX分
       - 总分：XX分
       - 权重：40%（合作企业）或 60%（自主实习）
       - 评价意见（如果有）
     - **学生自评详情**：
       - 自评分数：XX分
       - 权重：20%（合作企业）或 40%（自主实习）
       - 自我反思和总结（富文本）
     - **综合成绩计算**：
       - 计算公式
       - 各部分得分
       - 最终综合成绩
       - 成绩等级

4. **搜索和筛选**：
   - 按学生姓名搜索
   - 按企业名称搜索
   - 按成绩等级筛选（优秀/良好/中等/及格/不及格）
   - 按实习类型筛选（合作企业/自主实习）

5. **数据权限**：
   - 班主任只能查看本班学生的成绩
   - 系统管理员、学校管理员、学院负责人可以查看所有学生的成绩

## 三、技术方案

### 3.1 前端实现

#### 3.1.1 新增页面文件
- **文件路径**：`internship-web/src/views/teacher/StudentScore.vue`
- **功能**：学生成绩列表和详情查看

#### 3.1.2 页面结构

```vue
<template>
  <PageLayout title="学生成绩">
    <!-- 搜索栏 -->
    <div class="search-bar">
      <el-form :inline="true" :model="searchForm">
        <el-form-item label="学生姓名">
          <el-input v-model="searchForm.studentName" placeholder="请输入学生姓名" />
        </el-form-item>
        <el-form-item label="企业名称">
          <el-input v-model="searchForm.enterpriseName" placeholder="请输入企业名称" />
        </el-form-item>
        <el-form-item label="成绩等级">
          <el-select v-model="searchForm.gradeLevel" placeholder="请选择等级" clearable>
            <el-option label="优秀" value="优秀" />
            <el-option label="良好" value="良好" />
            <el-option label="中等" value="中等" />
            <el-option label="及格" value="及格" />
            <el-option label="不及格" value="不及格" />
          </el-select>
        </el-form-item>
        <el-form-item label="实习类型">
          <el-select v-model="searchForm.applyType" placeholder="请选择类型" clearable>
            <el-option label="合作企业" :value="1" />
            <el-option label="自主实习" :value="2" />
          </el-select>
        </el-form-item>
        <el-form-item>
          <el-button type="primary" @click="handleSearch">查询</el-button>
          <el-button @click="handleReset">重置</el-button>
        </el-form-item>
      </el-form>
    </div>

    <!-- 成绩列表 -->
    <el-table :data="tableData" v-loading="loading" stripe>
      <el-table-column type="index" label="序号" width="60" align="center" />
      <el-table-column prop="studentNo" label="学号" width="120" />
      <el-table-column prop="studentName" label="姓名" width="100" />
      <el-table-column prop="enterpriseName" label="企业" min-width="200" show-overflow-tooltip />
      <el-table-column label="实习时间" width="200">
        <template #default="{ row }">
          {{ formatDate(row.startDate) }} 至 {{ formatDate(row.endDate) }}
        </template>
      </el-table-column>
      <el-table-column label="企业评分" width="120" align="center">
        <template #default="{ row }">
          <span v-if="row.enterpriseScore !== null && row.enterpriseScore !== undefined">
            {{ row.enterpriseScore }}分
          </span>
          <span v-else style="color: #909399;">-</span>
        </template>
      </el-table-column>
      <el-table-column label="班主任评分" width="120" align="center">
        <template #default="{ row }">
          <span v-if="row.schoolScore !== null && row.schoolScore !== undefined">
            {{ row.schoolScore }}分
          </span>
          <span v-else style="color: #909399;">-</span>
        </template>
      </el-table-column>
      <el-table-column label="学生自评" width="120" align="center">
        <template #default="{ row }">
          <span v-if="row.selfScore !== null && row.selfScore !== undefined">
            {{ row.selfScore }}分
          </span>
          <span v-else style="color: #909399;">-</span>
        </template>
      </el-table-column>
      <el-table-column label="综合成绩" width="140" align="center">
        <template #default="{ row }">
          <div v-if="row.comprehensiveScore !== null && row.comprehensiveScore !== undefined">
            <div style="font-weight: bold; color: #409eff; font-size: 14px;">
              {{ row.comprehensiveScore }}分
            </div>
            <el-tag 
              v-if="row.gradeLevel"
              :type="getGradeTagType(row.gradeLevel)" 
              size="small"
              style="margin-top: 4px;"
            >
              {{ row.gradeLevel }}
            </el-tag>
          </div>
          <span v-else style="color: #909399;">-</span>
        </template>
      </el-table-column>
      <el-table-column label="操作" width="120" fixed="right" align="center">
        <template #default="{ row }">
          <el-button
            link
            type="primary"
            size="small"
            @click="handleViewDetail(row)"
          >
            查看详情
          </el-button>
        </template>
      </el-table-column>
    </el-table>

    <!-- 分页 -->
    <div class="pagination-container">
      <el-pagination
        v-model:current-page="pagination.current"
        v-model:page-size="pagination.size"
        :total="pagination.total"
        :page-sizes="[10, 20, 50, 100]"
        layout="total, sizes, prev, pager, next, jumper"
        @size-change="handleSizeChange"
        @current-change="handlePageChange"
      />
    </div>

    <!-- 成绩详情对话框 -->
    <el-dialog
      v-model="detailDialogVisible"
      title="成绩详情"
      width="80%"
      :close-on-click-modal="false"
    >
      <StudentScoreDetail
        v-if="currentApplyId"
        :apply-id="currentApplyId"
      />
    </el-dialog>
  </PageLayout>
</template>
```

#### 3.1.3 数据加载逻辑

1. **调用后端API**：
   - `GET /evaluation/comprehensive-score/page` - 获取综合成绩列表
   - 后端返回的数据包含：
     - `enterpriseScore` - 企业评分
     - `schoolScore` - 学校评分
     - `selfScore` - 学生自评
     - `comprehensiveScore` - 综合成绩
     - `gradeLevel` - 成绩等级
     - 学生信息、企业信息等

2. **详情查看**：
   - 点击"查看详情"时，调用以下API获取详细评价信息：
     - `GET /evaluation/enterprise/apply/{applyId}` - 企业评价详情
     - `GET /evaluation/school/apply/{applyId}` - 学校评价详情
     - `GET /evaluation/self/apply/{applyId}` - 学生自评详情
     - `GET /evaluation/comprehensive-score/apply/{applyId}` - 综合成绩详情

#### 3.1.4 详情组件

创建 `StudentScoreDetail.vue` 组件，用于显示成绩详情：

```vue
<template>
  <div class="score-detail">
    <!-- 企业评价详情 -->
    <el-card v-if="enterpriseEvaluation" class="detail-card">
      <template #header>
        <div class="card-header">
          <span>企业评价：{{ comprehensiveScore?.enterpriseScore }}分</span>
          <el-tag type="info" size="small">权重{{ getEnterpriseWeight() }}%</el-tag>
        </div>
      </template>
      <el-descriptions :column="2" border>
        <el-descriptions-item label="工作态度">{{ enterpriseEvaluation.workAttitudeScore }}分</el-descriptions-item>
        <el-descriptions-item label="专业知识应用">{{ enterpriseEvaluation.knowledgeApplicationScore }}分</el-descriptions-item>
        <el-descriptions-item label="专业技能">{{ enterpriseEvaluation.professionalSkillScore }}分</el-descriptions-item>
        <el-descriptions-item label="团队协作">{{ enterpriseEvaluation.teamworkScore }}分</el-descriptions-item>
        <el-descriptions-item label="创新意识">{{ enterpriseEvaluation.innovationScore }}分</el-descriptions-item>
        <el-descriptions-item label="日志周报质量">{{ enterpriseEvaluation.logWeeklyReportScore }}分</el-descriptions-item>
        <el-descriptions-item label="总分" :span="2">
          <strong style="color: #409eff;">{{ enterpriseEvaluation.totalScore }}分</strong>
        </el-descriptions-item>
      </el-descriptions>
      <div v-if="enterpriseEvaluation.evaluationComment" style="margin-top: 15px;">
        <div style="font-weight: 600; margin-bottom: 5px;">评价意见：</div>
        <div style="color: #606266;">{{ enterpriseEvaluation.evaluationComment }}</div>
      </div>
    </el-card>

    <!-- 学校评价详情 -->
    <el-card v-if="schoolEvaluation" class="detail-card" style="margin-top: 15px;">
      <template #header>
        <div class="card-header">
          <span>学校评价：{{ comprehensiveScore?.schoolScore }}分</span>
          <el-tag type="info" size="small">权重{{ getSchoolWeight() }}%</el-tag>
        </div>
      </template>
      <el-descriptions :column="2" border>
        <el-descriptions-item label="日志周报质量">{{ schoolEvaluation.logWeeklyReportScore }}分</el-descriptions-item>
        <el-descriptions-item label="过程表现">{{ schoolEvaluation.processPerformanceScore }}分</el-descriptions-item>
        <el-descriptions-item label="成果展示">{{ schoolEvaluation.achievementScore }}分</el-descriptions-item>
        <el-descriptions-item label="总结反思">{{ schoolEvaluation.summaryReflectionScore }}分</el-descriptions-item>
        <el-descriptions-item label="总分" :span="2">
          <strong style="color: #409eff;">{{ schoolEvaluation.totalScore }}分</strong>
        </el-descriptions-item>
      </el-descriptions>
      <div v-if="schoolEvaluation.evaluationComment" style="margin-top: 15px;">
        <div style="font-weight: 600; margin-bottom: 5px;">评价意见：</div>
        <div style="color: #606266;">{{ schoolEvaluation.evaluationComment }}</div>
      </div>
    </el-card>

    <!-- 学生自评详情 -->
    <el-card v-if="selfEvaluation" class="detail-card" style="margin-top: 15px;">
      <template #header>
        <div class="card-header">
          <span>学生自评：{{ comprehensiveScore?.selfScore }}分</span>
          <el-tag type="info" size="small">权重{{ getSelfWeight() }}%</el-tag>
        </div>
      </template>
      <el-descriptions :column="1" border>
        <el-descriptions-item label="自评分数">
          <strong style="color: #409eff;">{{ selfEvaluation.selfScore }}分</strong>
        </el-descriptions-item>
      </el-descriptions>
      <div v-if="selfEvaluation.reflectionSummary" style="margin-top: 15px;">
        <div style="font-weight: 600; margin-bottom: 5px;">自我反思和总结：</div>
        <div class="reflection-content" v-html="selfEvaluation.reflectionSummary"></div>
      </div>
    </el-card>

    <!-- 综合成绩计算 -->
    <el-card v-if="comprehensiveScore" class="detail-card" style="margin-top: 15px;">
      <template #header>
        <span>综合成绩计算</span>
      </template>
      <div class="calculation-section">
        <div class="calculation-formula">
          {{ getCalculationFormula() }}
        </div>
        <div class="calculation-result">
          = {{ calculatePart(comprehensiveScore.enterpriseScore, getEnterpriseWeight() / 100) }} 
          + {{ calculatePart(comprehensiveScore.schoolScore, getSchoolWeight() / 100) }} 
          + {{ calculatePart(comprehensiveScore.selfScore, getSelfWeight() / 100) }} 
          = <strong style="color: #409eff; font-size: 18px;">{{ comprehensiveScore.comprehensiveScore }}分</strong>
        </div>
        <div style="margin-top: 15px;">
          <el-tag 
            :type="getGradeTagType(comprehensiveScore.gradeLevel)" 
            size="large"
          >
            {{ comprehensiveScore.gradeLevel }}
          </el-tag>
        </div>
      </div>
    </el-card>
  </div>
</template>
```

### 3.2 后端实现

#### 3.2.1 后端API已存在

后端已经提供了以下API，可以直接使用：

1. **分页查询综合成绩列表**：
   - `GET /evaluation/comprehensive-score/page`
   - 参数：`current`, `size`, `studentName`
   - 返回：包含企业评分、学校评分、自评、综合成绩等信息

2. **查询评价详情**：
   - `GET /evaluation/enterprise/apply/{applyId}` - 企业评价详情
   - `GET /evaluation/school/apply/{applyId}` - 学校评价详情
   - `GET /evaluation/self/apply/{applyId}` - 学生自评详情
   - `GET /evaluation/comprehensive-score/apply/{applyId}` - 综合成绩详情

#### 3.2.2 后端扩展

如果需要支持更多筛选条件，可以扩展后端API：

```java
@GetMapping("/page")
public Result<Page<ComprehensiveScore>> getScorePage(
    @RequestParam(defaultValue = "1") Long current,
    @RequestParam(defaultValue = "10") Long size,
    @RequestParam(required = false) String studentName,
    @RequestParam(required = false) String enterpriseName,  // 新增
    @RequestParam(required = false) String gradeLevel,       // 新增
    @RequestParam(required = false) Integer applyType) {     // 新增
    // 实现筛选逻辑
}
```

### 3.3 菜单配置

在 `internship-web/src/config/menu.config.js` 中添加菜单项：

```javascript
{
  index: '/teacher/evaluation/student-score',
  title: '学生成绩',
  icon: DataAnalysis,  // 或使用其他合适的图标
  roles: ['ROLE_CLASS_TEACHER', 'ROLE_SYSTEM_ADMIN', 'ROLE_SCHOOL_ADMIN', 'ROLE_COLLEGE_LEADER']
}
```

### 3.4 路由配置

在 `internship-web/src/router/modules/evaluation.js` 中添加路由：

```javascript
{
  path: '/teacher/evaluation/student-score',
  name: 'StudentScore',
  component: () => import('@/views/teacher/StudentScore.vue'),
  meta: {
    title: '学生成绩',
    requiresAuth: true,
    roles: ['ROLE_CLASS_TEACHER', 'ROLE_SYSTEM_ADMIN', 'ROLE_SCHOOL_ADMIN', 'ROLE_COLLEGE_LEADER']
  }
}
```

## 四、实现步骤

### 4.1 第一阶段：基础功能

1. ✅ 创建 `StudentScore.vue` 页面
2. ✅ 创建 `StudentScoreDetail.vue` 组件
3. ✅ 实现成绩列表展示
4. ✅ 实现详情查看功能
5. ✅ 添加菜单和路由配置

### 4.2 第二阶段：搜索和筛选

1. ✅ 实现学生姓名搜索
2. ✅ 实现企业名称搜索
3. ✅ 实现成绩等级筛选
4. ✅ 实现实习类型筛选

### 4.3 第三阶段：优化和扩展

1. 导出成绩报表（Excel）
2. 成绩统计图表
3. 批量计算综合成绩
4. 成绩历史记录查看

## 五、数据权限

### 5.1 权限控制

- **班主任**：只能查看本班学生的成绩
- **系统管理员**：可以查看所有学生的成绩
- **学校管理员**：可以查看本校所有学生的成绩
- **学院负责人**：可以查看本学院所有学生的成绩

### 5.2 后端权限实现

后端 `ComprehensiveScoreServiceImpl.getScorePage()` 方法已经实现了数据权限过滤，使用 `DataPermissionUtil` 进行权限控制。

## 六、UI设计建议

### 6.1 列表页面

- 使用表格展示，清晰明了
- 成绩列使用不同颜色区分：
  - 优秀：绿色
  - 良好：蓝色
  - 中等：橙色
  - 及格：灰色
  - 不及格：红色

### 6.2 详情对话框

- 使用卡片布局，每个评价一个卡片
- 使用 `el-descriptions` 组件展示详细信息
- 突出显示总分和综合成绩
- 显示权重信息
- 显示计算公式

## 七、测试要点

1. **功能测试**：
   - 列表加载是否正确
   - 搜索和筛选是否有效
   - 详情查看是否完整
   - 数据权限是否正确

2. **数据测试**：
   - 合作企业实习的成绩显示
   - 自主实习的成绩显示（无企业评价）
   - 未完成评价的学生显示
   - 未计算综合成绩的学生显示

3. **边界测试**：
   - 空数据情况
   - 大量数据分页
   - 特殊字符搜索

## 八、与原方案对比

### 8.1 原方案（班主任评价页面）

**优点**：
- 已经实现了综合成绩列的显示
- 可以查看评价详情

**缺点**：
- 主要用于评价，不是专门的成绩查看页面
- 无法直接看到企业评分、班主任评分、学生自评的分数
- 需要点击"查看"才能看到详情

### 8.2 新方案（学生成绩页面）

**优点**：
- 专门用于成绩查看和管理
- 列表直接显示企业评分、班主任评分、学生自评、综合成绩
- 详情对话框展示完整的评价信息
- 支持搜索和筛选
- 更符合成绩管理的使用场景

**缺点**：
- 需要新增页面和组件
- 需要添加菜单和路由配置

## 九、总结

本方案通过新增"学生成绩"页面，解决了班主任查看学生成绩的需求。新页面专门用于成绩管理，提供了更清晰、更完整的成绩展示功能，同时保持了与现有系统的兼容性。

